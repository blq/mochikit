/*


 MochiKit.Base 1.5

 See <http://mochikit.com/> for documentation, downloads, license, etc.

 (c) 2005 Bob Ippolito.  All rights Reserved.

*/
if(typeof goog!="undefined"&&typeof goog.provide=="function")var MochiKit={};MochiKit=MochiKit||{};if(typeof MochiKit.__export__=="undefined")MochiKit.__export__=true;MochiKit.NAME="MochiKit";MochiKit.VERSION="1.5";MochiKit.__repr__=function(){return"["+this.NAME+" "+this.VERSION+"]"};MochiKit.toString=function(){return this.__repr__()};MochiKit.Base=MochiKit.Base||{};
MochiKit.Base.module=function(a,b,c,d){var e=a[b]=a[b]||{},f=a.NAME?a.NAME+".":"";e.NAME=f+b;e.VERSION=c;e.__repr__=function(){return"["+this.NAME+" "+this.VERSION+"]"};e.toString=function(){return this.__repr__()};for(b=0;d!=null&&b<d.length;b++)if(!(d[b]in a))throw e.NAME+" depends on "+f+d[b]+"!";return e};MochiKit.Base.module(MochiKit,"Base","1.5",[]);
MochiKit.Base.update=function(a){if(a===null||a===undefined)a={};for(var b=1;b<arguments.length;b++){var c=arguments[b];if(typeof c!="undefined"&&c!==null)for(var d in c)a[d]=c[d]}return a};
MochiKit.Base.update(MochiKit.Base,{camelize:function(a){a=a.split("-");for(var b=a[0],c=1;c<a.length;c++)b+=a[c].charAt(0).toUpperCase()+a[c].substring(1);return b},counter:function(a,b){if(arguments.length===0)a=1;if(arguments.length<2)b=1;return function(){var c=a;a+=b;return c}},clone:function(a){var b=arguments.callee;if(arguments.length==1){b.prototype=a;return new b}},_flattenArray:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d instanceof Array?arguments.callee(a,d):a.push(d)}return a},
flattenArray:function(a){return MochiKit.Base._flattenArray([],a)},flattenArguments:function(){for(var a=[],b=MochiKit.Base.extend(null,arguments);b.length;){var c=b.shift();if(c&&typeof c=="object"&&typeof c.length=="number")for(var d=c.length-1;d>=0;d--)b.unshift(c[d]);else a.push(c)}return a},extend:function(a,b,c){c||(c=0);if(b){var d=b.length;if(typeof d!="number")if(typeof MochiKit.Iter!="undefined"){b=MochiKit.Iter.list(b);d=b.length}else throw new TypeError("Argument not an array-like and MochiKit.Iter not present");
a||(a=[]);for(c=c;c<d;c++)a.push(b[c])}return a},updatetree:function(a){if(a===null||a===undefined)a={};for(var b=1;b<arguments.length;b++){var c=arguments[b];if(typeof c!="undefined"&&c!==null)for(var d in c){var e=c[d];if(typeof a[d]=="object"&&typeof e=="object"&&!MochiKit.Base.isDateLike(e)&&!(e instanceof Array))arguments.callee(a[d],e);else a[d]=e}}return a},setdefault:function(a){if(a===null||a===undefined)a={};for(var b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)d in a||(a[d]=
c[d])}return a},keys:function(a){var b=[],c;for(c in a)b.push(c);return b},values:function(a){var b=[],c;for(c in a)b.push(a[c]);return b},items:function(a){var b=[],c;for(c in a){var d;try{d=a[c]}catch(e){continue}b.push([c,d])}return b},_newNamedError:function(a,b,c){c.prototype=new MochiKit.Base.NamedError(a.NAME+"."+b);c.prototype.constructor=c;a[b]=c},operator:{NAME:"operator",truth:function(a){return!!a},lognot:function(a){return!a},identity:function(a){return a},not:function(a){return~a},neg:function(a){return-a},
add:function(a,b){return a+b},sub:function(a,b){return a-b},div:function(a,b){return a/b},floordiv:function(a,b){return Math.floor(a/b)},mod:function(a,b){return a%b},mul:function(a,b){return a*b},pow:function(a,b){return Math.pow(a,b)},and:function(a,b){return a&b},or:function(a,b){return a|b},xor:function(a,b){return a^b},lshift:function(a,b){return a<<b},rshift:function(a,b){return a>>b},zrshift:function(a,b){return a>>>b},getitem:function(a,b){return a[b]},eq:function(a,b){return a==b},ne:function(a,
b){return a!=b},gt:function(a,b){return a>b},ge:function(a,b){return a>=b},lt:function(a,b){return a<b},le:function(a,b){return a<=b},seq:function(a,b){return a===b},sne:function(a,b){return a!==b},ceq:function(a,b){return MochiKit.Base.compare(a,b)===0},cne:function(a,b){return MochiKit.Base.compare(a,b)!==0},cgt:function(a,b){return MochiKit.Base.compare(a,b)==1},cge:function(a,b){return MochiKit.Base.compare(a,b)!=-1},clt:function(a,b){return MochiKit.Base.compare(a,b)==-1},cle:function(a,b){return MochiKit.Base.compare(a,
b)!=1},logand:function(a,b){return a&&b},logor:function(a,b){return a||b},contains:function(a,b){return b in a},concat:function(a,b){return MochiKit.Base.concat(a,b)},iconcat:function(a,b){return a.concat(b)},setitem:function(a,b,c){return a[b]=c},delitem:function(a,b){delete a[b]}},forwardCall:function(a){return function(){return this[a].apply(this,arguments)}},itemgetter:function(a){return function(b){return b[a]}},bool:function(a){return typeof a==="boolean"||a instanceof Boolean?a.valueOf():typeof a===
"string"||a instanceof String?a.length>0&&a!="false"&&a!="null"&&a!="undefined"&&a!="0":typeof a==="number"||a instanceof Number?!isNaN(a)&&a!=0:a!=null&&typeof a.length==="number"?a.length!==0:a!=null},typeMatcher:function(){for(var a={},b=0;b<arguments.length;b++){var c=arguments[b];a[c]=c}return function(){for(var d=0;d<arguments.length;d++)if(!(typeof arguments[d]in a))return false;return true}},isNull:function(){for(var a=0;a<arguments.length;a++)if(arguments[a]!==null)return false;return true},
isUndefinedOrNull:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(!(typeof b=="undefined"||b===null))return false}return true},isEmpty:function(){return!MochiKit.Base.isNotEmpty.apply(this,arguments)},isNotEmpty:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(!(b&&b.length))return false}return true},isArrayLike:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a],c=typeof b;if(c!="object"&&!(c=="function"&&typeof b.item=="function")||b===null||
typeof b.length!="number"||b.nodeType===3||b.nodeType===4)return false}return true},isDateLike:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if(typeof b!="object"||b===null||typeof b.getTime!="function")return false}return true},xmap:function(a){if(a===null)return MochiKit.Base.extend(null,arguments,1);for(var b=[],c=1;c<arguments.length;c++)b.push(a(arguments[c]));return b},map:function(a,b){var c=MochiKit.Base,d=MochiKit.Iter,e=c.isArrayLike;if(arguments.length<=2){if(!e(b))if(d){b=
d.list(b);if(a===null)return b}else throw new TypeError("Argument not an array-like and MochiKit.Iter not present");if(a===null)return c.extend(null,b);d=[];for(c=0;c<b.length;c++)d.push(a(b[c]))}else{if(a===null)a=Array;var f=null;for(c=1;c<arguments.length;c++){if(!e(arguments[c]))if(d)return d.list(d.imap.apply(null,arguments));else throw new TypeError("Argument not an array-like and MochiKit.Iter not present");var g=arguments[c].length;if(f===null||f>g)f=g}d=[];for(c=0;c<f;c++){e=[];for(g=1;g<
arguments.length;g++)e.push(arguments[g][c]);d.push(a.apply(this,e))}}return d},xfilter:function(a){var b=[];if(a===null)a=MochiKit.Base.operator.truth;for(var c=1;c<arguments.length;c++){var d=arguments[c];a(d)&&b.push(d)}return b},filter:function(a,b,c){var d=[],e=MochiKit.Base;if(!e.isArrayLike(b))if(MochiKit.Iter)b=MochiKit.Iter.list(b);else throw new TypeError("Argument not an array-like and MochiKit.Iter not present");if(a===null)a=e.operator.truth;if(typeof Array.prototype.filter=="function")return Array.prototype.filter.call(b,
a,c);else if(typeof c=="undefined"||c===null)for(e=0;e<b.length;e++){var f=b[e];a(f)&&d.push(f)}else for(e=0;e<b.length;e++){f=b[e];a.call(c,f)&&d.push(f)}return d},_wrapDumbFunction:function(a){return function(){switch(arguments.length){case 0:return a();case 1:return a(arguments[0]);case 2:return a(arguments[0],arguments[1]);case 3:return a(arguments[0],arguments[1],arguments[2])}for(var b=[],c=0;c<arguments.length;c++)b.push("arguments["+c+"]");return eval("(func("+b.join(",")+"))")}},methodcaller:function(a){var b=
MochiKit.Base.extend(null,arguments,1);return typeof a=="function"?function(c){return a.apply(c,b)}:function(c){return c[a].apply(c,b)}},method:function(a,b){var c=MochiKit.Base;return c.bind.apply(this,c.extend([b,a],arguments,2))},compose:function(){var a=[],b=MochiKit.Base;if(arguments.length===0)throw new TypeError("compose() requires at least one argument");for(var c=0;c<arguments.length;c++){var d=arguments[c];if(typeof d!="function")throw new TypeError(b.repr(d)+" is not a function");a.push(d)}return function(){for(var e=
arguments,f=a.length-1;f>=0;f--)e=[a[f].apply(this,e)];return e[0]}},bind:function(a,b){if(typeof a=="string")a=b[a];var c=a.im_func,d=a.im_preargs,e=a.im_self,f=MochiKit.Base;if(typeof a=="function"&&typeof a.apply=="undefined")a=f._wrapDumbFunction(a);if(typeof c!="function")c=a;if(typeof b!="undefined")e=b;d=typeof d=="undefined"?[]:d.slice();f.extend(d,arguments,2);var g=function(){var h=arguments,i=arguments.callee;if(i.im_preargs.length>0)h=f.concat(i.im_preargs,h);var j=i.im_self;j||(j=this);
return i.im_func.apply(j,h)};g.im_self=e;g.im_func=c;g.im_preargs=d;if(typeof c.NAME=="string")g.NAME="bind("+c.NAME+",...)";return g},bindLate:function(a){var b=MochiKit.Base,c=arguments;if(typeof a==="string"){c=b.extend([b.forwardCall(a)],arguments,1);return b.bind.apply(this,c)}return b.bind.apply(this,c)},bindMethods:function(a){var b=MochiKit.Base.bind,c;for(c in a){var d=a[c];if(typeof d=="function")a[c]=b(d,a)}},registerComparator:function(a,b,c,d){MochiKit.Base.comparatorRegistry.register(a,
b,c,d)},_primitives:{"boolean":true,string:true,number:true},compare:function(a,b){if(a==b)return 0;var c=typeof a=="undefined"||a===null,d=typeof b=="undefined"||b===null;if(c&&d)return 0;else if(c)return-1;else if(d)return 1;c=MochiKit.Base;d=c._primitives;if(!(typeof a in d&&typeof b in d))try{return c.comparatorRegistry.match(a,b)}catch(e){if(e!=c.NotFound)throw e;}if(a<b)return-1;else if(a>b)return 1;c=c.repr;throw new TypeError(c(a)+" and "+c(b)+" can not be compared");},compareDateLike:function(a,
b){return MochiKit.Base.compare(a.getTime(),b.getTime())},compareArrayLike:function(a,b){var c=MochiKit.Base.compare,d=a.length,e=0;if(d>b.length){e=1;d=b.length}else if(d<b.length)e=-1;for(var f=0;f<d;f++){var g=c(a[f],b[f]);if(g)return g}return e},registerRepr:function(a,b,c,d){MochiKit.Base.reprRegistry.register(a,b,c,d)},repr:function(a){if(typeof a=="undefined")return"undefined";else if(a===null)return"null";try{if(typeof a.__repr__=="function")return a.__repr__();else if(typeof a.repr=="function"&&
a.repr!=arguments.callee)return a.repr();return MochiKit.Base.reprRegistry.match(a)}catch(b){try{if(typeof a.NAME=="string"&&(a.toString==Function.prototype.toString||a.toString==Object.prototype.toString))return a.NAME}catch(c){}}var d=a+"";if(typeof a=="function"){d=d.replace(/^\s+/,"").replace(/\s+/g," ");d=d.replace(/,(\S)/,", $1");var e=d.indexOf("{");if(e!=-1)d=d.substr(0,e)+"{...}"}return d},reprArrayLike:function(a){var b=MochiKit.Base;return"["+b.map(b.repr,a).join(", ")+"]"},reprString:function(a){return('"'+
a.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\v]/g,"\\v").replace(/[\r]/g,"\\r")},reprNumber:function(a){return a+""},registerJSON:function(a,b,c,d){MochiKit.Base.jsonRegistry.register(a,b,c,d)},evalJSON:function(a){return eval("("+MochiKit.Base._filterJSON(a)+")")},_filterJSON:function(a){var b=a.match(/^\s*\/\*(.*)\*\/\s*$/);return b?b[1]:a},serializeJSON:function(a){var b=typeof a;if(b=="number"||b=="boolean")return a+
"";else if(a===null)return"null";else if(b=="string"){b="";for(var c=0;c<a.length;c++){var d=a.charAt(c);if(d=='"')b+='\\"';else if(d=="\\")b+="\\\\";else if(d=="\u0008")b+="\\b";else if(d=="\u000c")b+="\\f";else if(d=="\n")b+="\\n";else if(d=="\r")b+="\\r";else if(d=="\t")b+="\\t";else if(a.charCodeAt(c)<=31){d=a.charCodeAt(c).toString(16);if(d.length<2)d="0"+d;b+="\\u00"+d.toUpperCase()}else b+=d}return'"'+b+'"'}d=arguments.callee;var e;if(typeof a.toJSON=="function"){e=a.toJSON();if(a!==e)return d(e)}if(typeof a.__json__==
"function"){e=a.__json__();if(a!==e)return d(e)}if(typeof a.json=="function"){e=a.json();if(a!==e)return d(e)}if(b!="function"&&typeof a.length=="number"){b=[];for(c=0;c<a.length;c++){e=d(a[c]);typeof e=="string"&&b.push(e)}return"["+b.join(", ")+"]"}var f=MochiKit.Base;try{e=f.jsonRegistry.match(a);if(a!==e)return d(e)}catch(g){if(g!=f.NotFound)throw g;}if(b=="undefined")throw new TypeError("undefined can not be serialized as JSON");if(b=="function")return null;b=[];for(c in a)if(a.hasOwnProperty(c)){if(typeof c==
"number")f='"'+c+'"';else if(typeof c=="string")f=d(c);else continue;e=d(a[c]);typeof e=="string"&&b.push(f+":"+e)}return"{"+b.join(", ")+"}"},objEqual:function(a,b){return MochiKit.Base.compare(a,b)===0},arrayEqual:function(a,b){if(a.length!=b.length)return false;return MochiKit.Base.compare(a,b)===0},concat:function(){for(var a=[],b=MochiKit.Base.extend,c=0;c<arguments.length;c++)b(a,arguments[c]);return a},keyComparator:function(a){var b=MochiKit.Base,c=b.compare;if(arguments.length==1)return function(e,
f){return c(e[a],f[a])};var d=b.extend(null,arguments);return function(e,f){for(var g=0,h=0;g===0&&h<d.length;h++){g=d[h];g=c(e[g],f[g])}return g}},reverseKeyComparator:function(){var a=MochiKit.Base.keyComparator.apply(this,arguments);return function(b,c){return a(c,b)}},partial:function(a){var b=MochiKit.Base;return b.bind.apply(this,b.extend([a,undefined],arguments,1))},listMinMax:function(a,b){if(b.length===0)return null;for(var c=b[0],d=MochiKit.Base.compare,e=1;e<b.length;e++){var f=b[e];if(d(f,
c)==a)c=f}return c},objMax:function(){return MochiKit.Base.listMinMax(1,arguments)},objMin:function(){return MochiKit.Base.listMinMax(-1,arguments)},findIdentical:function(a,b,c,d){if(typeof d=="undefined"||d===null)d=a.length;if(typeof c=="undefined"||c===null)c=0;for(c=c;c<d;c++)if(a[c]===b)return c;return-1},mean:function(){for(var a=0,b=MochiKit.Base.extend(null,arguments),c=b.length;b.length;){var d=b.shift();if(d&&typeof d=="object"&&typeof d.length=="number"){c+=d.length-1;for(var e=d.length-
1;e>=0;e--)a+=d[e]}else a+=d}if(c<=0)throw new TypeError("mean() requires at least one argument");return a/c},median:function(){var a=MochiKit.Base.flattenArguments(arguments);if(a.length===0)throw new TypeError("median() requires at least one argument");a.sort(MochiKit.Base.compare);if(a.length%2==0){var b=a.length/2;return(a[b]+a[b-1])/2}else return a[(a.length-1)/2]},findValue:function(a,b,c,d){if(typeof d=="undefined"||d===null)d=a.length;if(typeof c=="undefined"||c===null)c=0;var e=MochiKit.Base.compare;
for(c=c;c<d;c++)if(e(a[c],b)===0)return c;return-1},nodeWalk:function(a,b){for(var c=[a],d=MochiKit.Base.extend;c.length;){var e=b(c.shift());e&&d(c,e)}},nameFunctions:function(a){var b=a.NAME;if(typeof b=="undefined")b="";else b+=".";for(var c in a){var d=a[c];if(typeof d=="function"&&typeof d.NAME=="undefined")try{d.NAME=b+c}catch(e){}}},queryString:function(a,b){if(typeof MochiKit.DOM!="undefined"&&arguments.length==1&&(typeof a=="string"||typeof a.nodeType!="undefined"&&a.nodeType>0)){var c=MochiKit.DOM.formContents(a);
a=c[0];b=c[1]}else if(arguments.length==1){if(typeof a.length=="number"&&a.length==2)return arguments.callee(a[0],a[1]);var d=a;a=[];b=[];for(var e in d){c=d[e];if(typeof c!="function")if(MochiKit.Base.isArrayLike(c))for(var f=0;f<c.length;f++){a.push(e);b.push(c[f])}else{a.push(e);b.push(c)}}}d=[];e=Math.min(a.length,b.length);var g=MochiKit.Base.urlEncode;for(f=0;f<e;f++){c=b[f];if(typeof c!="undefined"&&c!==null){if(MochiKit.Base.isDateLike(c))c=MochiKit.DateTime.toISOTimestamp(c,true);d.push(g(a[f])+
"="+g(c))}}return d.join("&")},parseQueryString:function(a,b){var c=(a.charAt(0)=="?"?a.substring(1):a).replace(/\+/g,"%20").split(/\&amp\;|\&\#38\;|\&#x26;|\&/),d={},e;e=typeof decodeURIComponent!="undefined"?decodeURIComponent:unescape;if(b)for(var f=0;f<c.length;f++){var g=c[f].split("="),h=e(g.shift());if(h){var i=d[h];if(!(i instanceof Array)){i=[];d[h]=i}i.push(e(g.join("=")))}}else for(f=0;f<c.length;f++){g=c[f].split("=");if(h=g.shift())d[e(h)]=e(g.join("="))}return d}});
MochiKit.Base.AdapterRegistry=function(){this.pairs=[]};MochiKit.Base.AdapterRegistry.prototype={register:function(a,b,c,d){d?this.pairs.unshift([a,b,c]):this.pairs.push([a,b,c])},match:function(){for(var a=0;a<this.pairs.length;a++){var b=this.pairs[a];if(b[1].apply(this,arguments))return b[2].apply(this,arguments)}throw MochiKit.Base.NotFound;},unregister:function(a){for(var b=0;b<this.pairs.length;b++)if(this.pairs[b][0]==a){this.pairs.splice(b,1);return true}return false}};
MochiKit.Base.moduleExport=function(a,b){for(var c={toString:true,NAME:true,VERSION:true},d=MochiKit.Base.extend([],arguments,1);(b=d.shift())!=null;)for(var e in b){var f=b[e];if(f!=null){var g=e[0]!=="_"&&!c[e];if(typeof f.__export__=="boolean"?f.__export__:g)if(typeof f=="object"&&f.NAME&&f.VERSION)d.push(f);else a[e]=b[e]}}return a};MochiKit.Base._exportSymbols=function(a,b){MochiKit.__export__!==false&&b.__export__!==false&&MochiKit.Base.moduleExport(a,b)};
MochiKit.Base._deprecated=function(a,b,c,d,e){if(typeof a==="string"){if(a.indexOf("MochiKit.")===0)a=a.substring(9);a=MochiKit[a]}var f=c.split(".")[1],g=c.split(".")[2],h=function(){var i=arguments.callee,j=a.NAME+"."+b+" is deprecated since version "+d+". Use "+c+" instead.";if(i.logged!==true){i.logged=true;if(MochiKit.Logging)MochiKit.Logging.logDebug(j);else console&&console.log&&console.log(j)}if(!MochiKit[f])throw Error(j);return MochiKit[f][g].apply(this,arguments)};h.__export__=e===true;
a[b]=h};
MochiKit.Base.__new__=function(){var a=this;a.noop=function(){};a._deprecated(a,"forward","MochiKit.Base.forwardCall","1.3");a._deprecated(a,"find","MochiKit.Base.findValue","1.3");a.urlEncode=typeof encodeURIComponent!="undefined"?function(b){return encodeURIComponent(b).replace(/\'/g,"%27")}:function(b){return escape(b).replace(/\+/g,"%2B").replace(/\"/g,"%22").rval.replace(/\'/g,"%27")};a.NamedError=function(b){this.name=this.message=b};a.NamedError.prototype=Error();a.NamedError.prototype.constructor=a.NamedError;
a.NamedError.prototype.repr=function(){return this.message&&this.message!=this.name?this.name+"("+a.repr(this.message)+")":this.name+"()"};a.NamedError.prototype.toString=a.forwardCall("repr");a.NotFound=new a.NamedError("MochiKit.Base.NotFound");a.listMax=a.partial(a.listMinMax,1);a.listMin=a.partial(a.listMinMax,-1);a.isCallable=a.typeMatcher("function");a.isUndefined=a.typeMatcher("undefined");a.isValue=a.typeMatcher("boolean","number","string");a.merge=a.partial(a.update,null);a.zip=a.partial(a.map,
null);a.average=a.mean;a.comparatorRegistry=new a.AdapterRegistry;a.registerComparator("dateLike",a.isDateLike,a.compareDateLike);a.registerComparator("arrayLike",a.isArrayLike,a.compareArrayLike);a.reprRegistry=new a.AdapterRegistry;a.registerRepr("arrayLike",a.isArrayLike,a.reprArrayLike);a.registerRepr("string",a.typeMatcher("string"),a.reprString);a.registerRepr("numbers",a.typeMatcher("number","boolean"),a.reprNumber);a.jsonRegistry=new a.AdapterRegistry;a.nameFunctions(this);a.nameFunctions(this.operator)};
MochiKit.Base.__new__();if(MochiKit.__export__){compare=MochiKit.Base.compare;compose=MochiKit.Base.compose;serializeJSON=MochiKit.Base.serializeJSON;mean=MochiKit.Base.mean;median=MochiKit.Base.median}MochiKit.Base._exportSymbols(this,MochiKit.Base);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Iter={};MochiKit.Base.module(MochiKit,"Iter","1.5",["Base"]);
MochiKit.Base.update(MochiKit.Iter,{registerIteratorFactory:function(a,b,c,d){MochiKit.Iter.iteratorRegistry.register(a,b,c,d)},isIterable:function(a){return a!=null&&(typeof a.next=="function"||typeof a.iter=="function")},iter:function(a,b){var c=MochiKit.Iter;if(arguments.length==2)return c.takewhile(function(e){return e!=b},a);if(typeof a.next=="function")return a;else if(typeof a.iter=="function")return a.iter();else if(typeof a.__iterator__=="function")return a.__iterator__(false);try{return c.iteratorRegistry.match(a)}catch(d){c=
MochiKit.Base;if(d==c.NotFound)d=new TypeError(typeof a+": "+c.repr(a)+" is not iterable");throw d;}},count:function(a,b){a||(a=0);if(arguments.length<2)b=1;var c=MochiKit.Base;return{repr:function(){return"count("+a+")"},toString:c.forwardCall("repr"),next:c.counter(a,b)}},cycle:function(a){var b=MochiKit.Iter,c=MochiKit.Base,d=[],e=b.iter(a);return{repr:function(){return"cycle(...)"},toString:c.forwardCall("repr"),next:function(){try{var f=e.next();d.push(f);return f}catch(g){if(g!=b.StopIteration)throw g;
if(d.length===0)this.next=function(){throw b.StopIteration;};else{var h=-1;this.next=function(){h=(h+1)%d.length;return d[h]}}return this.next()}}}},repeat:function(a,b){var c=MochiKit.Base;if(typeof b=="undefined")return{repr:function(){return"repeat("+c.repr(a)+")"},toString:c.forwardCall("repr"),next:function(){return a}};return{repr:function(){return"repeat("+c.repr(a)+", "+b+")"},toString:c.forwardCall("repr"),next:function(){if(b<=0)throw MochiKit.Iter.StopIteration;b-=1;return a}}},next:function(a){return a.next()},
izip:function(){var a=MochiKit.Base,b=MochiKit.Iter,c=b.next,d=a.map(b.iter,arguments);return{repr:function(){return"izip(...)"},toString:a.forwardCall("repr"),next:function(){return a.map(c,d)}}},ifilter:function(a,b){var c=MochiKit.Base;b=MochiKit.Iter.iter(b);if(a===null)a=c.operator.truth;return{repr:function(){return"ifilter(...)"},toString:c.forwardCall("repr"),next:function(){for(;;){var d=b.next();if(a(d))return d}}}},ifilterfalse:function(a,b){var c=MochiKit.Base;b=MochiKit.Iter.iter(b);
if(a===null)a=c.operator.truth;return{repr:function(){return"ifilterfalse(...)"},toString:c.forwardCall("repr"),next:function(){for(;;){var d=b.next();if(!a(d))return d}}}},islice:function(a){var b=MochiKit.Iter,c=MochiKit.Base;a=b.iter(a);var d=0,e=0,f=1,g=-1;if(arguments.length==2)e=arguments[1];else if(arguments.length==3){d=arguments[1];e=arguments[2]}else{d=arguments[1];e=arguments[2];f=arguments[3]}return{repr:function(){return"islice("+["...",d,e,f].join(", ")+")"},toString:c.forwardCall("repr"),
next:function(){if(d>=e)throw b.StopIteration;for(var h;g<d;){h=a.next();g++}d+=f;return h}}},imap:function(a){var b=MochiKit.Base,c=MochiKit.Iter,d=b.map(c.iter,b.extend(null,arguments,1)),e=b.map,f=c.next;return{repr:function(){return"imap(...)"},toString:b.forwardCall("repr"),next:function(){return a.apply(this,e(f,d))}}},applymap:function(a,b,c){b=MochiKit.Iter.iter(b);return{repr:function(){return"applymap(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){return a.apply(c,b.next())}}},
chain:function(){var a=MochiKit.Iter,b=MochiKit.Base;if(arguments.length==1)return a.iter(arguments[0]);var c=b.map(a.iter,arguments);return{repr:function(){return"chain(...)"},toString:b.forwardCall("repr"),next:function(){for(;c.length>1;)try{return c[0].next()}catch(d){if(d!=a.StopIteration)throw d;c.shift()}if(c.length==1){var e=c.shift();this.next=b.bind("next",e);return this.next()}throw a.StopIteration;}}},takewhile:function(a,b){var c=MochiKit.Iter;b=c.iter(b);return{repr:function(){return"takewhile(...)"},
toString:MochiKit.Base.forwardCall("repr"),next:function(){var d=b.next();if(!a(d)){this.next=function(){throw c.StopIteration;};this.next()}return d}}},dropwhile:function(a,b){b=MochiKit.Iter.iter(b);var c=MochiKit.Base,d=c.bind;return{repr:function(){return"dropwhile(...)"},toString:c.forwardCall("repr"),next:function(){for(;;){var e=b.next();if(!a(e))break}this.next=d("next",b);return e}}},_tee:function(a,b,c){b.pos[a]=-1;var d=MochiKit.Base,e=d.listMin;return{repr:function(){return"tee("+a+", ...)"},
toString:d.forwardCall("repr"),next:function(){var f,g=b.pos[a];if(g==b.max){f=c.next();b.deque.push(f);b.max+=1;b.pos[a]+=1}else{f=b.deque[g-b.min];b.pos[a]+=1;if(g==b.min&&e(b.pos)!=b.min){b.min+=1;b.deque.shift()}}return f}}},tee:function(a,b){var c=[],d={pos:[],deque:[],max:-1,min:-1};if(arguments.length==1||typeof b=="undefined"||b===null)b=2;var e=MochiKit.Iter;a=e.iter(a);e=e._tee;for(var f=0;f<b;f++)c.push(e(f,d,a));return c},list:function(a){var b;if(a instanceof Array)return a.slice();if(typeof a==
"function"&&!(a instanceof Function)&&typeof a.length=="number"){b=[];for(var c=0;c<a.length;c++)b.push(a[c]);return b}c=MochiKit.Iter;a=c.iter(a);b=[];var d;try{for(;;){d=a.next();b.push(d)}}catch(e){if(e!=c.StopIteration)throw e;return b}},reduce:function(a,b,c){var d=c,e=MochiKit.Iter;b=e.iter(b);if(arguments.length<3)try{d=b.next()}catch(f){if(f==e.StopIteration)f=new TypeError("reduce() of empty sequence with no initial value");throw f;}try{for(;;)d=a(d,b.next())}catch(g){if(g!=e.StopIteration)throw g;
}return d},range:function(){var a=0,b=0,c=1;if(arguments.length==1)b=arguments[0];else if(arguments.length==2){a=arguments[0];b=arguments[1]}else if(arguments.length==3){a=arguments[0];b=arguments[1];c=arguments[2]}else throw new TypeError("range() takes 1, 2, or 3 arguments!");if(c===0)throw new TypeError("range() step must not be 0");return{next:function(){if(c>0&&a>=b||c<0&&a<=b)throw MochiKit.Iter.StopIteration;var d=a;a+=c;return d},repr:function(){return"range("+[a,b,c].join(", ")+")"},toString:MochiKit.Base.forwardCall("repr")}},
sum:function(a,b){if(typeof b=="undefined"||b===null)b=0;var c=b,d=MochiKit.Iter;a=d.iter(a);try{for(;;)c+=a.next()}catch(e){if(e!=d.StopIteration)throw e;}return c},exhaust:function(a){var b=MochiKit.Iter;a=b.iter(a);try{for(;;)a.next()}catch(c){if(c!=b.StopIteration)throw c;}},forEach:function(a,b,c){var d=MochiKit.Base,e=MochiKit.Iter;if(arguments.length>2)b=d.bind(b,c);if(d.isArrayLike(a)&&!e.isIterable(a))try{for(d=0;d<a.length;d++)b(a[d])}catch(f){if(f!=e.StopIteration)throw f;}else e.exhaust(e.imap(b,
a));return b},every:function(a,b){var c=MochiKit.Iter;try{c.ifilterfalse(b,a).next();return false}catch(d){if(d!=c.StopIteration)throw d;return true}},sorted:function(a,b){var c=MochiKit.Iter.list(a);if(arguments.length==1)b=MochiKit.Base.compare;c.sort(b);return c},reversed:function(a){a=MochiKit.Iter.list(a);a.reverse();return a},some:function(a,b){var c=MochiKit.Iter;try{c.ifilter(b,a).next();return true}catch(d){if(d!=c.StopIteration)throw d;return false}},iextend:function(a,b,c){c=c||0;var d=
MochiKit.Iter;if(MochiKit.Base.isArrayLike(b)&&!d.isIterable(b))for(c=c;c<b.length;c++)a.push(b[c]);else{b=d.iter(b);try{for(;c-- >0;)b.next();for(;;)a.push(b.next())}catch(e){if(e!=d.StopIteration)throw e;}}return a},groupby:function(a,b){var c=MochiKit.Base,d=MochiKit.Iter;if(arguments.length<2)b=c.operator.identity;a=d.iter(a);var e=undefined,f=undefined,g,h=true,i=c.compare;return{repr:function(){return"groupby(...)"},next:function(){for(;i(f,e)===0;){g=a.next();f=b(g);if(h){h=false;break}}e=
f;return[f,{next:function(){if(g==undefined){g=a.next();f=b(g)}if(i(f,e)!==0)throw d.StopIteration;var j=g;g=undefined;return j}}]}}},groupby_as_array:function(a,b){var c=MochiKit.Base,d=MochiKit.Iter;if(arguments.length<2)b=c.operator.identity;a=d.iter(a);var e=[],f=true,g;for(c=c.compare;;){try{var h=a.next(),i=b(h)}catch(j){if(j==d.StopIteration)break;throw j;}if(f||c(i,g)!==0){var k=[];e.push([i,k])}k.push(h);f=false;g=i}return e},arrayLikeIter:function(a){var b=0;return{repr:function(){return"arrayLikeIter(...)"},
toString:MochiKit.Base.forwardCall("repr"),next:function(){if(b>=a.length)throw MochiKit.Iter.StopIteration;return a[b++]}}},hasIterateNext:function(a){return a&&typeof a.iterateNext=="function"},iterateNextIter:function(a){return{repr:function(){return"iterateNextIter(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){var b=a.iterateNext();if(b===null||b===undefined)throw MochiKit.Iter.StopIteration;return b}}}});
MochiKit.Iter.__new__=function(){var a=MochiKit.Base;this.StopIteration=typeof StopIteration!="undefined"?StopIteration:new a.NamedError("StopIteration");this.iteratorRegistry=new a.AdapterRegistry;this.registerIteratorFactory("arrayLike",a.isArrayLike,this.arrayLikeIter);this.registerIteratorFactory("iterateNext",this.hasIterateNext,this.iterateNextIter);a.nameFunctions(this)};MochiKit.Iter.__new__();if(MochiKit.__export__)reduce=MochiKit.Iter.reduce;MochiKit.Base._exportSymbols(this,MochiKit.Iter);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Logging={};MochiKit.Base.module(MochiKit,"Logging","1.5",["Base"]);MochiKit.Logging.LogMessage=function(a,b,c){this.num=a;this.level=b;this.info=c;this.timestamp=new Date};MochiKit.Logging.LogMessage.prototype={repr:function(){var a=MochiKit.Base;return"LogMessage("+a.map(a.repr,[this.num,this.level,this.info]).join(", ")+")"},toString:MochiKit.Base.forwardCall("repr")};
MochiKit.Base.update(MochiKit.Logging,{logLevelAtLeast:function(a){var b=MochiKit.Logging;if(typeof a=="string")a=b.LogLevel[a];return function(c){c=c.level;if(typeof c=="string")c=b.LogLevel[c];return c>=a}},isLogMessage:function(){for(var a=MochiKit.Logging.LogMessage,b=0;b<arguments.length;b++)if(!(arguments[b]instanceof a))return false;return true},compareLogMessage:function(a,b){return MochiKit.Base.compare([a.level,a.info],[b.level,b.info])},alertListener:function(a){alert("num: "+a.num+"\nlevel: "+
a.level+"\ninfo: "+a.info.join(" "))}});MochiKit.Logging.Logger=function(a){this.counter=0;if(typeof a=="undefined"||a===null)a=-1;this.maxSize=a;this._messages=[];this.listeners={};this.useNativeConsole=false};
MochiKit.Logging.Logger.prototype={clear:function(){this._messages.splice(0,this._messages.length)},logToConsole:function(a){if(typeof window!="undefined"&&window.console&&window.console.log)window.console.log(a.replace(/%/g,"\uff05"));else if(typeof opera!="undefined"&&opera.postError)opera.postError(a);else if(typeof Debug!="undefined"&&Debug.writeln)Debug.writeln(a);else typeof debug!="undefined"&&debug.trace&&debug.trace(a)},dispatchListeners:function(a){for(var b in this.listeners){var c=this.listeners[b];
c.ident!=b||c[0]&&!c[0](a)||c[1](a)}},addListener:function(a,b,c){if(typeof b=="string")b=MochiKit.Logging.logLevelAtLeast(b);b=[b,c];b.ident=a;this.listeners[a]=b},removeListener:function(a){delete this.listeners[a]},baseLog:function(a){if(typeof a=="number")a=a>=MochiKit.Logging.LogLevel.FATAL?"FATAL":a>=MochiKit.Logging.LogLevel.ERROR?"ERROR":a>=MochiKit.Logging.LogLevel.WARNING?"WARNING":a>=MochiKit.Logging.LogLevel.INFO?"INFO":"DEBUG";var b=new MochiKit.Logging.LogMessage(this.counter,a,MochiKit.Base.extend(null,
arguments,1));this._messages.push(b);this.dispatchListeners(b);this.useNativeConsole&&this.logToConsole(b.level+": "+b.info.join(" "));for(this.counter+=1;this.maxSize>=0&&this._messages.length>this.maxSize;)this._messages.shift()},getMessages:function(a){var b=0;typeof a=="undefined"||a===null||(b=Math.max(0,this._messages.length-a));return this._messages.slice(b)},getMessageText:function(a){if(typeof a=="undefined"||a===null)a=30;a=this.getMessages(a);if(a.length){var b=MochiKit.Base.map(function(c){return"\n  ["+
c.num+"] "+c.level+": "+c.info.join(" ")},a);b.unshift("LAST "+a.length+" MESSAGES:");return b.join("")}return""},debuggingBookmarklet:function(a){typeof MochiKit.LoggingPane=="undefined"?alert(this.getMessageText()):MochiKit.LoggingPane.createLoggingPane(a||false)}};
MochiKit.Logging.__new__=function(){this.LogLevel={ERROR:40,FATAL:50,WARNING:30,INFO:20,DEBUG:10};var a=MochiKit.Base;a.registerComparator("LogMessage",this.isLogMessage,this.compareLogMessage);var b=a.partial,c=this.Logger,d=c.prototype.baseLog;a.update(this.Logger.prototype,{debug:b(d,"DEBUG"),log:b(d,"INFO"),error:b(d,"ERROR"),fatal:b(d,"FATAL"),warning:b(d,"WARNING")});var e=this;b=function(f){return function(){e.logger[f].apply(e.logger,arguments)}};this.log=b("log");this.logError=b("error");
this.logDebug=b("debug");this.logFatal=b("fatal");this.logWarning=b("warning");this.logger=new c;this.logger.useNativeConsole=true;a.nameFunctions(this)};MochiKit.Logging.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Logging);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.DateTime={};MochiKit.Base.module(MochiKit,"DateTime","1.5",["Base"]);MochiKit.DateTime.isoDate=function(a){a+="";if(typeof a!="string"||a.length===0)return null;a=a.split("-");if(a.length===0)return null;var b=new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10));b.setFullYear(a[0]);b.setMonth(a[1]-1);b.setDate(a[2]);return b};MochiKit.DateTime._isoRegexp=/(\d{4,})(?:-(\d{1,2})(?:-(\d{1,2})(?:[T ](\d{1,2}):(\d{1,2})(?::(\d{1,2})(?:\.(\d+))?)?(?:(Z)|([+-])(\d{1,2})(?::(\d{1,2}))?)?)?)?)?/;
MochiKit.DateTime.isoTimestamp=function(a){a+="";if(typeof a!="string"||a.length===0)return null;a=a.match(MochiKit.DateTime._isoRegexp);if(typeof a=="undefined"||a===null)return null;var b,c,d,e,f,g,h;b=parseInt(a[1],10);if(typeof a[2]=="undefined"||a[2]==="")return new Date(b);c=parseInt(a[2],10)-1;d=parseInt(a[3],10);if(typeof a[4]=="undefined"||a[4]==="")return new Date(b,c,d);e=parseInt(a[4],10);f=parseInt(a[5],10);g=typeof a[6]!="undefined"&&a[6]!==""?parseInt(a[6],10):0;h=typeof a[7]!="undefined"&&
a[7]!==""?Math.round(1E3*parseFloat("0."+a[7])):0;if((typeof a[8]=="undefined"||a[8]==="")&&(typeof a[9]=="undefined"||a[9]===""))return new Date(b,c,d,e,f,g,h);var i;if(typeof a[9]!="undefined"&&a[9]!==""){i=parseInt(a[10],10)*36E5;if(typeof a[11]!="undefined"&&a[11]!=="")i+=parseInt(a[11],10)*6E4;if(a[9]=="-")i=-i}else i=0;return new Date(Date.UTC(b,c,d,e,f,g,h)-i)};
MochiKit.DateTime.toISOTime=function(a,b){if(typeof a=="undefined"||a===null)return null;var c=MochiKit.DateTime._padTwo;if(b)a=new Date(a.getTime()+a.getTimezoneOffset()*6E4);return[b?c(a.getHours()):a.getHours(),c(a.getMinutes()),c(a.getSeconds())].join(":")+(b?"Z":"")};
MochiKit.DateTime.toISOTimestamp=function(a,b){if(typeof a=="undefined"||a===null)return null;var c=MochiKit.DateTime.toISOTime(a,b),d=b?"T":" ";if(b)a=new Date(a.getTime()+a.getTimezoneOffset()*6E4);return MochiKit.DateTime.toISODate(a)+d+c};MochiKit.DateTime.toISODate=function(a){if(typeof a=="undefined"||a===null)return null;var b=MochiKit.DateTime._padTwo,c=MochiKit.DateTime._padFour;return[c(a.getFullYear()),b(a.getMonth()+1),b(a.getDate())].join("-")};
MochiKit.DateTime.americanDate=function(a){a+="";if(typeof a!="string"||a.length===0)return null;a=a.split("/");return new Date(a[2],a[0]-1,a[1])};MochiKit.DateTime._padTwo=function(a){return a>9?a:"0"+a};MochiKit.DateTime._padFour=function(a){switch(a.toString().length){case 1:return"000"+a;case 2:return"00"+a;case 3:return"0"+a;default:return a}};
MochiKit.DateTime.toPaddedAmericanDate=function(a){if(typeof a=="undefined"||a===null)return null;var b=MochiKit.DateTime._padTwo;return[b(a.getMonth()+1),b(a.getDate()),a.getFullYear()].join("/")};MochiKit.DateTime.toAmericanDate=function(a){if(typeof a=="undefined"||a===null)return null;return[a.getMonth()+1,a.getDate(),a.getFullYear()].join("/")};MochiKit.DateTime.__new__=function(){MochiKit.Base.nameFunctions(this)};MochiKit.DateTime.__new__();MochiKit.Base._exportSymbols(this,MochiKit.DateTime);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Format={};MochiKit.Base.module(MochiKit,"Format","1.5",["Base"]);
MochiKit.Format._numberFormatter=function(a,b,c,d,e,f,g,h,i){return function(j){j=parseFloat(j);if(typeof j=="undefined"||j===null||isNaN(j))return a;var k=b,l=c;if(j<0)j=-j;else k=k.replace(/-/,"");var m=MochiKit.Format.formatLocale(d);if(e){j*=100;l=m.percent+l}j=MochiKit.Format.roundToFixed(j,f);var o=j.split(/\./);j=o[0];o=o.length==1?"":o[1];for(var p="";j.length<g;)j="0"+j;if(h)for(;j.length>h;){var q=j.length-h;p=m.separator+j.substring(q,j.length)+p;j=j.substring(0,q)}p=j+p;if(f>0){for(;o.length<
i;)o+="0";p=p+m.decimal+o}return k+p+l}};
MochiKit.Format.numberFormatter=function(a,b,c){if(typeof b=="undefined")b="";var d=a.match(/((?:[0#]+,)?[0#]+)(?:\.([0#]+))?(%)?/);if(!d)throw TypeError("Invalid pattern");var e=a.substr(0,d.index),f=a.substr(d.index+d[0].length);if(e.search(/-/)==-1)e+="-";var g=d[1],h=typeof d[2]=="string"&&d[2]!=""?d[2]:"";d=typeof d[3]=="string"&&d[3]!="";var i=g.split(/,/);if(typeof c=="undefined")c="default";i=i.length==1?null:i[1].length;g=g.length-g.replace(/0/g,"").length;var j=h.length-h.replace(/0/g,"").length;
e=MochiKit.Format._numberFormatter(b,e,f,c,d,h.length,g,i,j);var k=MochiKit.Base;if(k){var l=k.concat(arguments);e.repr=function(){return[self.NAME,"(",k.map(k.repr,l).join(", "),")"].join("")}}return e};MochiKit.Format.formatLocale=function(a){if(typeof a=="undefined"||a===null)a="default";if(typeof a=="string"){var b=MochiKit.Format.LOCALE[a];if(typeof b=="string"){b=arguments.callee(b);MochiKit.Format.LOCALE[a]=b}return b}else return a};
MochiKit.Format.twoDigitAverage=function(a,b){if(b){var c=a/b;if(!isNaN(c))return MochiKit.Format.twoDigitFloat(c)}return"0"};MochiKit.Format.twoDigitFloat=function(a){a=MochiKit.Format.roundToFixed(a,2);return a.indexOf(".00")>0?a.substring(0,a.length-3):a.charAt(a.length-1)=="0"?a.substring(0,a.length-1):a};MochiKit.Format.lstrip=function(a,b){a+="";if(typeof a!="string")return null;return b?a.replace(RegExp("^["+b+"]+"),""):a.replace(/^\s+/,"")};
MochiKit.Format.rstrip=function(a,b){a+="";if(typeof a!="string")return null;return b?a.replace(RegExp("["+b+"]+$"),""):a.replace(/\s+$/,"")};MochiKit.Format.strip=function(a,b){var c=MochiKit.Format;return c.rstrip(c.lstrip(a,b),b)};MochiKit.Format.truncToFixed=function(a,b){var c=MochiKit.Format._numberToFixed(a,b),d=c.indexOf(".");if(d>0&&d+b+1<c.length){c=c.substring(0,d+b+1);c=MochiKit.Format._shiftNumber(c,0)}return c};
MochiKit.Format.roundToFixed=function(a,b){var c=MochiKit.Format._numberToFixed(a,b),d=c.indexOf(".");if(d>0&&d+b+1<c.length){c=MochiKit.Format._shiftNumber(c,b);c=MochiKit.Format._numberToFixed(Math.round(parseFloat(c)),0);c=MochiKit.Format._shiftNumber(c,-b)}return c};
MochiKit.Format._numberToFixed=function(a,b){var c=a.toString().split(/[eE]/),d=c.length===1?0:parseInt(c[1],10)||0;c=MochiKit.Format._shiftNumber(c[0],d).split(/\./);d=c[0];for(c=c.length===1?"":c[1];c.length<b;)c+="0";return c.length>0?d+"."+c:d};
MochiKit.Format._shiftNumber=function(a,b){var c=a.indexOf(".");if(c<0)c=a.length;else a=a.substring(0,c)+a.substring(c+1);for(c+=b;c<=0||c<=1&&a.charAt(0)==="-";){a=a.charAt(0)==="-"?"-0"+a.substring(1):"0"+a;c++}for(;c>a.length;)a+="0";if(c<a.length)a=a.substring(0,c)+"."+a.substring(c);for(;/^0[^.]/.test(a);)a=a.substring(1);for(;/^-0[^.]/.test(a);)a="-"+a.substring(2);return a};MochiKit.Format.percentFormat=function(a){return MochiKit.Format.twoDigitFloat(100*a)+"%"};
MochiKit.Format.LOCALE={en_US:{separator:",",decimal:".",percent:"%"},de_DE:{separator:".",decimal:",",percent:"%"},pt_BR:{separator:".",decimal:",",percent:"%"},fr_FR:{separator:" ",decimal:",",percent:"%"},"default":"en_US",__export__:false};MochiKit.Format.__new__=function(){MochiKit.Base.nameFunctions(this);var a=this.NAME+".",b,c;for(b in this.LOCALE){c=this.LOCALE[b];if(typeof c=="object"){c.repr=function(){return this.NAME};c.NAME=a+"LOCALE."+b}}};MochiKit.Format.__new__();
MochiKit.Base._exportSymbols(this,MochiKit.Format);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Text={};MochiKit.Base.module(MochiKit,"Text","1.5",["Base","Format"]);MochiKit.Text.startsWith=function(a,b){return b!=null&&a!=null&&b.indexOf(a)==0};MochiKit.Text.endsWith=function(a,b){return b!=null&&a!=null&&b.lastIndexOf(a)==Math.max(b.length-a.length,0)};MochiKit.Text.contains=function(a,b){return b!=null&&a!=null&&b.indexOf(a)>=0};MochiKit.Text.padLeft=function(a,b,c){a=a||"";for(c=c||" ";a.length<b;)a=c+a;return a};
MochiKit.Text.padRight=function(a,b,c){a=a||"";for(c=c||" ";a.length<b;)a+=c;return a};MochiKit.Text.truncate=function(a,b,c){if(a==null||a.length<=b||b<0)return a;else if(c!=null){a=a.slice(0,Math.max(0,b-c.length));return typeof a=="string"?a+c:MochiKit.Base.extend(a,c)}else return a.slice(0,b)};MochiKit.Text.split=function(a,b,c){if(a==null)return a;b=b||"\n";a=a.split(b);if(typeof c=="undefined"||c>=a.length-1)return a;a.splice(c,a.length,a.slice(c,a.length).join(b));return a};
MochiKit.Text.rsplit=function(a,b,c){if(a==null)return a;b=b||"\n";a=a.split(b);if(typeof c=="undefined"||c>=a.length-1)return a;a.splice(0,a.length-c,a.slice(0,a.length-c).join(b));return a};
MochiKit.Text.formatter=function(a,b){if(typeof b=="undefined")b=MochiKit.Format.formatLocale();else if(typeof b=="string")b=MochiKit.Format.formatLocale(b);var c=MochiKit.Text._parsePattern(a);return function(){for(var d=MochiKit.Base.extend([],arguments),e=[],f=0;f<c.length;f++)typeof c[f]=="string"?e.push(c[f]):e.push(MochiKit.Text.formatValue(c[f],d,b));return e.join("")}};MochiKit.Text.format=function(a){return MochiKit.Text.formatter(a).apply(this,MochiKit.Base.extend([],arguments,1))};
MochiKit.Text.formatValue=function(a,b,c){var d=MochiKit.Text;if(typeof a==="string")a=d._parseFormatFlags(a,0,a.length-1);for(var e=0;a.path!=null&&e<a.path.length;e++)if(b!=null)b=b[a.path[e]];if(typeof c=="undefined")c=MochiKit.Format.formatLocale();else if(typeof c=="string")c=MochiKit.Format.formatLocale(c);e="";if(a.numeric){if(typeof b!="number"||isNaN(b))e="";else if(b===Number.POSITIVE_INFINITY)e="\u221e";else if(b===Number.NEGATIVE_INFINITY)e="-\u221e";else{var f=a.sign==="-"?"":a.sign;
f=b<0?"-":f;b=Math.abs(b);if(a.format==="%")e=d._truncToPercent(b,a.precision);else if(a.format==="d")e=MochiKit.Format.roundToFixed(b,0);else if(a.radix!=10){e=Math.floor(b).toString(a.radix);if(a.format==="x")e=e.toLowerCase();else if(a.format==="X")e=e.toUpperCase()}else e=a.precision>=0?MochiKit.Format.roundToFixed(b,a.precision):b.toString();if(a.padding==="0"&&a.format==="%")e=d.padLeft(e,a.width-f.length-1,"0");else if(a.padding=="0")e=d.padLeft(e,a.width-f.length,"0");e=d._localizeNumber(e,
c,a.grouping);e=f+e}if(e!==""&&a.format==="%")e+=c.percent}else{e=a.format=="r"?MochiKit.Base.repr(b):b==null?"null":b.toString();e=d.truncate(e,a.precision)}return e=a.align=="<"?d.padRight(e,a.width):d.padLeft(e,a.width)};
MochiKit.Text._localizeNumber=function(a,b,c){var d=a.split(/\./);a=d[0];var e=d.length==1?"":d[1];for(d=e.length>0?b.decimal:"";c&&e.length>3;){d=d+e.substring(0,3)+b.separator;e=e.substring(3);if(a.charAt(0)=="0")a=a.substring(1)}if(e.length>0)d+=e;for(;c&&a.length>3;){e=a.length-3;d=b.separator+a.substring(e)+d;a=a.substring(a.charAt(0)=="0"?1:0,e)}return a+d};
MochiKit.Text._parsePattern=function(a){for(var b=MochiKit.Text,c=[],d=/{[^{}]*}|{{?|}}?/g,e=d.lastIndex=0,f;(f=d.exec(a))!=null;){e<f.index&&c.push(a.substring(e,f.index));var g=f[0];e=f.index+g.length;if(b.startsWith("{",g)&&b.endsWith("}",g))c.push(b._parseFormat(a,f.index+1,e-1));else if(b.startsWith("{{",g)||b.startsWith("}}",g))c.push(g.substring(1));else if(b.startsWith("{",g)){c="unescaped { char, should be escaped as {{";throw new b.FormatPatternError(a,f.index,c);}else if(b.startsWith("}",
g)){c="unescaped } char, should be escaped as }}";throw new b.FormatPatternError(a,f.index,c);}}e<a.length&&c.push(a.substring(e));return c};
MochiKit.Text._parseFormat=function(a,b,c){var d=MochiKit.Text,e=a.substring(b,c),f=d.split(e,":",1);e=f[0];c=d._parseFormatFlags(a,b+e.length+(f.length==1?0:1),c);c.path=e==""?[]:e.split(".");for(e=0;e<c.path.length;e++){f=c.path[e];f=f.replace(/^\s+/,"").replace(/\s+$/,"");if(f==""&&c.path.length==1)f=0;else if(f=="")throw new d.FormatPatternError(a,b,"format value path contains blanks");else if(/^\d+$/.test(f))f=parseInt(f,10);c.path[e]=f}if(c.path.length<=0||typeof c.path[0]!="number")c.path.unshift(0);
return c};
MochiKit.Text._parseFormatFlags=function(a,b,c){var d=MochiKit.Base.update,e={numeric:false,format:"s",width:0,precision:-1,align:">",sign:"-",padding:" ",grouping:false},f=/^([<>+ 0,-]+)?(\d+)?(\.\d*)?([srbdoxXf%])?(.*)$/.exec(a.substring(b,c).replace(/\s+$/,""));c=f[1];var g=f[2],h=f[3],i=f[4];f=f[5];for(var j=0;c&&j<c.length;j++){var k=c.charAt(j);if(k=="<"||k==">")e.align=k;else if(k=="+"||k=="-"||k==" ")e.sign=k;else if(k=="0")e.padding=k;else if(k==",")e.grouping=true}if(g)e.width=parseInt(g,
10);if(h&&h.length>1)e.precision=parseInt(h.substring(1),10);if(i=="s"||i=="r")e.format=i;else if(i=="b")d(e,{numeric:true,format:i,radix:2});else if(i=="o")d(e,{numeric:true,format:i,radix:8});else if(i=="x"||i=="X")d(e,{numeric:true,format:i,radix:16});else if(i=="d"||i=="f"||i=="%")d(e,{numeric:true,format:i,radix:10});if(f){d="unsupported format flag: "+f.charAt(0);throw new MochiKit.Text.FormatPatternError(a,b,d);}return e};
MochiKit.Text._truncToPercent=function(a,b){var c;c=b>=0?MochiKit.Format.roundToFixed(a,b+2):a==null?"0":a.toString();var d=MochiKit.Text.split(c,".",2);c=MochiKit.Text.padRight(d[1],2,"0");d=d[0]+c.substring(0,2);for(c=c.substring(2);/^0[0-9]/.test(d);)d=d.substring(1);return c.length<=0?d:d+"."+c};MochiKit.Text.FormatPatternError=function(a,b,c){this.pattern=a;this.pos=b;this.message=c};MochiKit.Text.FormatPatternError.prototype=new MochiKit.Base.NamedError("MochiKit.Text.FormatPatternError");
MochiKit.Text.FormatPatternError.constructor=MochiKit.Text.FormatPatternError;if(MochiKit.__export__){formatter=MochiKit.Text.formatter;format=MochiKit.Text.format;formatValue=MochiKit.Text.formatValue}MochiKit.Base.nameFunctions(MochiKit.Text);MochiKit.Base._exportSymbols(this,MochiKit.Text);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Async={};MochiKit.Base.module(MochiKit,"Async","1.5",["Base"]);MochiKit.Async.Deferred=function(a){this.chain=[];this.id=this._nextId();this.fired=-1;this.paused=0;this.results=[null,null];this.canceller=a;this.finalized=this.chained=this.silentlyCancelled=false};MochiKit.Async.Deferred.prototype.repr=function(){return"Deferred("+this.id+", "+this.state()+")"};MochiKit.Async.Deferred.prototype.toString=MochiKit.Base.forwardCall("repr");
MochiKit.Async.Deferred.prototype._nextId=MochiKit.Base.counter();MochiKit.Async.Deferred.prototype.state=function(){return this.fired==-1?"unfired":this.fired===0?"success":"error"};
MochiKit.Async.Deferred.prototype.cancel=function(a){var b=MochiKit.Async;if(this.fired==-1){if(this.canceller)this.canceller(this);else this.silentlyCancelled=true;if(this.fired==-1){if(typeof a==="string")a=new b.GenericError(a);else a instanceof Error||(a=new b.CancelledError(this));this.errback(a)}}else this.fired===0&&this.results[0]instanceof b.Deferred&&this.results[0].cancel(a)};
MochiKit.Async.Deferred.prototype._resback=function(a){this.fired=a instanceof Error?1:0;this.results[this.fired]=a;this.paused===0&&this._fire()};MochiKit.Async.Deferred.prototype._check=function(){if(this.fired!=-1){if(!this.silentlyCancelled)throw new MochiKit.Async.AlreadyCalledError(this);this.silentlyCancelled=false}};
MochiKit.Async.Deferred.prototype.callback=function(a){this._check();if(a instanceof MochiKit.Async.Deferred)throw Error("Deferred instances can only be chained if they are the result of a callback");this._resback(a)};MochiKit.Async.Deferred.prototype.errback=function(a){this._check();var b=MochiKit.Async;if(a instanceof b.Deferred)throw Error("Deferred instances can only be chained if they are the result of a callback");a instanceof Error||(a=new b.GenericError(a));this._resback(a)};
MochiKit.Async.Deferred.prototype.addBoth=function(a){if(arguments.length>1)a=MochiKit.Base.partial.apply(null,arguments);return this.addCallbacks(a,a)};MochiKit.Async.Deferred.prototype.addCallback=function(a){if(arguments.length>1)a=MochiKit.Base.partial.apply(null,arguments);return this.addCallbacks(a,null)};MochiKit.Async.Deferred.prototype.addErrback=function(a){if(arguments.length>1)a=MochiKit.Base.partial.apply(null,arguments);return this.addCallbacks(null,a)};
MochiKit.Async.Deferred.prototype.addCallbacks=function(a,b){if(this.chained)throw Error("Chained Deferreds can not be re-used");if(this.finalized)throw Error("Finalized Deferreds can not be re-used");this.chain.push([a,b]);this.fired>=0&&this._fire();return this};
MochiKit.Async.Deferred.prototype.setFinalizer=function(a){if(this.chained)throw Error("Chained Deferreds can not be re-used");if(this.finalized)throw Error("Finalized Deferreds can not be re-used");if(arguments.length>1)a=MochiKit.Base.partial.apply(null,arguments);this._finalizer=a;this.fired>=0&&this._fire();return this};
MochiKit.Async.Deferred.prototype._fire=function(){for(var a=this.chain,b=this.fired,c=this.results[b],d=this,e=null;a.length>0&&this.paused===0;){var f=a.shift()[b];if(f!==null)try{var g=f(c);if(g!==undefined)c=g;b=c instanceof Error?1:0;if(c instanceof MochiKit.Async.Deferred){e=function(i){d.paused--;d._resback(i)};this.paused++}}catch(h){b=1;h instanceof Error||(h=new MochiKit.Async.GenericError(h));c=h}}this.fired=b;this.results[b]=c;if(this.chain.length==0&&this.paused===0&&this._finalizer){this.finalized=
true;this._finalizer(c)}if(e&&this.paused){c.addBoth(e);c.chained=true}};
MochiKit.Base.update(MochiKit.Async,{evalJSONRequest:function(a){return MochiKit.Base.evalJSON(a.responseText)},succeed:function(){var a=new MochiKit.Async.Deferred;a.callback.apply(a,arguments);return a},fail:function(){var a=new MochiKit.Async.Deferred;a.errback.apply(a,arguments);return a},getXMLHttpRequest:function(){var a=arguments.callee;if(!a.XMLHttpRequest)for(var b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")},
function(){return new ActiveXObject("Msxml2.XMLHTTP.4.0")},function(){throw new MochiKit.Async.BrowserComplianceError("Browser does not support XMLHttpRequest");}],c=0;c<b.length;c++){var d=b[c];try{a.XMLHttpRequest=d;return d()}catch(e){}}return a.XMLHttpRequest()},_xhr_onreadystatechange:function(a){var b=MochiKit.Base;if(this.readyState==4){try{this.onreadystatechange=null}catch(c){try{this.onreadystatechange=b.noop}catch(d){}}var e=null;try{e=this.status;if(!e&&b.isNotEmpty(this.responseText))e=
304}catch(f){}if(e==200||e==201||e==204||e==304||e==1223)a.callback(this);else{b=new MochiKit.Async.XMLHttpRequestError(this,"Request failed");a.errback(b)}}},_xhr_canceller:function(a){try{a.onreadystatechange=null}catch(b){try{a.onreadystatechange=MochiKit.Base.noop}catch(c){}}a.abort()},sendXMLHttpRequest:function(a,b){if(typeof b=="undefined"||b===null)b="";var c=MochiKit.Base,d=MochiKit.Async,e=new d.Deferred(c.partial(d._xhr_canceller,a));try{a.onreadystatechange=c.bind(d._xhr_onreadystatechange,
a,e);a.send(b)}catch(f){try{a.onreadystatechange=null}catch(g){}e.errback(f)}return e},doXHR:function(a,b){var c=MochiKit.Async;return c.callLater(0,c._doXHR,a,b)},_doXHR:function(a,b){var c=MochiKit.Base;b=c.update({method:"GET",sendContent:"",async:true},b);var d=MochiKit.Async,e=d.getXMLHttpRequest();if(b.queryString){var f=c.queryString(b.queryString);if(f)a+="?"+f}"username"in b?e.open(b.method,a,b.async,b.username,b.password):e.open(b.method,a,b.async);e.overrideMimeType&&b.mimeType&&e.overrideMimeType(b.mimeType);
e.setRequestHeader("X-Requested-With","XMLHttpRequest");if(b.headers){f=b.headers;c.isArrayLike(f)||(f=c.items(f));for(c=0;c<f.length;c++){var g=f[c];e.setRequestHeader(g[0],g[1])}}return d.sendXMLHttpRequest(e,b.sendContent)},_buildURL:function(a){if(arguments.length>1){var b=MochiKit.Base;if(b=b.queryString.apply(null,b.extend(null,arguments,1)))return a+"?"+b}return a},doSimpleXMLHttpRequest:function(a){var b=MochiKit.Async;a=b._buildURL.apply(b,arguments);return b.doXHR(a)},loadJSONDoc:function(a){var b=
MochiKit.Async;a=b._buildURL.apply(b,arguments);var c=b.doXHR(a,{mimeType:"text/plain",headers:[["Accept","application/json"]]});return c=c.addCallback(b.evalJSONRequest)},loadScript:function(a){var b=new MochiKit.Async.Deferred,c=document.createElement("script");c.type="text/javascript";c.src=a;c.onload=function(){c.onload=null;c.onerror=null;c=c.onreadystatechange=null;b.callback()};c.onerror=function(d){c.onload=null;c.onerror=null;c=c.onreadystatechange=null;d="Failed to load script at "+a+": "+
d;b.errback(new URIError(d,a))};c.onreadystatechange=function(){c.readyState=="loaded"||c.readyState=="complete"?c.onload():MochiKit.Async.callLater(10,c.onerror,"Script loading timed out")};document.getElementsByTagName("head")[0].appendChild(c);return b},wait:function(a,b){var c=new MochiKit.Async.Deferred,d=MochiKit.Base.bind("callback",c,b),e=setTimeout(d,Math.floor(a*1E3));c.canceller=function(){try{clearTimeout(e)}catch(f){}};return c},callLater:function(a){var b=MochiKit.Base,c=b.partial.apply(b,
b.extend(null,arguments,1));return MochiKit.Async.wait(a).addCallback(function(){return c()})}});MochiKit.Async.DeferredLock=function(){this.waiting=[];this.locked=false;this.id=this._nextId()};MochiKit.Async.DeferredLock.prototype.__class__=MochiKit.Async.DeferredLock;MochiKit.Async.DeferredLock.prototype.acquire=function(){var a=new MochiKit.Async.Deferred;if(this.locked)this.waiting.push(a);else{this.locked=true;a.callback(this)}return a};
MochiKit.Async.DeferredLock.prototype.release=function(){if(!this.locked)throw TypeError("Tried to release an unlocked DeferredLock");this.locked=false;if(this.waiting.length>0){this.locked=true;this.waiting.shift().callback(this)}};MochiKit.Async.DeferredLock.prototype._nextId=MochiKit.Base.counter();MochiKit.Async.DeferredLock.prototype.repr=function(){return"DeferredLock("+this.id+", "+(this.locked?"locked, "+this.waiting.length+" waiting":"unlocked")+")"};
MochiKit.Async.DeferredLock.prototype.toString=MochiKit.Base.forwardCall("repr");MochiKit.Async.DeferredList=function(a,b,c,d,e){MochiKit.Async.Deferred.apply(this,[e]);this.list=a;this.resultList=e=[];this.finishedCount=0;this.fireOnOneCallback=b;this.fireOnOneErrback=c;this.consumeErrors=d;c=MochiKit.Base.bind(this._cbDeferred,this);for(d=0;d<a.length;d++){var f=a[d];e.push(undefined);f.addCallback(c,d,true);f.addErrback(c,d,false)}a.length===0&&!b&&this.callback(this.resultList)};
MochiKit.Async.DeferredList.prototype=new MochiKit.Async.Deferred;MochiKit.Async.DeferredList.prototype.constructor=MochiKit.Async.DeferredList;MochiKit.Async.DeferredList.prototype._cbDeferred=function(a,b,c){this.resultList[a]=[b,c];this.finishedCount+=1;if(this.fired==-1)if(b&&this.fireOnOneCallback)this.callback([a,c]);else if(!b&&this.fireOnOneErrback)this.errback(c);else this.finishedCount==this.list.length&&this.callback(this.resultList);if(!b&&this.consumeErrors)c=null;return c};
MochiKit.Async.gatherResults=function(a){a=new MochiKit.Async.DeferredList(a,false,true,false);a.addCallback(function(b){for(var c=[],d=0;d<b.length;d++)c.push(b[d][1]);return c});return a};MochiKit.Async.maybeDeferred=function(a){var b=MochiKit.Async,c;try{var d=a.apply(null,MochiKit.Base.extend([],arguments,1));c=d instanceof b.Deferred?d:d instanceof Error?b.fail(d):b.succeed(d)}catch(e){c=b.fail(e)}return c};
MochiKit.Async.__new__=function(){var a=MochiKit.Base,b=a.partial(a._newNamedError,this);b("AlreadyCalledError",function(c){this.deferred=c});b("CancelledError",function(c){this.deferred=c});b("BrowserComplianceError",function(c){this.message=c});b("GenericError",function(c){this.message=c});b("XMLHttpRequestError",function(c,d){this.req=c;this.message=d;try{this.number=c.status}catch(e){}});a.nameFunctions(this)};MochiKit.Async.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Async);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.DOM={};MochiKit.Base.module(MochiKit,"DOM","1.5",["Base"]);
MochiKit.Base.update(MochiKit.DOM,{currentWindow:function(){return MochiKit.DOM._window},currentDocument:function(){return MochiKit.DOM._document},withWindow:function(a,b){var c=MochiKit.DOM,d=c._document,e=c._window,f;try{c._window=a;c._document=a.document;f=b()}catch(g){c._window=e;c._document=d;throw g;}c._window=e;c._document=d;return f},formContents:function(a){var b=[],c=[],d=MochiKit.Base,e=MochiKit.DOM;a=typeof a=="undefined"||a===null?e._document.body:e.getElement(a);d.nodeWalk(a,function(f){var g=
f.name;if(d.isNotEmpty(g)){var h=f.tagName.toUpperCase();if(h==="INPUT"&&(f.type=="radio"||f.type=="checkbox")&&!f.checked)return null;if(h==="SELECT"){if(f.type=="select-one"){if(f.selectedIndex>=0){f=f.options[f.selectedIndex];h=f.value;if(!h){var i=f.outerHTML;if(i&&!i.match(/^[^>]+\svalue\s*=/i))h=f.text}b.push(g);c.push(h);return null}b.push(g);c.push("")}else{var j=f.options;if(!j.length){b.push(g);c.push("");return null}for(var k=0;k<j.length;k++){f=j[k];if(f.selected){h=f.value;if(!h)if((i=
f.outerHTML)&&!i.match(/^[^>]+\svalue\s*=/i))h=f.text;b.push(g);c.push(h)}}}return null}if(h==="FORM"||h==="P"||h==="SPAN"||h==="DIV")return f.childNodes;b.push(g);c.push(f.value||"");return null}return f.childNodes});return[b,c]},withDocument:function(a,b){var c=MochiKit.DOM,d=c._document,e;try{c._document=a;e=b()}catch(f){c._document=d;throw f;}c._document=d;return e},registerDOMConverter:function(a,b,c,d){MochiKit.DOM.domConverters.register(a,b,c,d)},coerceToDOM:function(a,b){var c=MochiKit.Base,
d=MochiKit.Iter,e=MochiKit.DOM;if(d)var f=d.iter,g=d.repeat;for(var h=c.map,i=e.domConverters,j=arguments.callee,k=c.NotFound;;){if(typeof a=="undefined"||a===null)return null;if(typeof a=="function"&&typeof a.length=="number"&&!(a instanceof Function))a=d?d.list(a):c.extend(null,a);if(typeof a.nodeType!="undefined"&&a.nodeType>0)return a;if(typeof a=="number"||typeof a=="boolean")a=a.toString();if(typeof a=="string")return e._document.createTextNode(a);if(typeof a.__dom__=="function")a=a.__dom__(b);
else if(typeof a.dom=="function")a=a.dom(b);else if(typeof a=="function")a=a.apply(b,[b]);else{if(d){var l=null;try{l=f(a)}catch(m){}if(l)return h(j,l,g(b))}else if(c.isArrayLike(a))return h(function(p){return j(p,b)},a);try{a=i.match(a,b);continue}catch(o){if(o!=k)throw o;}return e._document.createTextNode(a.toString())}}},isChildNode:function(a,b){var c=MochiKit.DOM;if(typeof a=="string")a=c.getElement(a);if(typeof b=="string")b=c.getElement(b);if(typeof a=="undefined"||a===null)return false;for(;a!=
null&&a!==c._document;){if(a===b)return true;a=a.parentNode}return false},setNodeAttribute:function(a,b,c){var d={};d[b]=c;try{return MochiKit.DOM.updateNodeAttributes(a,d)}catch(e){}return null},getNodeAttribute:function(a,b){var c=MochiKit.DOM,d=c.attributeArray.renames[b],e=c.attributeArray.ignoreAttr[b];a=c.getElement(a);try{if(d)return a[d];var f=a.getAttribute(b);if(f!=e)return f}catch(g){}return null},removeNodeAttribute:function(a,b){var c=MochiKit.DOM,d=c.attributeArray.renames[b];a=c.getElement(a);
try{if(d)return a[d];return a.removeAttribute(b)}catch(e){}return null},updateNodeAttributes:function(a,b){var c=a,d=MochiKit.DOM,e=MochiKit.Base;if(typeof a=="string")c=d.getElement(a);if(b)if(d.attributeArray.compliant)for(var f in b){d=b[f];if(typeof d=="object"&&typeof c[f]=="object")f=="style"&&MochiKit.Style?MochiKit.Style.setStyle(c,d):e.updatetree(c[f],d);else if(f.substring(0,2)=="on"){if(typeof d=="string")d=new Function(d);c[f]=d}else c.setAttribute(f,d);if(e.isValue(c[f])&&c[f]!=d)c[f]=
d}else{var g=d.attributeArray.renames;for(f in b){d=b[f];var h=g[f];if(f=="style"&&typeof d=="string")c.style.cssText=d;else if(typeof h=="string")c[h]=d;else if(typeof c[f]=="object"&&typeof d=="object")f=="style"&&MochiKit.Style?MochiKit.Style.setStyle(c,d):e.updatetree(c[f],d);else if(f.substring(0,2)=="on"){if(typeof d=="string")d=new Function(d);c[f]=d}else c.setAttribute(f,d);if(e.isValue(c[f])&&c[f]!=d)c[f]=d}}return c},appendChildNodes:function(a){var b=a,c=MochiKit.DOM;if(typeof a=="string")b=
c.getElement(a);c=[c.coerceToDOM(MochiKit.Base.extend(null,arguments,1),b)];for(var d=MochiKit.Base.concat;c.length;){var e=c.shift();if(!(typeof e=="undefined"||e===null))if(typeof e.nodeType=="number")b.appendChild(e);else c=d(e,c)}return b},insertSiblingNodesBefore:function(a){var b=a,c=MochiKit.DOM;if(typeof a=="string")b=c.getElement(a);c=[c.coerceToDOM(MochiKit.Base.extend(null,arguments,1),b)];for(var d=b.parentNode,e=MochiKit.Base.concat;c.length;){var f=c.shift();if(!(typeof f=="undefined"||
f===null))if(typeof f.nodeType=="number")d.insertBefore(f,b);else c=e(f,c)}return d},insertSiblingNodesAfter:function(a){var b=a,c=MochiKit.DOM;if(typeof a=="string")b=c.getElement(a);var d=[c.coerceToDOM(MochiKit.Base.extend(null,arguments,1),b)];return b.nextSibling?c.insertSiblingNodesBefore(b.nextSibling,d):c.appendChildNodes(b.parentNode,d)},replaceChildNodes:function(a){var b=a,c=MochiKit.DOM;if(typeof a=="string"){b=c.getElement(a);arguments[0]=b}for(var d;d=b.firstChild;)b.removeChild(d);
return arguments.length<2?b:c.appendChildNodes.apply(this,arguments)},createDOM:function(a,b){var c,d=MochiKit.DOM,e=MochiKit.Base;if(typeof b=="string"||typeof b=="number"){e=e.extend([a,null],arguments,1);return arguments.callee.apply(this,e)}if(typeof a=="string"){c=d._xhtml;if(b&&!d.attributeArray.compliant){var f="";if("name"in b)f+=' name="'+d.escapeHTML(b.name)+'"';if(a=="input"&&"type"in b)f+=' type="'+d.escapeHTML(b.type)+'"';if(f){a="<"+a+f+">";c=false}}f=d._document;c=c&&f===document?f.createElementNS("http://www.w3.org/1999/xhtml",
a):f.createElement(a)}else c=a;b&&d.updateNodeAttributes(c,b);if(arguments.length<=2)return c;else{e=e.extend([c],arguments,2);return d.appendChildNodes.apply(this,e)}},createDOMFunc:function(){var a=MochiKit.Base;return a.partial.apply(this,a.extend([MochiKit.DOM.createDOM],arguments))},removeElement:function(a){var b=MochiKit.DOM;if(typeof a=="string")a=b.getElement(a);(a=b.coerceToDOM(a))&&a.parentNode&&a.parentNode.removeChild(a);return a},swapDOM:function(a,b){var c=MochiKit.DOM;a=c.getElement(a);
var d=a.parentNode;if(b){if(typeof b=="string")b=c.getElement(b);b=c.coerceToDOM(b,d);d.replaceChild(b,a)}else d.removeChild(a);return b},getElement:function(a){var b=MochiKit.DOM;return arguments.length==1?typeof a=="string"?b._document.getElementById(a):a:MochiKit.Base.map(b.getElement,arguments)},getElementsByClassName:function(a,b){var c=MochiKit.DOM;c.getElementsByClassName=c._document.getElementsByClassName?function(d,e){e=e||c._document;e=c.getElement(e);var f=e.getElementsByClassName(d);return MochiKit.Base.extend([],
f)}:c._document.evaluate?function(d,e){e=e||c._document;e=c.getElement(e);for(var f=d.split(" "),g="",h=0,i=f.length;h<i;++h)g+="[contains(concat(' ', @class, ' '), ' "+f[h]+" ')]";f=[];try{f=c._document.evaluate(".//*"+g,e,c._document.documentElement.namespaceURI==="http://www.w3.org/1999/xhtml"?"http://www.w3.org/1999/xhtml":null,0,null)}catch(j){f=c._document.evaluate(".//*"+g,e,null,0,null)}return MochiKit.Iter.list(f)}:function(d,e){e=e||c._document;e=c.getElement(e);for(var f=d.split(" "),g=
[],h=0,i=f.length;h<i;++h)g.push(RegExp("(^|\\s)"+f[h]+"(\\s|$)"));f=e.all?e.all:e.getElementsByTagName("*");h=[];i=0;for(var j=f.length;i<j;++i){for(var k=f[i],l=false,m=0,o=g.length;m<o;++m){l=g[m].test(k.className);if(!l)break}l&&h.push(k)}return h};return c.getElementsByClassName(a,b)},getElementsByTagAndClassName:function(a,b,c){var d=MochiKit.DOM;if(typeof a=="undefined"||a===null)a="*";if(typeof c=="undefined"||c===null)c=d._document;c=d.getElement(c);if(c==null)return[];if(a=="*")return d.getElementsByClassName(b,
c);a=c.getElementsByTagName(a)||d._document.all;if(typeof b=="undefined"||b===null)return MochiKit.Base.extend(null,a);c=[];for(d=0;d<a.length;d++){var e=a[d],f=e.className;if(typeof f!="string")f=e.getAttribute("class");if(typeof f=="string"){f=f.split(" ");for(var g=0;g<f.length;g++)if(f[g]==b){c.push(e);break}}}return c},_newCallStack:function(a,b){var c=function(){for(var d=arguments.callee.callStack,e=0;e<d.length;e++)if(d[e].apply(this,arguments)===false)break;if(b)try{this[a]=null}catch(f){}};
c.callStack=[];return c},addToCallStack:function(a,b,c,d){var e=MochiKit.DOM,f=a[b],g=f;if(!(typeof f=="function"&&typeof f.callStack=="object"&&f.callStack!==null)){g=e._newCallStack(b,d);typeof f=="function"&&g.callStack.push(f);a[b]=g}g.callStack.push(c)},addLoadEvent:function(a){var b=MochiKit.DOM;b.addToCallStack(b._window,"onload",a,true)},focusOnLoad:function(a){var b=MochiKit.DOM;b.addLoadEvent(function(){(a=b.getElement(a))&&a.focus()})},setElementClass:function(a,b){var c=MochiKit.DOM,d=
c.getElement(a);c.attributeArray.compliant?d.setAttribute("class",b):d.setAttribute("className",b)},toggleElementClass:function(a){for(var b=MochiKit.DOM,c=1;c<arguments.length;c++){var d=b.getElement(arguments[c]);b.addElementClass(d,a)||b.removeElementClass(d,a)}},addElementClass:function(a,b){var c=MochiKit.DOM,d=c.getElement(a),e=d.className;if(typeof e!="string")e=d.getAttribute("class");if(typeof e!="string"||e.length===0){c.setElementClass(d,b);return true}if(e==b)return false;for(var f=e.split(" "),
g=0;g<f.length;g++)if(f[g]==b)return false;c.setElementClass(d,e+" "+b);return true},removeElementClass:function(a,b){var c=MochiKit.DOM,d=c.getElement(a),e=d.className;if(typeof e!="string")e=d.getAttribute("class");if(typeof e!="string"||e.length===0)return false;if(e==b){c.setElementClass(d,"");return true}e=e.split(" ");for(var f=0;f<e.length;f++)if(e[f]==b){e.splice(f,1);c.setElementClass(d,e.join(" "));return true}return false},swapElementClass:function(a,b,c){a=MochiKit.DOM.getElement(a);(b=
MochiKit.DOM.removeElementClass(a,b))&&MochiKit.DOM.addElementClass(a,c);return b},hasElementClass:function(a){var b=MochiKit.DOM.getElement(a);if(b==null)return false;var c=b.className;if(typeof c!="string"&&typeof b.getAttribute=="function")c=b.getAttribute("class");if(typeof c!="string")return false;b=c.split(" ");for(c=1;c<arguments.length;c++){for(var d=false,e=0;e<b.length;e++)if(b[e]==arguments[c]){d=true;break}if(!d)return false}return true},escapeHTML:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,
"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},toHTML:function(a){return MochiKit.DOM.emitHTML(a).join("")},emitHTML:function(a,b){if(typeof b=="undefined"||b===null)b=[];var c=[a],d=MochiKit.DOM,e=d.escapeHTML;for(d=d.attributeArray;c.length;){a=c.pop();if(typeof a=="string")b.push(a);else if(a.nodeType==1){b.push("<"+a.tagName.toLowerCase());for(var f=[],g=d(a),h=0;h<g.length;h++){var i=g[h];f.push([" ",i.name,'="',e(i.value),'"'])}f.sort();for(h=0;h<f.length;h++){g=f[h];for(i=0;i<g.length;i++)b.push(g[i])}if(a.hasChildNodes()){b.push(">");
c.push("</"+a.tagName.toLowerCase()+">");f=a.childNodes;for(h=f.length-1;h>=0;h--)c.push(f[h])}else b.push("/>")}else a.nodeType==3&&b.push(e(a.nodeValue))}return b},scrapeText:function(a,b){var c=[];(function(d){var e=d.childNodes;if(e)for(var f=0;f<e.length;f++)arguments.callee.call(this,e[f]);e=d.nodeValue;typeof e=="string"&&c.push(e)})(MochiKit.DOM.getElement(a));return b?c:c.join("")},removeEmptyTextNodes:function(a){a=MochiKit.DOM.getElement(a);for(var b=0;b<a.childNodes.length;b++){var c=
a.childNodes[b];c.nodeType==3&&!/\S/.test(c.nodeValue)&&c.parentNode.removeChild(c)}},getFirstElementByTagAndClassName:function(a,b,c){var d=MochiKit.DOM;if(typeof a=="undefined"||a===null)a="*";if(typeof c=="undefined"||c===null)c=d._document;c=d.getElement(c);if(c==null)return null;a=c.getElementsByTagName(a)||d._document.all;if(a.length<=0)return null;else if(typeof b=="undefined"||b===null)return a[0];for(c=0;c<a.length;c++){d=a[c];var e=d.className;if(typeof e!="string")e=d.getAttribute("class");
if(typeof e=="string"){e=e.split(" ");for(var f=0;f<e.length;f++)if(e[f]==b)return d}}return null},getFirstParentByTagAndClassName:function(a,b,c){var d=MochiKit.DOM;a=d.getElement(a);b=typeof b=="undefined"||b===null?"*":b.toUpperCase();if(typeof c=="undefined"||c===null)c=null;if(a)a=a.parentNode;for(;a&&a.tagName;){var e=a.tagName.toUpperCase();if((b==="*"||b==e)&&(c===null||d.hasElementClass(a,c)))return a;a=a.parentNode}return null},__new__:function(a){var b=MochiKit.Base;if(typeof document!=
"undefined"){this._document=document;this._xhtml=document.documentElement&&document.createElementNS&&document.documentElement.namespaceURI==="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"}else if(MochiKit.MockDOM)this._document=MochiKit.MockDOM.document;this._window=a;this.domConverters=new b.AdapterRegistry;a=this._document.createElement("span");var c;if(a&&a.attributes&&a.attributes.length>0){var d=b.filter;c=function(h){return d(c.ignoreAttrFilter,h.attributes)};c.ignoreAttr={};
a=a.attributes;for(var e=c.ignoreAttr,f=0;f<a.length;f++){var g=a[f];e[g.name]=g.value}c.ignoreAttrFilter=function(h){return c.ignoreAttr[h.name]!=h.value};c.compliant=false;c.renames={"class":"className",checked:"defaultChecked",usemap:"useMap","for":"htmlFor",readonly:"readOnly",colspan:"colSpan",rowspan:"rowSpan",bgcolor:"bgColor",cellspacing:"cellSpacing",cellpadding:"cellPadding"}}else{c=function(h){return h.attributes};c.compliant=true;c.ignoreAttr={};c.renames={}}c.__export__=false;this.attributeArray=
c;b._deprecated(this,"computedStyle","MochiKit.Style.getStyle","1.4",true);b._deprecated(this,"elementDimensions","MochiKit.Style.getElementDimensions","1.4");b._deprecated(this,"elementPosition","MochiKit.Style.getElementPosition","1.4");b._deprecated(this,"getViewportDimensions","MochiKit.Style.getViewportDimensions","1.4");b._deprecated(this,"hideElement","MochiKit.Style.hideElement","1.4");b._deprecated(this,"makeClipping","MochiKit.Style.makeClipping","1.4.1");b._deprecated(this,"makePositioned",
"MochiKit.Style.makePositioned","1.4.1");b._deprecated(this,"setElementDimensions","MochiKit.Style.setElementDimensions","1.4");b._deprecated(this,"setElementPosition","MochiKit.Style.setElementPosition","1.4");b._deprecated(this,"setDisplayForElement","MochiKit.Style.setDisplayForElement","1.4");b._deprecated(this,"setOpacity","MochiKit.Style.setOpacity","1.4");b._deprecated(this,"showElement","MochiKit.Style.showElement","1.4");b._deprecated(this,"undoClipping","MochiKit.Style.undoClipping","1.4.1");
b._deprecated(this,"undoPositioned","MochiKit.Style.undoPositioned","1.4.1");b._deprecated(this,"Coordinates","MochiKit.Style.Coordinates","1.4");b._deprecated(this,"Dimensions","MochiKit.Style.Dimensions","1.4");a=this.createDOMFunc;this.UL=a("ul");this.OL=a("ol");this.LI=a("li");this.DL=a("dl");this.DT=a("dt");this.DD=a("dd");this.TD=a("td");this.TR=a("tr");this.TBODY=a("tbody");this.THEAD=a("thead");this.TFOOT=a("tfoot");this.TABLE=a("table");this.TH=a("th");this.INPUT=a("input");this.SPAN=a("span");
this.A=a("a");this.DIV=a("div");this.IMG=a("img");this.BUTTON=a("button");this.TT=a("tt");this.PRE=a("pre");this.H1=a("h1");this.H2=a("h2");this.H3=a("h3");this.H4=a("h4");this.H5=a("h5");this.H6=a("h6");this.BR=a("br");this.HR=a("hr");this.LABEL=a("label");this.TEXTAREA=a("textarea");this.FORM=a("form");this.P=a("p");this.SELECT=a("select");this.OPTION=a("option");this.OPTGROUP=a("optgroup");this.LEGEND=a("legend");this.FIELDSET=a("fieldset");this.STRONG=a("strong");this.CANVAS=a("canvas");this.IFRAME=
a("iframe");this.LINK=a("link");this.SCRIPT=a("script");this.$=this.getElement;this.NBSP="\u00a0";b.nameFunctions(this)}});MochiKit.DOM.__new__(typeof window=="undefined"?this:window);if(MochiKit.__export__){withWindow=MochiKit.DOM.withWindow;withDocument=MochiKit.DOM.withDocument}MochiKit.Base._exportSymbols(this,MochiKit.DOM);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Selector={};MochiKit.Base.module(MochiKit,"Selector","1.5",["Base","DOM","Iter"]);MochiKit.Selector.Selector=function(a){this.params={classNames:[],pseudoClassNames:[]};this.expression=a.toString().replace(/(^\s+|\s+$)/g,"");this.parseExpression();this.compileMatcher()};
MochiKit.Selector.Selector.prototype={__class__:MochiKit.Selector.Selector,parseExpression:function(){function a(h){throw"Parse error in selector: "+h;}this.expression==""&&a("empty expression");for(var b=MochiKit.Base.repr,c=this.params,d=this.expression,e,f,g;e=d.match(/^(.*)\[([a-z0-9_:-]+?)(?:([~\|!^$*]?=)(?:"([^"]*)"|([^\]\s]*)))?\]$/i);){c.attributes=c.attributes||[];c.attributes.push({name:e[2],operator:e[3],value:e[4]||e[5]||""});d=e[1]}if(d=="*")return this.params.wildcard=true;for(;e=d.match(/^([^a-z0-9_-])?([a-z0-9_-]+(?:\([^)]*\))?)(.*)/i);){f=
e[1];g=e[2];e=e[3];switch(f){case "#":c.id=g;break;case ".":c.classNames.push(g);break;case ":":c.pseudoClassNames.push(g);break;case "":case undefined:c.tagName=g.toUpperCase();break;default:a(b(d))}d=e}d.length>0&&a(b(d))},buildMatchExpression:function(){function a(j){return"MochiKit.Base.filter(function (node) { return node.nodeType == 1; }, "+j+".childNodes)"}var b=MochiKit.Base.repr,c=this.params,d=[],e,f;c.wildcard&&d.push("true");if(e=c.id)d.push("element.id == "+b(e));if(e=c.tagName)d.push("element.tagName.toUpperCase() == "+
b(e));if((e=c.classNames).length>0)for(f=0;f<e.length;f++)d.push("MochiKit.DOM.hasElementClass(element, "+b(e[f])+")");if((e=c.pseudoClassNames).length>0)for(f=0;f<e.length;f++){var g=e[f].match(/^([^(]+)(?:\((.*)\))?$/),h=g[1],i=g[2];switch(h){case "root":d.push("element.nodeType == 9 || element === element.ownerDocument.documentElement");break;case "nth-child":case "nth-last-child":case "nth-of-type":case "nth-last-of-type":g=i.match(/^((?:(\d+)n\+)?(\d+)|odd|even)$/);if(!g)throw"Invalid argument to pseudo element nth-child: "+
i;if(g[0]=="odd"){i=2;g=1}else if(g[0]=="even"){i=2;g=0}else{i=g[2]&&parseInt(g,10)||null;g=parseInt(g[3],10)}d.push("this.nthChild(element,"+i+","+g+","+!!h.match("^nth-last")+","+!!h.match("of-type$")+")");break;case "first-child":d.push("this.nthChild(element, null, 1)");break;case "last-child":d.push("this.nthChild(element, null, 1, true)");break;case "first-of-type":d.push("this.nthChild(element, null, 1, false, true)");break;case "last-of-type":d.push("this.nthChild(element, null, 1, true, true)");
break;case "only-child":d.push(a("element.parentNode")+".length == 1");break;case "only-of-type":d.push("MochiKit.Base.filter(function (node) { return node.tagName == element.tagName; }, "+a("element.parentNode")+").length == 1");break;case "empty":d.push("element.childNodes.length == 0");break;case "enabled":d.push("(this.isUIElement(element) && element.disabled === false)");break;case "disabled":d.push("(this.isUIElement(element) && element.disabled === true)");break;case "checked":d.push("(this.isUIElement(element) && element.checked === true)");
break;case "not":h=new MochiKit.Selector.Selector(i);d.push("!( "+h.buildMatchExpression()+")")}}if(e=c.attributes)MochiKit.Base.map(function(j){var k="MochiKit.DOM.getNodeAttribute(element, "+b(j.name)+")";d.push(k+" != null");switch(j.operator){case "=":d.push(k+" == "+b(j.value));break;case "~=":d.push("MochiKit.Base.findValue("+(k+".split("+b(" ")+")")+", "+b(j.value)+") > -1");break;case "^=":d.push(k+".substring(0, "+j.value.length+") == "+b(j.value));break;case "$=":d.push(k+".substring("+
k+".length - "+j.value.length+") == "+b(j.value));break;case "*=":d.push(k+".match("+b(j.value)+")");break;case "|=":d.push(k+".split("+b("-")+")[0].toUpperCase() == "+b(j.value.toUpperCase()));break;case "!=":d.push(k+" != "+b(j.value));break;case "":case undefined:break;default:throw"Unknown operator "+j.operator+" in selector";}},e);return d.join(" && ")},compileMatcher:function(){var a="return (!element.tagName) ? false : "+this.buildMatchExpression()+";";this.match=new Function("element",a)},
nthChild:function(a,b,c,d,e){var f=MochiKit.Base.filter(function(g){return g.nodeType==1},a.parentNode.childNodes);if(e)f=MochiKit.Base.filter(function(g){return g.tagName==a.tagName},f);if(d)f=MochiKit.Iter.reversed(f);return b?(MochiKit.Base.findIdentical(f,a)+1-c)/b%1==0:c==MochiKit.Base.findIdentical(f,a)+1},isUIElement:function(a){return MochiKit.Base.findValue(["input","button","select","option","textarea","object"],a.tagName.toLowerCase())>-1},findElements:function(a,b){function c(f,g){if(b==
"")return MochiKit.DOM.isChildNode(f,g);else if(b==">")return f.parentNode===g;else if(b=="+")return f===d(g);else if(b=="~"){for(var h=g;h=d(h);)if(f===h)return true;return false}else throw"Invalid axis: "+b;}function d(f){for(f=f.nextSibling;f&&f.nodeType!=1;)f=f.nextSibling;return f}var e;if(b==undefined)b="";if(e=MochiKit.DOM.getElement(this.params.id))if(this.match(e))if(!a||c(e,a))return[e];if(b=="")a=(a||MochiKit.DOM.currentDocument()).getElementsByTagName(this.params.tagName||"*");else if(b==
">"){if(!a)throw"> combinator not allowed without preceeding expression";a=MochiKit.Base.filter(function(f){return f.nodeType==1},a.childNodes)}else if(b=="+"){if(!a)throw"+ combinator not allowed without preceeding expression";a=d(a)&&[d(a)]}else if(b=="~"){if(!a)throw"~ combinator not allowed without preceeding expression";for(e=[];d(a);){a=d(a);e.push(a)}a=e}if(!a)return[];return MochiKit.Base.filter(MochiKit.Base.bind(function(f){return this.match(f)},this),a)},repr:function(){return"Selector("+
this.expression+")"},toString:MochiKit.Base.forwardCall("repr")};
MochiKit.Base.update(MochiKit.Selector,{findChildElements:function(a,b){a=MochiKit.DOM.getElement(a);var c=function(d){for(var e=[],f=0;f<d.length;f++)MochiKit.Base.findIdentical(e,d[f])<0&&e.push(d[f]);return e};return MochiKit.Base.flattenArray(MochiKit.Base.map(function(d){try{var e=a.querySelectorAll(d);return Array.prototype.slice.call(e,0)}catch(f){}var g="";d=d.replace(/(^\s+|\s+$)/g,"").split(/\s+/);return c(MochiKit.Iter.reduce(function(h,i){var j=i.match(/^[>+~]$/);if(j){g=j[0];return h}else{var k=
new MochiKit.Selector.Selector(i);j=MochiKit.Iter.reduce(function(l,m){return MochiKit.Base.extend(l,k.findElements(m||a,g))},h,[]);g="";return j}},d,[null]))},b))},findDocElements:function(){return MochiKit.Selector.findChildElements(MochiKit.DOM.currentDocument(),arguments)},__new__:function(){this.$$=this.findDocElements;MochiKit.Base.nameFunctions(this)}});MochiKit.Selector.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Selector);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Style={};MochiKit.Base.module(MochiKit,"Style","1.5",["Base","DOM"]);MochiKit.Style.Dimensions=function(a,b){if(!(this instanceof MochiKit.Style.Dimensions))return new MochiKit.Style.Dimensions(a,b);this.w=a;this.h=b};MochiKit.Style.Dimensions.prototype.__repr__=function(){var a=MochiKit.Base.repr;return"{w: "+a(this.w)+", h: "+a(this.h)+"}"};MochiKit.Style.Dimensions.prototype.toString=function(){return this.__repr__()};
MochiKit.Style.Coordinates=function(a,b){if(!(this instanceof MochiKit.Style.Coordinates))return new MochiKit.Style.Coordinates(a,b);this.x=a;this.y=b};MochiKit.Style.Coordinates.prototype.__repr__=function(){var a=MochiKit.Base.repr;return"{x: "+a(this.x)+", y: "+a(this.y)+"}"};MochiKit.Style.Coordinates.prototype.toString=function(){return this.__repr__()};
MochiKit.Base.update(MochiKit.Style,{getStyle:function(a,b){var c=MochiKit.DOM,d=c._document;a=c.getElement(a);b=MochiKit.Base.camelize(b);if(!(!a||a==d)){if(b=="opacity"&&typeof a.filters!="undefined"){if((c=(MochiKit.Style.getStyle(a,"filter")||"").match(/alpha\(opacity=(.*)\)/))&&c[1])return parseFloat(c[1])/100;return 1}if(b=="float"||b=="cssFloat"||b=="styleFloat")return a.style["float"]?a.style["float"]:a.style.cssFloat?a.style.cssFloat:a.style.styleFloat?a.style.styleFloat:"none";c=a.style?
a.style[b]:null;if(!c)if(d.defaultView&&d.defaultView.getComputedStyle){c=d.defaultView.getComputedStyle(a,null);b=b.replace(/([A-Z])/g,"-$1").toLowerCase();c=c?c.getPropertyValue(b):null}else if(a.currentStyle){c=a.currentStyle[b];if(/^\d/.test(c)&&!/px$/.test(c)&&b!="fontWeight"){d=a.style.left;var e=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=c||0;c=a.style.pixelLeft+"px";a.style.left=d;a.runtimeStyle.left=e}}if(b=="opacity")c=parseFloat(c);if(/Opera/.test(navigator.userAgent)&&
MochiKit.Base.findValue(["left","top","right","bottom"],b)!=-1)if(MochiKit.Style.getStyle(a,"position")=="static")c="auto";return c=="auto"?null:c}},setStyle:function(a,b){a=MochiKit.DOM.getElement(a);for(var c in b)switch(c){case "opacity":MochiKit.Style.setOpacity(a,b[c]);break;case "float":case "cssFloat":case "styleFloat":if(typeof a.style["float"]!="undefined")a.style["float"]=b[c];else if(typeof a.style.cssFloat!="undefined")a.style.cssFloat=b[c];else a.style.styleFloat=b[c];break;default:a.style[MochiKit.Base.camelize(c)]=
b[c]}},setOpacity:function(a,b){a=MochiKit.DOM.getElement(a);var c=MochiKit.Style;if(b==1){var d=/Gecko/.test(navigator.userAgent)&&!/Konqueror|AppleWebKit|KHTML/.test(navigator.userAgent);a.style.opacity=d?0.999999:1;if(/MSIE/.test(navigator.userAgent))a.style.filter=c.getStyle(a,"filter").replace(/alpha\([^\)]*\)/gi,"")}else{if(b<1.0E-5)b=0;a.style.opacity=b;if(/MSIE/.test(navigator.userAgent))a.style.filter=c.getStyle(a,"filter").replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+b*100+")"}},getElementPosition:function(a,
b){var c=MochiKit.Style,d=MochiKit.DOM;if(typeof a=="string")a=d.getElement(a);if(!(a==null||!(a!=null&&a.nodeType==null&&typeof a.x=="number"&&typeof a.y=="number")&&c.getStyle(a,"display")=="none")){d=new c.Coordinates(0,0);var e=null,f=null,g=MochiKit.DOM._document;f=g.documentElement;g=g.body;if(!a.parentNode&&a.x&&a.y){d.x+=a.x||0;d.y+=a.y||0}else if(a.getBoundingClientRect){e=a.getBoundingClientRect();d.x+=e.left+(f.scrollLeft||g.scrollLeft)-(f.clientLeft||0);d.y+=e.top+(f.scrollTop||g.scrollTop)-
(f.clientTop||0)}else if(a.offsetParent){d.x+=a.offsetLeft;d.y+=a.offsetTop;f=a.offsetParent;if(f!=a)for(;f;){d.x+=parseInt(f.style.borderLeftWidth,10)||0;d.y+=parseInt(f.style.borderTopWidth,10)||0;d.x+=f.offsetLeft;d.y+=f.offsetTop;f=f.offsetParent}f=navigator.userAgent.toLowerCase();if(typeof opera!="undefined"&&parseFloat(opera.version())<9||f.indexOf("AppleWebKit")!=-1&&c.getStyle(a,"position")=="absolute"){d.x-=g.offsetLeft;d.y-=g.offsetTop}for(f=a.parentNode?a.parentNode:null;f;){g=f.tagName.toUpperCase();
if(g==="BODY"||g==="HTML")break;if(c.getStyle(f,"display").search(/^inline|table-row.*$/i)){d.x-=f.scrollLeft;d.y-=f.scrollTop}f=f.parentNode?f.parentNode:null}}if(b)if(b=arguments.callee(b)){d.x-=b.x||0;d.y-=b.y||0}return d}},setElementPosition:function(a,b,c){a=MochiKit.DOM.getElement(a);if(typeof c=="undefined")c="px";var d={},e=MochiKit.Base.isUndefinedOrNull;e(b.x)||(d.left=b.x+c);e(b.y)||(d.top=b.y+c);MochiKit.DOM.updateNodeAttributes(a,{style:d})},makePositioned:function(a){a=MochiKit.DOM.getElement(a);
var b=MochiKit.Style.getStyle(a,"position");if(b=="static"||!b){a.style.position="relative";if(/Opera/.test(navigator.userAgent)){a.style.top=0;a.style.left=0}}},undoPositioned:function(a){a=MochiKit.DOM.getElement(a);if(a.style.position=="relative")a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""},makeClipping:function(a){a=MochiKit.DOM.getElement(a);var b=a.style;b={overflow:b.overflow,"overflow-x":b.overflowX,"overflow-y":b.overflowY};if((MochiKit.Style.getStyle(a,"overflow")||
"visible")!="hidden"){a.style.overflow="hidden";a.style.overflowX="hidden";a.style.overflowY="hidden"}return b},undoClipping:function(a,b){a=MochiKit.DOM.getElement(a);if(typeof b=="string")a.style.overflow=b;else if(b!=null){a.style.overflow=b.overflow;a.style.overflowX=b["overflow-x"];a.style.overflowY=b["overflow-y"]}},getElementDimensions:function(a,b){var c=MochiKit.Style,d=MochiKit.DOM;if(typeof a.w=="number"||typeof a.h=="number")return new c.Dimensions(a.w||0,a.h||0);if(a=d.getElement(a)){d=
c.getStyle(a,"display");if(d=="none"||d==""||typeof d=="undefined"){var e=a.style,f=e.visibility,g=e.position,h=e.display;e.visibility="hidden";e.position="absolute";e.display=c._getDefaultDisplay(a);d=a.offsetWidth;var i=a.offsetHeight;e.display=h;e.position=g;e.visibility=f}else{d=a.offsetWidth||0;i=a.offsetHeight||0}if(b){if(f=(e="colSpan"in a&&"rowSpan"in a)&&a.parentNode&&c.getStyle(a.parentNode,"borderCollapse")=="collapse")if(/MSIE/.test(navigator.userAgent)){g=a.previousSibling?0.5:1;h=a.nextSibling?
0.5:1}else h=g=0.5;else h=g=1;d-=Math.round((parseFloat(c.getStyle(a,"paddingLeft"))||0)+(parseFloat(c.getStyle(a,"paddingRight"))||0)+g*(parseFloat(c.getStyle(a,"borderLeftWidth"))||0)+h*(parseFloat(c.getStyle(a,"borderRightWidth"))||0));e=e?/Gecko|Opera/.test(navigator.userAgent)&&!/Konqueror|AppleWebKit|KHTML/.test(navigator.userAgent)?0:/MSIE/.test(navigator.userAgent)?1:f?0.5:1:1;i-=Math.round((parseFloat(c.getStyle(a,"paddingTop"))||0)+(parseFloat(c.getStyle(a,"paddingBottom"))||0)+e*((parseFloat(c.getStyle(a,
"borderTopWidth"))||0)+(parseFloat(c.getStyle(a,"borderBottomWidth"))||0)))}return new c.Dimensions(d,i)}},setElementDimensions:function(a,b,c){a=MochiKit.DOM.getElement(a);if(typeof c=="undefined")c="px";var d={},e=MochiKit.Base.isUndefinedOrNull;e(b.w)||(d.width=b.w+c);e(b.h)||(d.height=b.h+c);MochiKit.DOM.updateNodeAttributes(a,{style:d})},_getDefaultDisplay:function(a){var b=MochiKit.Style;if(a=MochiKit.DOM.getElement(a)){a=a.tagName.toUpperCase();return b._defaultDisplay[a]||"block"}},setDisplayForElement:function(a,
b){for(var c=MochiKit.Base.extend(null,arguments,1),d=MochiKit.DOM.getElement,e=0;e<c.length;e++)if(b=d(c[e]))b.style.display=a},getViewportDimensions:function(){var a=new MochiKit.Style.Dimensions,b=MochiKit.DOM._window,c=MochiKit.DOM._document.body;if(b.innerWidth){a.w=b.innerWidth;a.h=b.innerHeight}else if(c&&c.parentElement&&c.parentElement.clientWidth){a.w=c.parentElement.clientWidth;a.h=c.parentElement.clientHeight}else if(c&&c.clientWidth){a.w=c.clientWidth;a.h=c.clientHeight}return a},getViewportPosition:function(){var a=
new MochiKit.Style.Coordinates(0,0),b=MochiKit.DOM._document,c=b.documentElement;b=b.body;if(c&&(c.scrollTop||c.scrollLeft)){a.x=c.scrollLeft;a.y=c.scrollTop}else if(b){a.x=b.scrollLeft;a.y=b.scrollTop}return a},__new__:function(){var a=MochiKit.Base,b=["A","ABBR","ACRONYM","B","BASEFONT","BDO","BIG","BR","CITE","CODE","DFN","EM","FONT","I","IMG","KBD","LABEL","Q","S","SAMP","SMALL","SPAN","STRIKE","STRONG","SUB","SUP","TEXTAREA","TT","U","VAR"];this._defaultDisplay={TABLE:"table",THEAD:"table-header-group",
TBODY:"table-row-group",TFOOT:"table-footer-group",COLGROUP:"table-column-group",COL:"table-column",TR:"table-row",TD:"table-cell",TH:"table-cell",CAPTION:"table-caption",LI:"list-item",INPUT:"inline-block",SELECT:"inline-block"};if(/MSIE/.test(navigator.userAgent))for(var c in this._defaultDisplay)if(this._defaultDisplay[c].indexOf("table")==0)this._defaultDisplay[c]="block";for(c=0;c<b.length;c++)this._defaultDisplay[b[c]]="inline";a._deprecated(this,"elementPosition","MochiKit.Style.getElementPosition",
"1.3",true);a._deprecated(this,"elementDimensions","MochiKit.Style.getElementDimensions","1.3",true);this.hideElement=a.partial(this.setDisplayForElement,"none");this.showElement=a.partial(this.setDisplayForElement,"block");a.nameFunctions(this)}});MochiKit.Style.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Style);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.LoggingPane={};MochiKit.Base.module(MochiKit,"LoggingPane","1.5",["Base","Logging"]);MochiKit.LoggingPane.createLoggingPane=function(a){var b=MochiKit.LoggingPane;a=!!a;if(b._loggingPane&&b._loggingPane.inline!=a){b._loggingPane.closePane();b._loggingPane=null}if(!b._loggingPane||b._loggingPane.closed)b._loggingPane=new b.LoggingPane(a,MochiKit.Logging.logger);return b._loggingPane};
MochiKit.LoggingPane.LoggingPane=function(a,b){if(typeof b=="undefined"||b===null)b=MochiKit.Logging.logger;this.logger=b;var c=MochiKit.Base.updatetree,d=MochiKit.Base.bind,e=MochiKit.Base.clone,f=window;if(typeof MochiKit.DOM!="undefined")f=MochiKit.DOM.currentWindow();if(!a){var g="_MochiKit_LoggingPane_"+f.location.href.split("?")[0].replace(/[#:\/.><&%-]/g,"_");g=f.open("",g,"dependent,resizable,height=200");if(!g){alert("Not able to open debugging window due to pop-up blocking.");return}g.document.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>[MochiKit.LoggingPane]</title></head><body></body></html>');
g.document.close();g.document.title+=" "+f.document.title;f=g}var h=f.document;this.doc=h;var i=h.getElementById("_MochiKit_LoggingPane");g=!!i;if(i&&typeof i.loggingPane!="undefined"){i.loggingPane.logger=this.logger;i.loggingPane.buildAndApplyFilter();return i.loggingPane}if(g)for(var j;j=i.firstChild;)i.removeChild(j);else{i=h.createElement("div");i.id="_MochiKit_LoggingPane"}i.loggingPane=this;var k=h.createElement("input"),l=h.createElement("input");j=h.createElement("button");var m=h.createElement("button"),
o=h.createElement("button"),p=h.createElement("button"),q=h.createElement("div"),t=h.createElement("div");this.colorTable=e(this.colorTable);var v=[],w=null,y=function(n){n=n.level;if(typeof n=="number")n=MochiKit.Logging.LogLevel[n];return n},z=d(function(n){var r=y(n);n=n.info.join(" ");var x=this.colorTable[r],u=h.createElement("span");u.className="MochiKit-LogMessage MochiKit-LogLevel-"+r;u.style.cssText="margin: 0px; white-space: -moz-pre-wrap; white-space: -o-pre-wrap; white-space: pre-wrap; white-space: pre-line; word-wrap: break-word; wrap-option: emergency; color: "+
x;u.appendChild(h.createTextNode(r+": "+n));t.appendChild(u);t.appendChild(h.createElement("br"));q.scrollTop=q.offsetHeight>q.scrollHeight?0:q.scrollHeight},this),E=function(n){v[v.length]=n;z(n)},F=function(){var n,r;try{n=RegExp(k.value);r=RegExp(l.value)}catch(x){MochiKit.Logging.logDebug("Error in filter regex: "+x.message);return null}return function(u){return n.test(y(u))&&r.test(u.info.join(" "))}},A=function(){for(;t.firstChild;)t.removeChild(t.firstChild)};e=d(function(){if(!this.closed){this.closed=
true;if(MochiKit.LoggingPane._loggingPane==this)MochiKit.LoggingPane._loggingPane=null;this.logger.removeListener("_MochiKit_LoggingPane_Listener");try{try{i.loggingPane=null}catch(n){MochiKit.Logging.logFatal("Bookmarklet was closed incorrectly.")}a?i.parentNode.removeChild(i):this.win.close()}catch(r){}}},this);var B=function(){A();for(var n=0;n<v.length;n++){var r=v[n];if(w===null||w(r))z(r)}};this.buildAndApplyFilter=function(){w=F();B();this.logger.removeListener("_MochiKit_LoggingPane_Listener");
this.logger.addListener("_MochiKit_LoggingPane_Listener",w,E)};var C=d(function(){v=this.logger.getMessages();B()},this),D=d(function(n){n=n||window.event;(n.which||n.keyCode)==13&&this.buildAndApplyFilter()},this),s="display: block; z-index: 1000; left: 0px; bottom: 0px; position: fixed; width: 100%; background-color: white; font: "+this.logFont;s+=a?"; height: 10em; border-top: 2px solid black":"; height: 100%;";i.style.cssText=s;g||h.body.appendChild(i);s={cssText:"width: 33%; display: inline; font: "+
this.logFont};c(k,{value:"FATAL|ERROR|WARNING|INFO|DEBUG",onkeypress:D,style:s});i.appendChild(k);c(l,{value:".*",onkeypress:D,style:s});i.appendChild(l);s="width: 8%; display:inline; font: "+this.logFont;j.appendChild(h.createTextNode("Filter"));j.onclick=d("buildAndApplyFilter",this);j.style.cssText=s;i.appendChild(j);m.appendChild(h.createTextNode("Load"));m.onclick=C;m.style.cssText=s;i.appendChild(m);o.appendChild(h.createTextNode("Clear"));o.onclick=function(){v=[];A()};o.style.cssText=s;i.appendChild(o);
p.appendChild(h.createTextNode("Close"));p.onclick=e;p.style.cssText=s;i.appendChild(p);q.style.cssText="overflow: auto; width: 100%";t.style.cssText="width: 100%; height: "+(a?"8em":"100%");q.appendChild(t);i.appendChild(q);this.buildAndApplyFilter();C();this.win=a?undefined:f;this.inline=a;this.closePane=e;this.closed=false;return this};MochiKit.LoggingPane.LoggingPane.prototype={logFont:"8pt Verdana,sans-serif",colorTable:{ERROR:"red",FATAL:"darkred",WARNING:"blue",INFO:"black",DEBUG:"green"}};
MochiKit.LoggingPane.__new__=function(){MochiKit.Base.nameFunctions(this);MochiKit.LoggingPane._loggingPane=null};MochiKit.LoggingPane.__new__();MochiKit.Base._exportSymbols(this,MochiKit.LoggingPane);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Color={};MochiKit.Base.module(MochiKit,"Color","1.5",["Base","DOM","Style"]);MochiKit.Color.Color=function(a,b,c,d){if(typeof d=="undefined"||d===null)d=1;this.rgb={r:a,g:b,b:c,a:d}};
MochiKit.Color.Color.prototype={__class__:MochiKit.Color.Color,colorWithAlpha:function(a){var b=this.rgb;return MochiKit.Color.Color.fromRGB(b.r,b.g,b.b,a)},colorWithHue:function(a){var b=this.asHSL();b.h=a;return MochiKit.Color.Color.fromHSL(b)},colorWithSaturation:function(a){var b=this.asHSL();b.s=a;return MochiKit.Color.Color.fromHSL(b)},colorWithLightness:function(a){var b=this.asHSL();b.l=a;return MochiKit.Color.Color.fromHSL(b)},darkerColorWithLevel:function(a){var b=this.asHSL();b.l=Math.max(b.l-
a,0);return MochiKit.Color.Color.fromHSL(b)},lighterColorWithLevel:function(a){var b=this.asHSL();b.l=Math.min(b.l+a,1);return MochiKit.Color.Color.fromHSL(b)},blendedColor:function(a,b){if(typeof b=="undefined"||b===null)b=0.5;var c=1-b,d=this.rgb,e=a.rgb,f=b;return MochiKit.Color.Color.fromRGB(d.r*c+e.r*f,d.g*c+e.g*f,d.b*c+e.b*f,d.a*c+e.a*f)},compareRGB:function(a){var b=this.asRGB();a=a.asRGB();return MochiKit.Base.compare([b.r,b.g,b.b,b.a],[a.r,a.g,a.b,a.a])},isLight:function(){return this.asHSL().l>
0.5},isDark:function(){return!this.isLight()},toHSLString:function(){var a=this.asHSL(),b=MochiKit.Color.clampColorComponent,c=this._hslString;if(!c){b=b(a.h,360).toFixed(0)+","+b(a.s,100).toPrecision(4)+"%,"+b(a.l,100).toPrecision(4)+"%";a=a.a;if(a>=1)c="hsl("+b+")";else{if(a<=0)a=0;c="hsla("+b+","+a+")"}this._hslString=c}return c},toRGBString:function(){var a=this.rgb,b=MochiKit.Color.clampColorComponent,c=this._rgbString;if(!c){b=b(a.r,255).toFixed(0)+","+b(a.g,255).toFixed(0)+","+b(a.b,255).toFixed(0);
this._rgbString=c=a.a!=1?"rgba("+b+","+a.a+")":"rgb("+b+")"}return c},asRGB:function(){return MochiKit.Base.clone(this.rgb)},toHexString:function(){var a=MochiKit.Color,b=this.rgb,c=MochiKit.Color.clampColorComponent,d=this._hexString;if(!d)this._hexString=d="#"+a.toColorPart(c(b.r,255))+a.toColorPart(c(b.g,255))+a.toColorPart(c(b.b,255));return d},asHSV:function(){var a=this.hsv;if(typeof a=="undefined"||a===null)this.hsv=a=MochiKit.Color.rgbToHSV(this.rgb);return MochiKit.Base.clone(a)},asHSL:function(){var a=
this.hsl;if(typeof a=="undefined"||a===null)this.hsl=a=MochiKit.Color.rgbToHSL(this.rgb);return MochiKit.Base.clone(a)},toString:function(){return this.toRGBString()},repr:function(){var a=this.rgb;return this.__class__.NAME+"("+[a.r,a.g,a.b,a.a].join(", ")+")"}};
MochiKit.Base.update(MochiKit.Color.Color,{fromRGB:function(a,b,c,d){var e=MochiKit.Color.Color;if(arguments.length==1){var f=a;a=f.r;b=f.g;c=f.b;d=typeof f.a=="undefined"?undefined:f.a}return new e(a,b,c,d)},fromHSL:function(){var a=MochiKit.Color;return a.Color.fromRGB(a.hslToRGB.apply(a,arguments))},fromHSV:function(){var a=MochiKit.Color;return a.Color.fromRGB(a.hsvToRGB.apply(a,arguments))},fromName:function(a){var b=MochiKit.Color.Color;if(a.charAt(0)=='"')a=a.substr(1,a.length-2);var c=b._namedColors[a.toLowerCase()];
if(typeof c=="string")return b.fromHexString(c);else if(a=="transparent")return b.transparentColor();return null},fromString:function(a){var b=MochiKit.Color.Color,c=a.substr(0,3);if(c=="rgb")return b.fromRGBString(a);else if(c=="hsl")return b.fromHSLString(a);else if(a.charAt(0)=="#")return b.fromHexString(a);return b.fromName(a)},fromHexString:function(a){if(a.charAt(0)=="#")a=a.substring(1);var b=[],c,d;if(a.length==3)for(c=0;c<3;c++){d=a.substr(c,1);b.push(parseInt(d+d,16)/255)}else for(c=0;c<
6;c+=2){d=a.substr(c,2);b.push(parseInt(d,16)/255)}a=MochiKit.Color.Color;return a.fromRGB.apply(a,b)},_fromColorString:function(a,b,c,d){if(d.indexOf(a)===0)d=d.substring(d.indexOf("(",3)+1,d.length-1);a=d.split(/\s*,\s*/);d=[];for(var e=0;e<a.length;e++){var f=a[e],g=f.substring(f.length-3);f=f.charAt(f.length-1)=="%"?0.01*parseFloat(f.substring(0,f.length-1)):g=="deg"?parseFloat(f)/360:g=="rad"?parseFloat(f)/(Math.PI*2):c[e]*parseFloat(f);d.push(f)}return this[b].apply(this,d)},fromComputedStyle:function(a){var b=
MochiKit.DOM,c=MochiKit.Color.Color;for(a=b.getElement(a);a;a=a.parentNode){var d=MochiKit.Style.getStyle.apply(b,arguments);if(d){d=c.fromString(d);if(!d)break;if(d.asRGB().a>0)return d}}return null},fromBackground:function(a){var b=MochiKit.Color.Color;return b.fromComputedStyle(a,"backgroundColor","background-color")||b.whiteColor()},fromText:function(a){var b=MochiKit.Color.Color;return b.fromComputedStyle(a,"color","color")||b.blackColor()},namedColors:function(){return MochiKit.Base.clone(MochiKit.Color.Color._namedColors)}});
MochiKit.Base.update(MochiKit.Color,{clampColorComponent:function(a,b){a*=b;return a<0?0:a>b?b:a},_hslValue:function(a,b,c){if(c>6)c-=6;else if(c<0)c+=6;return c<1?a+(b-a)*c:c<3?b:c<4?a+(b-a)*(4-c):a},hsvToRGB:function(a,b,c,d){if(arguments.length==1){var e=a;a=e.h;b=e.s;c=e.v;d=e.a}var f,g,h;if(b===0)h=g=f=c;else{e=Math.floor(a*6);var i=a*6-e,j=c*(1-b),k=c*(1-b*i);i=c*(1-b*(1-i));switch(e){case 1:f=k;g=c;h=j;break;case 2:f=j;g=c;h=i;break;case 3:f=j;g=k;h=c;break;case 4:f=i;g=j;h=c;break;case 5:f=
c;g=j;h=k;break;case 6:case 0:f=c;g=i;h=j}}return{r:f,g:g,b:h,a:d}},hslToRGB:function(a,b,c,d){if(arguments.length==1){var e=a;a=e.h;b=e.s;c=e.l;d=e.a}var f,g;if(b===0)g=f=e=c;else{g=c<=0.5?c*(1+b):c+b-c*b;var h=2*c-g,i=MochiKit.Color._hslValue,j=a*6;e=i(h,g,j+2);f=i(h,g,j);g=i(h,g,j-2)}return{r:e,g:f,b:g,a:d}},rgbToHSV:function(a,b,c,d){if(arguments.length==1){var e=a;a=e.r;b=e.g;c=e.b;d=e.a}e=Math.max(Math.max(a,b),c);var f=Math.min(Math.min(a,b),c),g;if(f==e)f=g=0;else{g=e-f;f=g/e;g=a==e?(b-c)/
g:b==e?2+(c-a)/g:4+(a-b)/g;g/=6;if(g<0)g+=1;if(g>1)g-=1}return{h:g,s:f,v:e,a:d}},rgbToHSL:function(a,b,c,d){if(arguments.length==1){var e=a;a=e.r;b=e.g;c=e.b;d=e.a}var f=Math.max(a,Math.max(b,c)),g=Math.min(a,Math.min(b,c));e=(f+g)/2;var h=f-g;if(h===0)g=f=0;else{g=e<=0.5?h/(f+g):h/(2-f-g);f=a==f?(b-c)/h:b==f?2+(c-a)/h:4+(a-b)/h;f/=6;if(f<0)f+=1;if(f>1)f-=1}return{h:f,s:g,l:e,a:d}},toColorPart:function(a){a=Math.round(a);var b=a.toString(16);if(a<16)return"0"+b;return b},__new__:function(){var a=
MochiKit.Base;this.Color.fromRGBString=a.bind(this.Color._fromColorString,this.Color,"rgb","fromRGB",[1/255,1/255,1/255,1]);this.Color.fromHSLString=a.bind(this.Color._fromColorString,this.Color,"hsl","fromHSL",[1/360,0.01,0.01,1]);var b=1/3;b={black:[0,0,0],blue:[0,0,1],brown:[0.6,0.4,0.2],cyan:[0,1,1],darkGray:[b,b,b],gray:[0.5,0.5,0.5],green:[0,1,0],lightGray:[2*b,2*b,2*b],magenta:[1,0,1],orange:[1,0.5,0],purple:[0.5,0,0.5],red:[1,0,0],transparent:[0,0,0,0],white:[1,1,1],yellow:[1,1,0]};for(var c in b){var d=
c+"Color",e=this.Color.fromRGB.apply(this.Color,b[c]);this.Color[d]=a.partial(a.operator.identity,e)}a.nameFunctions(this);a.registerComparator(this.Color.NAME,function(){for(var f=0;f<arguments.length;f++)if(!(arguments[f]instanceof MochiKit.Color.Color))return false;return true},function(f,g){return f.compareRGB(g)})}});MochiKit.Color.__new__();
MochiKit.Color.Color._namedColors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",
darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",
gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",
lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",
mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",
seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};MochiKit.Base._exportSymbols(this,MochiKit.Color);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Signal={};MochiKit.Base.module(MochiKit,"Signal","1.5",["Base","DOM"]);MochiKit.Signal._observers=[];MochiKit.Signal.Event=function(a,b){this._event=b||window.event;this._src=a};MochiKit.Signal.Event.__export__=false;
MochiKit.Signal.Event.prototype.__repr__=function(){var a=MochiKit.Base.repr,b="{event(): "+a(this.event())+", src(): "+a(this.src())+", type(): "+a(this.type())+", target(): "+a(this.target());if(this.type()&&this.type().indexOf("key")===0||this.type().indexOf("mouse")===0||this.type().indexOf("click")!=-1||this.type()=="contextmenu")b+=", modifier(): {alt: "+a(this.modifier().alt)+", ctrl: "+a(this.modifier().ctrl)+", meta: "+a(this.modifier().meta)+", shift: "+a(this.modifier().shift)+", any: "+
a(this.modifier().any)+"}";if(this.type()&&this.type().indexOf("key")===0)b+=", key(): {code: "+a(this.key().code)+", string: "+a(this.key().string)+"}";if(this.type()&&(this.type().indexOf("mouse")===0||this.type().indexOf("click")!=-1||this.type()=="contextmenu")){b+=", mouse(): {page: "+a(this.mouse().page)+", client: "+a(this.mouse().client);if(this.type()!="mousemove"&&this.type()!="mousewheel")b+=", button: {left: "+a(this.mouse().button.left)+", middle: "+a(this.mouse().button.middle)+", right: "+
a(this.mouse().button.right)+"}";if(this.type()=="mousewheel")b+=", wheel: "+a(this.mouse().wheel);b+="}"}if(this.type()=="mouseover"||this.type()=="mouseout"||this.type()=="mouseenter"||this.type()=="mouseleave")b+=", relatedTarget(): "+a(this.relatedTarget());b+="}";return b};MochiKit.Signal.Event.prototype.toString=function(){return this.__repr__()};MochiKit.Signal.Event.prototype.src=function(){return this._src};MochiKit.Signal.Event.prototype.event=function(){return this._event};
MochiKit.Signal.Event.prototype.type=function(){return this._event.type==="DOMMouseScroll"?"mousewheel":this._event.type||undefined};MochiKit.Signal.Event.prototype.target=function(){return this._event.target||this._event.srcElement};MochiKit.Signal.Event.prototype._relatedTarget=null;
MochiKit.Signal.Event.prototype.relatedTarget=function(){if(this._relatedTarget!==null)return this._relatedTarget;var a=null;if(this.type()=="mouseover"||this.type()=="mouseenter")a=this._event.relatedTarget||this._event.fromElement;else if(this.type()=="mouseout"||this.type()=="mouseleave")a=this._event.relatedTarget||this._event.toElement;try{if(a!==null&&a.nodeType!==null)return this._relatedTarget=a}catch(b){}};MochiKit.Signal.Event.prototype._modifier=null;
MochiKit.Signal.Event.prototype.modifier=function(){if(this._modifier!==null)return this._modifier;var a={};a.alt=this._event.altKey;a.ctrl=this._event.ctrlKey;a.meta=this._event.metaKey||false;a.shift=this._event.shiftKey;a.any=a.alt||a.ctrl||a.shift||a.meta;return this._modifier=a};MochiKit.Signal.Event.prototype._key=null;
MochiKit.Signal.Event.prototype.key=function(){if(this._key!==null)return this._key;var a={};if(this.type()&&this.type().indexOf("key")===0)if(this.type()=="keydown"||this.type()=="keyup"){a.code=this._event.keyCode;a.string=MochiKit.Signal._specialKeys[a.code]||"KEY_UNKNOWN";return this._key=a}else if(this.type()=="keypress"){a.code=0;a.string="";if(typeof this._event.charCode!="undefined"&&this._event.charCode!==0&&!MochiKit.Signal._specialMacKeys[this._event.charCode]){a.code=this._event.charCode;
a.string=String.fromCharCode(a.code)}else if(this._event.keyCode&&typeof this._event.charCode=="undefined"){a.code=this._event.keyCode;a.string=String.fromCharCode(a.code)}return this._key=a}};MochiKit.Signal.Event.prototype._mouse=null;
MochiKit.Signal.Event.prototype.mouse=function(){if(this._mouse!==null)return this._mouse;var a={},b=this._event;if(this.type()&&(this.type().indexOf("mouse")===0||this.type().indexOf("drag")===0||this.type().indexOf("click")!=-1||this.type()=="contextmenu")){a.client={x:0,y:0};if(b.clientX||b.clientY){a.client.x=!b.clientX||b.clientX<0?0:b.clientX;a.client.y=!b.clientY||b.clientY<0?0:b.clientY}a.page={x:0,y:0};if(b.pageX||b.pageY){a.page.x=!b.pageX||b.pageX<0?0:b.pageX;a.page.y=!b.pageY||b.pageY<
0?0:b.pageY}else{var c=MochiKit.DOM._document.documentElement,d=MochiKit.DOM._document.body;a.page.x=b.clientX+(c.scrollLeft||d.scrollLeft)-(c.clientLeft||0);a.page.y=b.clientY+(c.scrollTop||d.scrollTop)-(c.clientTop||0)}if(this.type()!="mousemove"&&this.type()!="mousewheel"){a.button={};a.button.left=false;a.button.right=false;a.button.middle=false;if(b.which){a.button.left=b.which==1;a.button.middle=b.which==2;a.button.right=b.which==3}else{a.button.left=!!(b.button&1);a.button.right=!!(b.button&
2);a.button.middle=!!(b.button&4)}}if(this.type()=="mousewheel"){a.wheel={x:0,y:0};if(b.wheelDeltaX||b.wheelDeltaY){a.wheel.x=b.wheelDeltaX/-40||0;a.wheel.y=b.wheelDeltaY/-40||0}else a.wheel.y=b.wheelDelta?b.wheelDelta/-40:b.detail||0}return this._mouse=a}};MochiKit.Signal.Event.prototype.stop=function(){this.stopPropagation();this.preventDefault()};
MochiKit.Signal.Event.prototype.stopPropagation=function(){if(this._event.stopPropagation)this._event.stopPropagation();else this._event.cancelBubble=true};MochiKit.Signal.Event.prototype.preventDefault=function(){if(this._event.preventDefault)this._event.preventDefault();else if(this._confirmUnload===null)this._event.returnValue=false};MochiKit.Signal.Event.prototype._confirmUnload=null;
MochiKit.Signal.Event.prototype.confirmUnload=function(a){if(this.type()=="beforeunload"){this._confirmUnload=a;this._event.returnValue=a}};MochiKit.Signal._specialMacKeys={3:"KEY_ENTER",63289:"KEY_NUM_PAD_CLEAR",63276:"KEY_PAGE_UP",63277:"KEY_PAGE_DOWN",63275:"KEY_END",63273:"KEY_HOME",63234:"KEY_ARROW_LEFT",63232:"KEY_ARROW_UP",63235:"KEY_ARROW_RIGHT",63233:"KEY_ARROW_DOWN",63302:"KEY_INSERT",63272:"KEY_DELETE"};
(function(){for(var a=MochiKit.Signal._specialMacKeys,b=63236;b<=63242;b++)a[b]="KEY_F"+(b-63236+1)})();
MochiKit.Signal._specialKeys={8:"KEY_BACKSPACE",9:"KEY_TAB",12:"KEY_NUM_PAD_CLEAR",13:"KEY_ENTER",16:"KEY_SHIFT",17:"KEY_CTRL",18:"KEY_ALT",19:"KEY_PAUSE",20:"KEY_CAPS_LOCK",27:"KEY_ESCAPE",32:"KEY_SPACEBAR",33:"KEY_PAGE_UP",34:"KEY_PAGE_DOWN",35:"KEY_END",36:"KEY_HOME",37:"KEY_ARROW_LEFT",38:"KEY_ARROW_UP",39:"KEY_ARROW_RIGHT",40:"KEY_ARROW_DOWN",44:"KEY_PRINT_SCREEN",45:"KEY_INSERT",46:"KEY_DELETE",59:"KEY_SEMICOLON",91:"KEY_WINDOWS_LEFT",92:"KEY_WINDOWS_RIGHT",93:"KEY_SELECT",106:"KEY_NUM_PAD_ASTERISK",
107:"KEY_NUM_PAD_PLUS_SIGN",109:"KEY_NUM_PAD_HYPHEN-MINUS",110:"KEY_NUM_PAD_FULL_STOP",111:"KEY_NUM_PAD_SOLIDUS",144:"KEY_NUM_LOCK",145:"KEY_SCROLL_LOCK",186:"KEY_SEMICOLON",187:"KEY_EQUALS_SIGN",188:"KEY_COMMA",189:"KEY_HYPHEN-MINUS",190:"KEY_FULL_STOP",191:"KEY_SOLIDUS",192:"KEY_GRAVE_ACCENT",219:"KEY_LEFT_SQUARE_BRACKET",220:"KEY_REVERSE_SOLIDUS",221:"KEY_RIGHT_SQUARE_BRACKET",222:"KEY_APOSTROPHE"};
(function(){for(var a=MochiKit.Signal._specialKeys,b=48;b<=57;b++)a[b]="KEY_"+(b-48);for(b=65;b<=90;b++)a[b]="KEY_"+String.fromCharCode(b);for(b=96;b<=105;b++)a[b]="KEY_NUM_PAD_"+(b-96);for(b=112;b<=123;b++)a[b]="KEY_F"+(b-112+1)})();MochiKit.Signal.Ident=function(a){this.source=a.source;this.signal=a.signal;this.listener=a.listener;this.isDOM=a.isDOM;this.objOrFunc=a.objOrFunc;this.funcOrStr=a.funcOrStr;this.connected=a.connected};MochiKit.Signal.Ident.__export__=false;
MochiKit.Signal.Ident.prototype={};
MochiKit.Base.update(MochiKit.Signal,{_unloadCache:function(){for(var a=MochiKit.Signal,b=a._observers,c=0;c<b.length;c++)b[c].signal!=="onload"&&b[c].signal!=="onunload"&&a._disconnect(b[c])},_listener:function(a,b,c,d,e){var f=MochiKit.Signal.Event;if(!e)return typeof c.im_self=="undefined"?MochiKit.Base.bindLate(c,d):c;d=d||a;return typeof c=="string"?b==="onload"||b==="onunload"?function(g){d[c].apply(d,[new f(a,g)]);g=new MochiKit.Signal.Ident({source:a,signal:b,objOrFunc:d,funcOrStr:c});MochiKit.Signal._disconnect(g)}:
function(g){d[c].apply(d,[new f(a,g)])}:b==="onload"||b==="onunload"?function(g){c.apply(d,[new f(a,g)]);g=new MochiKit.Signal.Ident({source:a,signal:b,objOrFunc:c});MochiKit.Signal._disconnect(g)}:function(g){c.apply(d,[new f(a,g)])}},_browserAlreadyHasMouseEnterAndLeave:function(){return/MSIE/.test(navigator.userAgent)},_browserLacksMouseWheelEvent:function(){return/Gecko\//.test(navigator.userAgent)},_mouseEnterListener:function(a,b,c,d){var e=MochiKit.Signal.Event;return function(f){f=new e(a,
f);try{f.relatedTarget()}catch(g){return}f.stop();if(!MochiKit.DOM.isChildNode(f.relatedTarget(),a)){f.type=function(){return b};return typeof c=="string"?d[c].apply(d,[f]):c.apply(d,[f])}}},_getDestPair:function(a,b){var c=null,d=null;if(typeof b!="undefined"){c=a;d=b;if(typeof b=="string"){if(typeof a[b]!="function")throw Error("'funcOrStr' must be a function on 'objOrFunc'");}else if(typeof b!="function")throw Error("'funcOrStr' must be a function or string");}else if(typeof a!="function")throw Error("'objOrFunc' must be a function if 'funcOrStr' is not given");
else d=a;return[c,d]},connect:function(a,b,c,d){if(typeof a=="string")a=MochiKit.DOM.getElement(a);var e=MochiKit.Signal;if(typeof b!="string")throw Error("'sig' must be a string");var f=e._getDestPair(c,d),g=f[0],h=f[1];if(typeof g=="undefined"||g===null)g=a;if((f=!!(a.addEventListener||a.attachEvent))&&(b==="onmouseenter"||b==="onmouseleave")&&!e._browserAlreadyHasMouseEnterAndLeave()){g=e._mouseEnterListener(a,b.substr(2),h,g);b=b==="onmouseenter"?"onmouseover":"onmouseout"}else if(f&&b=="onmousewheel"&&
e._browserLacksMouseWheelEvent()){g=e._listener(a,b,h,g,f);b="onDOMMouseScroll"}else g=e._listener(a,b,h,g,f);if(a.addEventListener)a.addEventListener(b.substr(2),g,false);else a.attachEvent&&a.attachEvent(b,g);g=new MochiKit.Signal.Ident({source:a,signal:b,listener:g,isDOM:f,objOrFunc:c,funcOrStr:d,connected:true});e._observers.push(g);if(!f&&typeof a.__connect__=="function"){e=MochiKit.Base.extend([g],arguments,1);a.__connect__.apply(a,e)}return g},connectOnce:function(a,b,c,d){var e=MochiKit.Signal,
f=e.connect(a,b,c,d),g;g=e.connect(a,b,function(){e.disconnect(f);e.disconnect(g)});return f},_disconnect:function(a){if(a.connected){a.connected=false;var b=a.source,c=a.signal,d=a.listener;if(a.isDOM)if(b.removeEventListener)b.removeEventListener(c.substr(2),d,false);else if(b.detachEvent)b.detachEvent(c,d);else throw Error("'src' must be a DOM element");else typeof b.__disconnect__=="function"&&b.__disconnect__(a,c,a.objOrFunc,a.funcOrStr)}},disconnect:function(a){var b=MochiKit.Signal,c=b._observers,
d=MochiKit.Base;if(arguments.length>1){d=arguments[0];if(typeof d=="string")d=MochiKit.DOM.getElement(d);for(var e=arguments[1],f=arguments[2],g=arguments[3],h=c.length-1;h>=0;h--){var i=c[h];if(i.source===d&&i.signal===e&&i.objOrFunc===f&&i.funcOrStr===g){b._disconnect(i);if(b._lock===0)c.splice(h,1);else b._dirty=true;return true}}}else{d=d.findIdentical(c,a);if(d>=0){b._disconnect(a);if(b._lock===0)c.splice(d,1);else b._dirty=true;return true}}return false},disconnectAllTo:function(a,b){var c=
MochiKit.Signal,d=c._observers,e=c._disconnect,f=c._lock,g=c._dirty;if(typeof b==="undefined")b=null;for(var h=d.length-1;h>=0;h--){var i=d[h];if(i.objOrFunc===a&&(b===null||i.funcOrStr===b)){e(i);if(f===0)d.splice(h,1);else g=true}}c._dirty=g},disconnectAll:function(a){if(typeof a=="string")a=MochiKit.DOM.getElement(a);var b=MochiKit.Base,c=b.flattenArguments(b.extend(null,arguments,1));b=MochiKit.Signal;var d=b._disconnect,e=b._observers,f,g=b._lock,h=b._dirty;if(c.length===0)for(f=e.length-1;f>=
0;f--){c=e[f];if(c.source===a){d(c);if(g===0)e.splice(f,1);else h=true}}else{var i={};for(f=0;f<c.length;f++)i[c[f]]=true;for(f=e.length-1;f>=0;f--){c=e[f];if(c.source===a&&c.signal in i){d(c);if(g===0)e.splice(f,1);else h=true}}}b._dirty=h},signal:function(a,b){var c=MochiKit.Signal,d=c._observers;if(typeof a=="string")a=MochiKit.DOM.getElement(a);var e=MochiKit.Base.extend(null,arguments,2),f=[];c._lock++;for(var g=0;g<d.length;g++){var h=d[g];if(h.source===a&&h.signal===b&&h.connected)try{if(h.isDOM&&
h.funcOrStr!=null){var i=h.objOrFunc;i[h.funcOrStr].apply(i,e)}else h.isDOM?h.objOrFunc.apply(a,e):h.listener.apply(a,e)}catch(j){f.push(j)}}c._lock--;c._gc();if(f.length==1)throw f[0];else if(f.length>1){c=Error("Multiple errors thrown in handling 'sig', see errors property");c.errors=f;throw c;}},_gc:function(){var a=MochiKit.Signal,b=a._observers;if(a._lock===0&&a._dirty){for(var c=b.length-1;c>=0;c--)b[c].connected||b.splice(c,1);a._dirty=false;return true}return false}});
MochiKit.Signal.__new__=function(a){var b=MochiKit.Base;this._document=document;this._window=a;this._lock=0;this._dirty=false;try{this.connect(window,"onunload",this._unloadCache)}catch(c){}b.nameFunctions(this)};MochiKit.Signal.__new__(this);if(MochiKit.__export__){connect=MochiKit.Signal.connect;disconnect=MochiKit.Signal.disconnect;disconnectAll=MochiKit.Signal.disconnectAll;signal=MochiKit.Signal.signal}MochiKit.Base._exportSymbols(this,MochiKit.Signal);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Position={};MochiKit.Base.module(MochiKit,"Position","1.5",["Base","DOM","Style"]);
MochiKit.Base.update(MochiKit.Position,{__export__:false,includeScrollOffsets:false,prepare:function(){this.windowOffset=new MochiKit.Style.Coordinates(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0)},cumulativeOffset:function(a){var b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0;a=a.offsetParent}while(a);return new MochiKit.Style.Coordinates(c,b)},realOffset:function(a){var b=
0,c=0;do{b+=a.scrollTop||0;c+=a.scrollLeft||0;a=a.parentNode}while(a);return new MochiKit.Style.Coordinates(c,b)},within:function(a,b,c){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(a,b,c);this.xcomp=b;this.ycomp=c;this.offset=this.cumulativeOffset(a);if(a.style.position=="fixed"){this.offset.x+=this.windowOffset.x;this.offset.y+=this.windowOffset.y}return c>=this.offset.y&&c<this.offset.y+a.offsetHeight&&b>=this.offset.x&&b<this.offset.x+a.offsetWidth},withinIncludingScrolloffsets:function(a,
b,c){var d=this.realOffset(a);this.xcomp=b+d.x-this.windowOffset.x;this.ycomp=c+d.y-this.windowOffset.y;this.offset=this.cumulativeOffset(a);return this.ycomp>=this.offset.y&&this.ycomp<this.offset.y+a.offsetHeight&&this.xcomp>=this.offset.x&&this.xcomp<this.offset.x+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if(a=="vertical")return(this.offset.y+b.offsetHeight-this.ycomp)/b.offsetHeight;if(a=="horizontal")return(this.offset.x+b.offsetWidth-this.xcomp)/b.offsetWidth},absolutize:function(a){a=
MochiKit.DOM.getElement(a);if(a.style.position!="absolute"){MochiKit.Position.prepare();var b=MochiKit.Position.positionedOffset(a),c=a.clientWidth,d=a.clientHeight,e={position:a.style.position,left:b.x-parseFloat(a.style.left||0),top:b.y-parseFloat(a.style.top||0),width:a.style.width,height:a.style.height};a.style.position="absolute";a.style.top=b.y+"px";a.style.left=b.x+"px";a.style.width=c+"px";a.style.height=d+"px";return e}},positionedOffset:function(a){var b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||
0;if(a=a.offsetParent){var d=MochiKit.Style.getStyle(a,"position");if(d=="relative"||d=="absolute")break}}while(a);return new MochiKit.Style.Coordinates(c,b)},relativize:function(a,b){a=MochiKit.DOM.getElement(a);if(a.style.position!="relative"){MochiKit.Position.prepare();var c=parseFloat(a.style.top||0)-(b.top||0),d=parseFloat(a.style.left||0)-(b.left||0);a.style.position=b.position;a.style.top=c+"px";a.style.left=d+"px";a.style.width=b.width;a.style.height=b.height}},clone:function(a,b){a=MochiKit.DOM.getElement(a);
b=MochiKit.DOM.getElement(b);b.style.position="absolute";var c=this.cumulativeOffset(a);b.style.top=c.y+"px";b.style.left=c.x+"px";b.style.width=a.offsetWidth+"px";b.style.height=a.offsetHeight+"px"},page:function(a){var b=0,c=0,d=a;do{b+=d.offsetTop||0;c+=d.offsetLeft||0;if(d.offsetParent==document.body&&MochiKit.Style.getStyle(d,"position")=="absolute")break}while(d=d.offsetParent);d=a;do{b-=d.scrollTop||0;c-=d.scrollLeft||0}while(d=d.parentNode);return new MochiKit.Style.Coordinates(c,b)}});
MochiKit.Position.__new__=function(){MochiKit.Base.nameFunctions(this)};MochiKit.Position.__new__(this);MochiKit.Base._exportSymbols(this,MochiKit.Position);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Visual={};MochiKit.Base.module(MochiKit,"Visual","1.5",["Base","DOM","Style","Color","Position"]);
MochiKit.Visual._RoundCorners=function(a,b){a=MochiKit.DOM.getElement(a);this._setOptions(b);if(this.options.__unstable__wrapElement)a=this._doWrap(a);var c=this.options.color,d=MochiKit.Color.Color;if(this.options.color==="fromElement")c=d.fromBackground(a);else c instanceof d||(c=d.fromString(c));this.isTransparent=c.asRGB().a<=0;var e=this.options.bgColor;if(this.options.bgColor==="fromParent")e=d.fromBackground(a.offsetParent);else e instanceof d||(e=d.fromString(e));this._roundCornersImpl(a,
c,e)};
MochiKit.Visual._RoundCorners.prototype={_doWrap:function(a){var b=MochiKit.DOM.currentDocument();if(typeof b.defaultView==="undefined"||b.defaultView===null)return a;b=b.defaultView.getComputedStyle(a,null);if(typeof b==="undefined"||b===null)return a;b=MochiKit.DOM.DIV({style:{display:"block",marginTop:b.getPropertyValue("padding-top"),marginRight:b.getPropertyValue("padding-right"),marginBottom:b.getPropertyValue("padding-bottom"),marginLeft:b.getPropertyValue("padding-left"),padding:"0px"}});b.innerHTML=
a.innerHTML;a.innerHTML="";a.appendChild(b);return a},_roundCornersImpl:function(a,b,c){this.options.border&&this._renderBorder(a,c);this._isTopRounded()&&this._roundTopCorners(a,b,c);this._isBottomRounded()&&this._roundBottomCorners(a,b,c)},_renderBorder:function(a,b){var c="1px solid "+this._borderColor(b);a.innerHTML="<div "+("style='"+("border-left: "+c)+";"+("border-right: "+c)+"'")+">"+a.innerHTML+"</div>"},_roundTopCorners:function(a,b,c){for(var d=this._createCorner(c),e=0;e<this.options.numSlices;e++)d.appendChild(this._createCornerSlice(b,
c,e,"top"));a.style.paddingTop=0;a.insertBefore(d,a.firstChild)},_roundBottomCorners:function(a,b,c){for(var d=this._createCorner(c),e=this.options.numSlices-1;e>=0;e--)d.appendChild(this._createCornerSlice(b,c,e,"bottom"));a.style.paddingBottom=0;a.appendChild(d)},_createCorner:function(a){return MochiKit.DOM.DIV({style:{backgroundColor:a.toString()}})},_createCornerSlice:function(a,b,c,d){var e=MochiKit.DOM.SPAN(),f=e.style;f.backgroundColor=a.toString();f.display="block";f.height="1px";f.overflow=
"hidden";f.fontSize="1px";a=this._borderColor(a,b);if(this.options.border&&c===0){f.borderTopStyle="solid";f.borderTopWidth="1px";f.borderLeftWidth="0px";f.borderRightWidth="0px";f.borderBottomWidth="0px";f.height="0px";f.borderColor=a.toString()}else if(a){f.borderColor=a.toString();f.borderStyle="solid";f.borderWidth="0px 1px"}if(!this.options.compact&&c==this.options.numSlices-1)f.height="2px";this._setMargin(e,c,d);this._setBorder(e,c,d);return e},_setOptions:function(a){this.options={corners:"all",
color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false,__unstable__wrapElement:false};MochiKit.Base.update(this.options,a);this.options.numSlices=this.options.compact?2:4},_whichSideTop:function(){var a=this.options.corners;if(this._hasString(a,"all","top"))return"";var b=a.indexOf("tl")!=-1;a=a.indexOf("tr")!=-1;if(b&&a)return"";if(b)return"left";if(a)return"right";return""},_whichSideBottom:function(){var a=this.options.corners;if(this._hasString(a,"all","bottom"))return"";
var b=a.indexOf("bl")!=-1;a=a.indexOf("br")!=-1;if(b&&a)return"";if(b)return"left";if(a)return"right";return""},_borderColor:function(a,b){if(a=="transparent")return b;else if(this.options.border)return this.options.border;else if(this.options.blend)return b.blendedColor(a);return""},_setMargin:function(a,b,c){b=this._marginSize(b)+"px";c=c=="top"?this._whichSideTop():this._whichSideBottom();a=a.style;if(c=="left"){a.marginLeft=b;a.marginRight="0px"}else if(c=="right"){a.marginRight=b;a.marginLeft=
"0px"}else{a.marginLeft=b;a.marginRight=b}},_setBorder:function(a,b,c){b=this._borderSize(b)+"px";c=c=="top"?this._whichSideTop():this._whichSideBottom();a=a.style;if(c=="left"){a.borderLeftWidth=b;a.borderRightWidth="0px"}else if(c=="right"){a.borderRightWidth=b;a.borderLeftWidth="0px"}else{a.borderLeftWidth=b;a.borderRightWidth=b}},_marginSize:function(a){if(this.isTransparent)return 0;var b=this.options;return b.compact&&b.blend?[1,0][a]:b.compact?[2,1][a]:b.blend?[3,2,1,0][a]:[5,3,2,1][a]},_borderSize:function(a){var b=
this.options;if(b.compact&&(b.blend||this.isTransparent))return 1;else if(b.compact)b=[1,0];else if(b.blend)b=[2,1,1,1];else if(b.border)b=[0,2,0,0];else if(this.isTransparent)b=[5,3,2,1];else return 0;return b[a]},_hasString:function(a){for(var b=1;b<arguments.length;b++)if(a.indexOf(arguments[b])!=-1)return true;return false},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all",
"bottom","bl","br")},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3}};MochiKit.Visual.roundElement=function(a,b){new MochiKit.Visual._RoundCorners(a,b)};MochiKit.Visual.roundClass=function(a,b,c){a=MochiKit.DOM.getElementsByTagAndClassName(a,b);for(b=0;b<a.length;b++)MochiKit.Visual.roundElement(a[b],c)};
MochiKit.Visual.tagifyText=function(a,b){b=b||"position:relative";if(/MSIE/.test(navigator.userAgent))b+=";zoom:1";a=MochiKit.DOM.getElement(a);var c=MochiKit.Base.map;c(function(d){if(d.nodeType==3){c(function(e){a.insertBefore(MochiKit.DOM.SPAN({style:b},e==" "?String.fromCharCode(160):e),d)},d.nodeValue.split(""));MochiKit.DOM.removeElement(d)}},a.childNodes)};MochiKit.Visual._forceRerendering=function(a){try{a=MochiKit.DOM.getElement(a);var b=document.createTextNode(" ");a.appendChild(b);a.removeChild(b)}catch(c){}};
MochiKit.Visual.multiple=function(a,b,c){c=MochiKit.Base.update({speed:0.1,delay:0},c);var d=c.delay,e=0;MochiKit.Base.map(function(f){c.delay=e*c.speed+d;new b(f,c);e+=1},a)};MochiKit.Visual.PAIRS={slide:["slideDown","slideUp"],blind:["blindDown","blindUp"],appear:["appear","fade"],size:["grow","shrink"]};
MochiKit.Visual.toggle=function(a,b,c){a=MochiKit.DOM.getElement(a);b=(b||"appear").toLowerCase();c=MochiKit.Base.update({queue:{position:"end",scope:a.id||"global",limit:1}},c);var d=MochiKit.Visual;d[MochiKit.Style.getStyle(a,"display")!="none"?d.PAIRS[b][1]:d.PAIRS[b][0]](a,c)};MochiKit.Visual.Transitions={__export__:false};MochiKit.Visual.Transitions.linear=function(a){return a};MochiKit.Visual.Transitions.sinoidal=function(a){return 0.5-Math.cos(a*Math.PI)/2};
MochiKit.Visual.Transitions.reverse=function(a){return 1-a};MochiKit.Visual.Transitions.flicker=function(a){return 0.25-Math.cos(a*Math.PI)/4+Math.random()/2};MochiKit.Visual.Transitions.wobble=function(a){return 0.5-Math.cos(9*a*Math.PI)/2};MochiKit.Visual.Transitions.pulse=function(a,b){a*=b?2*b:10;var c=a-Math.floor(a);return Math.floor(a)%2==0?c:1-c};MochiKit.Visual.Transitions.parabolic=function(a){return a*a};
MochiKit.Visual.Transitions.spring=function(a){return 1-Math.cos(a*2.5*Math.PI)*Math.exp(-a*6)};MochiKit.Visual.Transitions.none=function(){return 0};MochiKit.Visual.Transitions.full=function(){return 1};MochiKit.Visual.ScopedQueue=function(){var a=arguments.callee;if(!(this instanceof a))return new a;this.__init__()};MochiKit.Visual.ScopedQueue.__export__=false;
MochiKit.Base.update(MochiKit.Visual.ScopedQueue.prototype,{__init__:function(){this.effects=[];this.interval=null},add:function(a){var b=(new Date).getTime(),c=MochiKit.Base.map;switch(typeof a.options.queue=="string"?a.options.queue:a.options.queue.position){case "front":c(function(e){if(e.state=="idle"){e.startOn+=a.finishOn;e.finishOn+=a.finishOn}},this.effects);break;case "end":var d;c(function(e){e=e.finishOn;if(e>=(d||e))d=e},this.effects);b=d||b;break;case "break":c(function(e){e.finalize()},
this.effects);break;case "replace":c(function(e){e.cancel()},this.effects)}a.startOn+=b;a.finishOn+=b;if(!a.options.queue.limit||this.effects.length<a.options.queue.limit)this.effects.push(a);if(!this.interval)this.interval=this.startLoop(MochiKit.Base.bind(this.loop,this),40)},startLoop:function(a,b){return setInterval(a,b)},remove:function(a){this.effects=MochiKit.Base.filter(function(b){return b!=a},this.effects);if(!this.effects.length){this.stopLoop(this.interval);this.interval=null}},stopLoop:function(a){clearInterval(a)},
loop:function(){var a=(new Date).getTime();MochiKit.Base.map(function(b){b.loop(a)},this.effects)}});MochiKit.Visual.Queues={__export__:false,instances:{},get:function(a){if(typeof a!="string")return a;this.instances[a]||(this.instances[a]=new MochiKit.Visual.ScopedQueue);return this.instances[a]}};MochiKit.Visual.Queue=MochiKit.Visual.Queues.get("global");MochiKit.Visual.Queue.__export__=false;
MochiKit.Visual.DefaultOptions={__export__:false,transition:MochiKit.Visual.Transitions.sinoidal,duration:1,fps:25,sync:false,from:0,to:1,delay:0,queue:"parallel"};MochiKit.Visual.Base=function(){};
MochiKit.Visual.Base.prototype={__class__:MochiKit.Visual.Base,start:function(a){var b=MochiKit.Visual;this.options=MochiKit.Base.setdefault(a,b.DefaultOptions);this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1E3;this.finishOn=this.startOn+this.options.duration*1E3;this.event("beforeStart");this.options.sync||b.Queues.get(typeof this.options.queue=="string"?"global":this.options.queue.scope).add(this)},loop:function(a){if(a>=this.startOn){if(a>=this.finishOn)return this.finalize();
a=(a-this.startOn)/(this.finishOn-this.startOn);var b=Math.round(a*this.options.fps*this.options.duration);if(b>this.currentFrame){this.render(a);this.currentFrame=b}}},render:function(a){if(this.state=="idle"){this.state="running";this.event("beforeSetup");this.setup();this.event("afterSetup")}if(this.state=="running"){var b=this.options.transition;if(typeof b=="string")b=MochiKit.Visual.Transitions[b];if(typeof b=="function")a=b(a);a*=this.options.to-this.options.from;a+=this.options.from;this.event("beforeUpdate");
this.update(a);this.event("afterUpdate")}},cancel:function(){this.options.sync||MochiKit.Visual.Queues.get(typeof this.options.queue=="string"?"global":this.options.queue.scope).remove(this);this.state="finished"},finalize:function(){this.render(1);this.cancel();this.event("beforeFinish");this.finish();this.event("afterFinish")},setup:function(){},finish:function(){},update:function(){},event:function(a){this.options[a+"Internal"]&&this.options[a+"Internal"](this);this.options[a]&&this.options[a](this)},
repr:function(){return"["+this.__class__.NAME+", options:"+MochiKit.Base.repr(this.options)+"]"}};MochiKit.Visual.Parallel=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};MochiKit.Visual.Parallel.prototype=new MochiKit.Visual.Base;
MochiKit.Base.update(MochiKit.Visual.Parallel.prototype,{__class__:MochiKit.Visual.Parallel,__init__:function(a,b){this.effects=a||[];this.start(b)},update:function(a){MochiKit.Base.map(function(b){b.render(a)},this.effects)},finish:function(){MochiKit.Base.map(function(a){a.finalize()},this.effects)}});MochiKit.Visual.Sequence=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};MochiKit.Visual.Sequence.prototype=new MochiKit.Visual.Base;
MochiKit.Base.update(MochiKit.Visual.Sequence.prototype,{__class__:MochiKit.Visual.Sequence,__init__:function(a,b){var c={transition:MochiKit.Visual.Transitions.linear,duration:0};this.effects=a||[];MochiKit.Base.map(function(d){c.duration+=d.options.duration},this.effects);MochiKit.Base.setdefault(b,c);this.start(b)},update:function(a){a=a*this.options.duration;for(var b=0;b<this.effects.length;b++){var c=this.effects[b];if(a<=c.options.duration){c.render(a/c.options.duration);break}else a-=c.options.duration}},
finish:function(){MochiKit.Base.map(function(a){a.finalize()},this.effects)}});MochiKit.Visual.Opacity=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};MochiKit.Visual.Opacity.prototype=new MochiKit.Visual.Base;
MochiKit.Base.update(MochiKit.Visual.Opacity.prototype,{__class__:MochiKit.Visual.Opacity,__init__:function(a,b){var c=MochiKit.Base,d=MochiKit.Style;this.element=MochiKit.DOM.getElement(a);this.element.currentStyle&&!this.element.currentStyle.hasLayout&&d.setStyle(this.element,{zoom:1});b=c.update({from:d.getStyle(this.element,"opacity")||0,to:1},b);this.start(b)},update:function(a){MochiKit.Style.setStyle(this.element,{opacity:a})}});
MochiKit.Visual.Move=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};MochiKit.Visual.Move.prototype=new MochiKit.Visual.Base;
MochiKit.Base.update(MochiKit.Visual.Move.prototype,{__class__:MochiKit.Visual.Move,__init__:function(a,b){this.element=MochiKit.DOM.getElement(a);b=MochiKit.Base.update({x:0,y:0,mode:"relative"},b);this.start(b)},setup:function(){MochiKit.Style.makePositioned(this.element);var a=this.element.style,b=a.visibility,c=a.display;if(c=="none"){a.visibility="hidden";a.display=""}this.originalLeft=parseFloat(MochiKit.Style.getStyle(this.element,"left")||"0");this.originalTop=parseFloat(MochiKit.Style.getStyle(this.element,
"top")||"0");if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop}if(c=="none"){a.visibility=b;a.display=c}},update:function(a){MochiKit.Style.setStyle(this.element,{left:Math.round(this.options.x*a+this.originalLeft)+"px",top:Math.round(this.options.y*a+this.originalTop)+"px"})}});MochiKit.Visual.Scale=function(a,b,c){var d=arguments.callee;if(!(this instanceof d))return new d(a,b,c);this.__init__(a,b,c)};MochiKit.Visual.Scale.prototype=new MochiKit.Visual.Base;
MochiKit.Base.update(MochiKit.Visual.Scale.prototype,{__class__:MochiKit.Visual.Scale,__init__:function(a,b,c){this.element=MochiKit.DOM.getElement(a);c=MochiKit.Base.update({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:b},c);this.start(c)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=MochiKit.Style.getStyle(this.element,"position");var a=MochiKit.Base.map,b=MochiKit.Base.bind;this.originalStyle=
{};a(b(function(d){this.originalStyle[d]=this.element.style[d]},this),["top","left","width","height","fontSize"]);this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var c=MochiKit.Style.getStyle(this.element,"font-size")||"100%";a(b(function(d){if(c.indexOf(d)>0){this.fontSize=parseFloat(c);this.fontSizeType=d}},this),["em","px","%"]);this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=/^content/.test(this.options.scaleMode)?[this.element.scrollHeight,
this.element.scrollWidth]:this.options.scaleMode=="box"?[this.element.offsetHeight,this.element.offsetWidth]:[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]},update:function(a){a=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&MochiKit.Style.setStyle(this.element,{fontSize:this.fontSize*a+this.fontSizeType});this.setDimensions(this.dims[0]*a,this.dims[1]*a)},finish:function(){this.restoreAfterFinish&&MochiKit.Style.setStyle(this.element,
this.originalStyle)},setDimensions:function(a,b){var c={},d=Math.round;if(/MSIE/.test(navigator.userAgent))d=Math.ceil;if(this.options.scaleX)c.width=d(b)+"px";if(this.options.scaleY)c.height=d(a)+"px";if(this.options.scaleFromCenter){d=(a-this.dims[0])/2;var e=(b-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY)c.top=this.originalTop-d+"px";if(this.options.scaleX)c.left=this.originalLeft-e+"px"}else{if(this.options.scaleY)c.top=-d+"px";if(this.options.scaleX)c.left=
-e+"px"}}MochiKit.Style.setStyle(this.element,c)}});MochiKit.Visual.Highlight=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};MochiKit.Visual.Highlight.prototype=new MochiKit.Visual.Base;
MochiKit.Base.update(MochiKit.Visual.Highlight.prototype,{__class__:MochiKit.Visual.Highlight,__init__:function(a,b){this.element=MochiKit.DOM.getElement(a);b=MochiKit.Base.update({startcolor:"#ffff99"},b);this.start(b)},setup:function(){var a=MochiKit.Base,b=MochiKit.Style;if(b.getStyle(this.element,"display")=="none")this.cancel();else{this.oldStyle={backgroundImage:b.getStyle(this.element,"background-image")};b.setStyle(this.element,{backgroundImage:"none"});if(!this.options.endcolor)this.options.endcolor=
MochiKit.Color.Color.fromBackground(this.element).toHexString();if(a.isUndefinedOrNull(this.options.restorecolor))this.options.restorecolor=b.getStyle(this.element,"background-color");this._base=a.map(a.bind(function(c){return parseInt(this.options.startcolor.slice(c*2+1,c*2+3),16)},this),[0,1,2]);this._delta=a.map(a.bind(function(c){return parseInt(this.options.endcolor.slice(c*2+1,c*2+3),16)-this._base[c]},this),[0,1,2])}},update:function(a){var b="#";MochiKit.Base.map(MochiKit.Base.bind(function(c){b+=
MochiKit.Color.toColorPart(Math.round(this._base[c]+this._delta[c]*a))},this),[0,1,2]);MochiKit.Style.setStyle(this.element,{backgroundColor:b})},finish:function(){MochiKit.Style.setStyle(this.element,MochiKit.Base.update(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});MochiKit.Visual.ScrollTo=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};MochiKit.Visual.ScrollTo.prototype=new MochiKit.Visual.Base;
MochiKit.Base.update(MochiKit.Visual.ScrollTo.prototype,{__class__:MochiKit.Visual.ScrollTo,__init__:function(a,b){this.element=MochiKit.DOM.getElement(a);this.start(b)},setup:function(){var a=MochiKit.Position;a.prepare();var b=a.cumulativeOffset(this.element);if(this.options.offset)b.y+=this.options.offset;var c;if(window.innerHeight)c=window.innerHeight-window.height;else if(document.documentElement&&document.documentElement.clientHeight)c=document.documentElement.clientHeight-document.body.scrollHeight;
else if(document.body)c=document.body.clientHeight-document.body.scrollHeight;this.scrollStart=a.windowOffset.y;this.delta=(b.y>c?c:b.y)-this.scrollStart},update:function(a){var b=MochiKit.Position;b.prepare();window.scrollTo(b.windowOffset.x,this.scrollStart+a*this.delta)}});MochiKit.Visual._CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;MochiKit.Visual.Morph=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};
MochiKit.Visual.Morph.prototype=new MochiKit.Visual.Base;
MochiKit.Base.update(MochiKit.Visual.Morph.prototype,{__class__:MochiKit.Visual.Morph,__init__:function(a,b){this.element=MochiKit.DOM.getElement(a);this.start(b)},setup:function(){var a=MochiKit.Base,b=this.options.style;this.styleStart={};this.styleEnd={};this.units={};var c,d,e;for(e in b){c=b[e];e=a.camelize(e);if(MochiKit.Visual._CSS_LENGTH.test(c)){d=c.match(/^([\+\-]?[0-9\.]+)(.*)$/);c=parseFloat(d[1]);d=d.length==3?d[2]:null;this.styleEnd[e]=c;this.units[e]=d;c=MochiKit.Style.getStyle(this.element,
e);d=c.match(/^([\+\-]?[0-9\.]+)(.*)$/);c=parseFloat(d[1]);this.styleStart[e]=c}else if(/[Cc]olor$/.test(e)){d=MochiKit.Color.Color;if(c=d.fromString(c)){this.units[e]="color";this.styleEnd[e]=c.toHexString();c=MochiKit.Style.getStyle(this.element,e);this.styleStart[e]=d.fromString(c).toHexString();this.styleStart[e]=a.map(a.bind(function(f){return parseInt(this.styleStart[e].slice(f*2+1,f*2+3),16)},this),[0,1,2]);this.styleEnd[e]=a.map(a.bind(function(f){return parseInt(this.styleEnd[e].slice(f*
2+1,f*2+3),16)},this),[0,1,2])}}else this.element.style[e]=c}},update:function(a){var b,c;for(c in this.styleStart)if(this.units[c]=="color"){var d="#",e=this.styleStart[c],f=this.styleEnd[c];MochiKit.Base.map(MochiKit.Base.bind(function(g){d+=MochiKit.Color.toColorPart(Math.round(e[g]+(f[g]-e[g])*a))},this),[0,1,2]);this.element.style[c]=d}else{b=this.styleStart[c]+Math.round((this.styleEnd[c]-this.styleStart[c])*a*1E3)/1E3+this.units[c];this.element.style[c]=b}}});
MochiKit.Visual.fade=function(a,b){var c=MochiKit.Style,d=c.getStyle(a,"opacity");b=MochiKit.Base.update({from:c.getStyle(a,"opacity")||1,to:0,afterFinishInternal:function(e){if(e.options.to===0){c.hideElement(e.element);c.setStyle(e.element,{opacity:d})}}},b);return new MochiKit.Visual.Opacity(a,b)};
MochiKit.Visual.appear=function(a,b){var c=MochiKit.Style,d=MochiKit.Visual;b=MochiKit.Base.update({from:c.getStyle(a,"display")=="none"?0:c.getStyle(a,"opacity")||0,to:1,afterFinishInternal:function(e){d._forceRerendering(e.element)},beforeSetupInternal:function(e){c.setStyle(e.element,{opacity:e.options.from});c.showElement(e.element)}},b);return new d.Opacity(a,b)};
MochiKit.Visual.puff=function(a,b){var c=MochiKit.Style,d=MochiKit.Visual;a=MochiKit.DOM.getElement(a);var e=MochiKit.Style.getElementDimensions(a,true),f={position:c.getStyle(a,"position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height,opacity:c.getStyle(a,"opacity")};b=MochiKit.Base.update({beforeSetupInternal:function(g){MochiKit.Position.absolutize(g.effects[0].element)},afterFinishInternal:function(g){c.hideElement(g.effects[0].element);c.setStyle(g.effects[0].element,
f)},scaleContent:true,scaleFromCenter:true},b);return new d.Parallel([new d.Scale(a,200,{sync:true,scaleFromCenter:b.scaleFromCenter,scaleMode:{originalHeight:e.h,originalWidth:e.w},scaleContent:b.scaleContent,restoreAfterFinish:true}),new d.Opacity(a,{sync:true,to:0})],b)};
MochiKit.Visual.blindUp=function(a,b){var c=MochiKit.Style;a=MochiKit.DOM.getElement(a);var d=c.getElementDimensions(a,true),e=c.makeClipping(a);b=MochiKit.Base.update({scaleContent:false,scaleX:false,scaleMode:{originalHeight:d.h,originalWidth:d.w},restoreAfterFinish:true,afterFinishInternal:function(f){c.hideElement(f.element);c.undoClipping(f.element,e)}},b);return new MochiKit.Visual.Scale(a,0,b)};
MochiKit.Visual.blindDown=function(a,b){var c=MochiKit.Style;a=MochiKit.DOM.getElement(a);var d=c.getElementDimensions(a,true),e;b=MochiKit.Base.update({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:d.h,originalWidth:d.w},restoreAfterFinish:true,afterSetupInternal:function(f){e=c.makeClipping(f.element);c.setStyle(f.element,{height:"0px"});c.showElement(f.element)},afterFinishInternal:function(f){c.undoClipping(f.element,e)}},b);return new MochiKit.Visual.Scale(a,100,b)};
MochiKit.Visual.switchOff=function(a,b){var c=MochiKit.Style;a=MochiKit.DOM.getElement(a);var d=c.getElementDimensions(a,true),e=c.getStyle(a,"opacity"),f;b=MochiKit.Base.update({duration:0.7,restoreAfterFinish:true,beforeSetupInternal:function(){c.makePositioned(a);f=c.makeClipping(a)},afterFinishInternal:function(){c.hideElement(a);c.undoClipping(a,f);c.undoPositioned(a);c.setStyle(a,{opacity:e})}},b);var g=MochiKit.Visual;return new g.Sequence([new g.appear(a,{sync:true,duration:0.57*b.duration,
from:0,transition:g.Transitions.flicker}),new g.Scale(a,1,{sync:true,duration:0.43*b.duration,scaleFromCenter:true,scaleX:false,scaleMode:{originalHeight:d.h,originalWidth:d.w},scaleContent:false,restoreAfterFinish:true})],b)};
MochiKit.Visual.dropOut=function(a,b){var c=MochiKit.Style;a=MochiKit.DOM.getElement(a);var d={top:c.getStyle(a,"top"),left:c.getStyle(a,"left"),opacity:c.getStyle(a,"opacity")};b=MochiKit.Base.update({duration:0.5,distance:100,beforeSetupInternal:function(f){c.makePositioned(f.effects[0].element)},afterFinishInternal:function(f){c.hideElement(f.effects[0].element);c.undoPositioned(f.effects[0].element);c.setStyle(f.effects[0].element,d)}},b);var e=MochiKit.Visual;return new e.Parallel([new e.Move(a,
{x:0,y:b.distance,sync:true}),new e.Opacity(a,{sync:true,to:0})],b)};
MochiKit.Visual.shake=function(a,b){var c=MochiKit.Visual,d=MochiKit.Style;a=MochiKit.DOM.getElement(a);var e={top:d.getStyle(a,"top"),left:d.getStyle(a,"left")};b=MochiKit.Base.update({duration:0.5,afterFinishInternal:function(){d.undoPositioned(a);d.setStyle(a,e)}},b);return new c.Sequence([new c.Move(a,{sync:true,duration:0.1*b.duration,x:20,y:0}),new c.Move(a,{sync:true,duration:0.2*b.duration,x:-40,y:0}),new c.Move(a,{sync:true,duration:0.2*b.duration,x:40,y:0}),new c.Move(a,{sync:true,duration:0.2*
b.duration,x:-40,y:0}),new c.Move(a,{sync:true,duration:0.2*b.duration,x:40,y:0}),new c.Move(a,{sync:true,duration:0.1*b.duration,x:-20,y:0})],b)};
MochiKit.Visual.slideDown=function(a,b){var c=MochiKit.DOM,d=MochiKit.Base,e=MochiKit.Style;a=c.getElement(a);if(!a.firstChild)throw Error("MochiKit.Visual.slideDown must be used on a element with a child");c.removeEmptyTextNodes(a);var f=e.getStyle(a.firstChild,"bottom")||0;c=e.getElementDimensions(a,true);var g;b=d.update({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:c.h,originalWidth:c.w},restoreAfterFinish:true,afterSetupInternal:function(h){e.makePositioned(h.element);
e.makePositioned(h.element.firstChild);/Opera/.test(navigator.userAgent)&&e.setStyle(h.element,{top:""});g=e.makeClipping(h.element);e.setStyle(h.element,{height:"0px"});e.showElement(h.element)},afterUpdateInternal:function(h){var i=e.getElementDimensions(h.element,true);e.setStyle(h.element.firstChild,{bottom:h.dims[0]-i.h+"px"})},afterFinishInternal:function(h){e.undoClipping(h.element,g);if(/MSIE/.test(navigator.userAgent)){e.undoPositioned(h.element);e.undoPositioned(h.element.firstChild)}else{e.undoPositioned(h.element.firstChild);
e.undoPositioned(h.element)}e.setStyle(h.element.firstChild,{bottom:f})}},b);return new MochiKit.Visual.Scale(a,100,b)};
MochiKit.Visual.slideUp=function(a,b){var c=MochiKit.DOM,d=MochiKit.Base,e=MochiKit.Style;a=c.getElement(a);if(!a.firstChild)throw Error("MochiKit.Visual.slideUp must be used on a element with a child");c.removeEmptyTextNodes(a);var f=e.getStyle(a.firstChild,"bottom");c=e.getElementDimensions(a,true);var g;b=d.update({scaleContent:false,scaleX:false,scaleMode:{originalHeight:c.h,originalWidth:c.w},scaleFrom:100,restoreAfterFinish:true,beforeStartInternal:function(h){e.makePositioned(h.element);e.makePositioned(h.element.firstChild);
/Opera/.test(navigator.userAgent)&&e.setStyle(h.element,{top:""});g=e.makeClipping(h.element);e.showElement(h.element)},afterUpdateInternal:function(h){var i=e.getElementDimensions(h.element,true);e.setStyle(h.element.firstChild,{bottom:h.dims[0]-i.h+"px"})},afterFinishInternal:function(h){e.hideElement(h.element);e.undoClipping(h.element,g);e.undoPositioned(h.element.firstChild);e.undoPositioned(h.element);e.setStyle(h.element.firstChild,{bottom:f})}},b);return new MochiKit.Visual.Scale(a,0,b)};
MochiKit.Visual.squish=function(a,b){var c=MochiKit.Base,d=MochiKit.Style,e=d.getElementDimensions(a,true),f;b=c.update({restoreAfterFinish:true,scaleMode:{originalHeight:e.w,originalWidth:e.h},beforeSetupInternal:function(g){f=d.makeClipping(g.element)},afterFinishInternal:function(g){d.hideElement(g.element);d.undoClipping(g.element,f)}},b);return new MochiKit.Visual.Scale(a,/Opera/.test(navigator.userAgent)?1:0,b)};
MochiKit.Visual.grow=function(a,b){var c=MochiKit.Visual,d=MochiKit.Style;a=MochiKit.DOM.getElement(a);b=MochiKit.Base.update({direction:"center",moveTransition:c.Transitions.sinoidal,scaleTransition:c.Transitions.sinoidal,opacityTransition:c.Transitions.full,scaleContent:true,scaleFromCenter:false},b);var e={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:d.getStyle(a,"opacity")},f=d.getElementDimensions(a,true),g,h,i,j;switch(b.direction){case "top-left":g=h=
i=j=0;break;case "top-right":g=f.w;h=j=0;i=-f.w;break;case "bottom-left":g=i=0;h=f.h;j=-f.h;break;case "bottom-right":g=f.w;h=f.h;i=-f.w;j=-f.h;break;case "center":g=f.w/2;h=f.h/2;i=-f.w/2;j=-f.h/2}var k=MochiKit.Base.update({beforeSetupInternal:function(l){d.setStyle(l.effects[0].element,{height:"0px"});d.showElement(l.effects[0].element)},afterFinishInternal:function(l){d.undoClipping(l.effects[0].element);d.undoPositioned(l.effects[0].element);d.setStyle(l.effects[0].element,e)}},b);return new c.Move(a,
{x:g,y:h,duration:0.01,beforeSetupInternal:function(l){d.hideElement(l.element);d.makeClipping(l.element);d.makePositioned(l.element)},afterFinishInternal:function(l){new c.Parallel([new c.Opacity(l.element,{sync:true,to:1,from:0,transition:b.opacityTransition}),new c.Move(l.element,{x:i,y:j,sync:true,transition:b.moveTransition}),new c.Scale(l.element,100,{scaleMode:{originalHeight:f.h,originalWidth:f.w},sync:true,scaleFrom:/Opera/.test(navigator.userAgent)?1:0,transition:b.scaleTransition,scaleContent:b.scaleContent,
scaleFromCenter:b.scaleFromCenter,restoreAfterFinish:true})],k)}})};
MochiKit.Visual.shrink=function(a,b){var c=MochiKit.Visual,d=MochiKit.Style;a=MochiKit.DOM.getElement(a);b=MochiKit.Base.update({direction:"center",moveTransition:c.Transitions.sinoidal,scaleTransition:c.Transitions.sinoidal,opacityTransition:c.Transitions.none,scaleContent:true,scaleFromCenter:false},b);var e={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:d.getStyle(a,"opacity")},f=d.getElementDimensions(a,true),g,h;switch(b.direction){case "top-left":g=h=0;
break;case "top-right":g=f.w;h=0;break;case "bottom-left":g=0;h=f.h;break;case "bottom-right":g=f.w;h=f.h;break;case "center":g=f.w/2;h=f.h/2}var i,j=MochiKit.Base.update({beforeStartInternal:function(k){d.makePositioned(k.effects[0].element);i=d.makeClipping(k.effects[0].element)},afterFinishInternal:function(k){d.hideElement(k.effects[0].element);d.undoClipping(k.effects[0].element,i);d.undoPositioned(k.effects[0].element);d.setStyle(k.effects[0].element,e)}},b);return new c.Parallel([new c.Opacity(a,
{sync:true,to:0,from:1,transition:b.opacityTransition}),new c.Scale(a,/Opera/.test(navigator.userAgent)?1:0,{scaleMode:{originalHeight:f.h,originalWidth:f.w},sync:true,transition:b.scaleTransition,scaleContent:b.scaleContent,scaleFromCenter:b.scaleFromCenter,restoreAfterFinish:true}),new c.Move(a,{x:g,y:h,sync:true,transition:b.moveTransition})],j)};
MochiKit.Visual.pulsate=function(a,b){var c=MochiKit.Visual,d=MochiKit.Base,e=MochiKit.Style.getStyle(a,"opacity");b=d.update({duration:3,from:0,afterFinishInternal:function(g){MochiKit.Style.setStyle(g.element,{opacity:e})}},b);var f=b.transition||c.Transitions.sinoidal;b.transition=function(g){return f(1-c.Transitions.pulse(g,b.pulses))};return new c.Opacity(a,b)};
MochiKit.Visual.fold=function(a,b){var c=MochiKit.Visual,d=MochiKit.Style;a=MochiKit.DOM.getElement(a);var e=d.getElementDimensions(a,true),f={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height},g=d.makeClipping(a);b=MochiKit.Base.update({scaleContent:false,scaleX:false,scaleMode:{originalHeight:e.h,originalWidth:e.w},afterFinishInternal:function(){new c.Scale(a,1,{scaleContent:false,scaleY:false,scaleMode:{originalHeight:e.h,originalWidth:e.w},afterFinishInternal:function(h){d.hideElement(h.element);
d.undoClipping(h.element,g);d.setStyle(h.element,f)}})}},b);return new c.Scale(a,5,b)};MochiKit.Base.nameFunctions(MochiKit.Visual);MochiKit.Base._exportSymbols(this,MochiKit.Visual);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.DragAndDrop={};MochiKit.Base.module(MochiKit,"DragAndDrop","1.5",["Base","Iter","DOM","Signal","Visual","Position"]);
MochiKit.DragAndDrop.Droppables={drops:[],remove:function(a){this.drops=MochiKit.Base.filter(function(b){return b.element!=MochiKit.DOM.getElement(a)},this.drops)},register:function(a){this.drops.push(a)},unregister:function(a){this.drops=MochiKit.Base.filter(function(b){return b!=a},this.drops)},prepare:function(a){MochiKit.Base.map(function(b){if(b.isAccepted(a)){b.options.activeclass&&MochiKit.DOM.addElementClass(b.element,b.options.activeclass);b.options.onactive(b.element,a)}},this.drops)},findDeepestChild:function(a){for(var b=
a[0],c=1;c<a.length;++c)if(MochiKit.DOM.isChildNode(a[c].element,b.element))b=a[c];return b},show:function(a,b){if(this.drops.length){var c=[];this.last_active&&this.last_active.deactivate();MochiKit.Iter.forEach(this.drops,function(e){e.isAffected(a,b)&&c.push(e)});if(c.length>0){var d=this.findDeepestChild(c);MochiKit.Position.within(d.element,a.page.x,a.page.y);d.options.onhover(b,d.element,MochiKit.Position.overlap(d.options.overlap,d.element));d.activate()}}},fire:function(a,b){if(this.last_active){MochiKit.Position.prepare();
this.last_active.isAffected(a.mouse(),b)&&this.last_active.options.ondrop(b,this.last_active.element,a)}},reset:function(a){MochiKit.Base.map(function(b){b.options.activeclass&&MochiKit.DOM.removeElementClass(b.element,b.options.activeclass);b.options.ondesactive(b.element,a)},this.drops);this.last_active&&this.last_active.deactivate()}};MochiKit.DragAndDrop.Droppable=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};
MochiKit.DragAndDrop.Droppable.prototype={__class__:MochiKit.DragAndDrop.Droppable,__init__:function(a,b){var c=MochiKit.DOM,d=MochiKit.Base;this.element=c.getElement(a);this.options=d.update({greedy:true,hoverclass:null,activeclass:null,hoverfunc:d.noop,accept:null,onactive:d.noop,ondesactive:d.noop,onhover:d.noop,ondrop:d.noop,containment:[],tree:false},b);this.options._containers=[];d.map(MochiKit.Base.bind(function(e){this.options._containers.push(c.getElement(e))},this),this.options.containment);
MochiKit.Style.makePositioned(this.element);MochiKit.DragAndDrop.Droppables.register(this)},isContained:function(a){if(this.options._containers.length){var b;b=this.options.tree?a.treeNode:a.parentNode;return MochiKit.Iter.some(this.options._containers,function(c){return b==c})}else return true},isAccepted:function(a){return!this.options.accept||MochiKit.Iter.some(this.options.accept,function(b){return MochiKit.DOM.hasElementClass(a,b)})},isAffected:function(a,b){return this.element!=b&&this.isContained(b)&&
this.isAccepted(b)&&MochiKit.Position.within(this.element,a.page.x,a.page.y)},deactivate:function(){this.options.hoverclass&&MochiKit.DOM.removeElementClass(this.element,this.options.hoverclass);this.options.hoverfunc(this.element,false);MochiKit.DragAndDrop.Droppables.last_active=null},activate:function(){this.options.hoverclass&&MochiKit.DOM.addElementClass(this.element,this.options.hoverclass);this.options.hoverfunc(this.element,true);MochiKit.DragAndDrop.Droppables.last_active=this},destroy:function(){MochiKit.DragAndDrop.Droppables.unregister(this)},
repr:function(){return"["+this.__class__.NAME+", options:"+MochiKit.Base.repr(this.options)+"]"}};
MochiKit.DragAndDrop.Draggables={drags:[],register:function(a){if(this.drags.length===0){var b=MochiKit.Signal.connect;this.eventMouseUp=b(document,"onmouseup",this,this.endDrag);this.eventMouseMove=b(document,"onmousemove",this,this.updateDrag);this.eventKeypress=b(document,"onkeypress",this,this.keyPress)}this.drags.push(a)},unregister:function(a){this.drags=MochiKit.Base.filter(function(c){return c!=a},this.drags);if(this.drags.length===0){var b=MochiKit.Signal.disconnect;b(this.eventMouseUp);
b(this.eventMouseMove);b(this.eventKeypress)}},activate:function(a){window.focus();this.activeDraggable=a},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(this.activeDraggable){var b=a.mouse();if(!(this._lastPointer&&MochiKit.Base.repr(this._lastPointer.page)==MochiKit.Base.repr(b.page))){this._lastPointer=b;this.activeDraggable.updateDrag(a,b)}}},endDrag:function(a){if(this.activeDraggable){this._lastPointer=null;this.activeDraggable.endDrag(a);this.activeDraggable=null}},
keyPress:function(a){this.activeDraggable&&this.activeDraggable.keyPress(a)},notify:function(a,b,c){MochiKit.Signal.signal(this,a,b,c)}};MochiKit.DragAndDrop.Draggable=function(a,b){var c=arguments.callee;if(!(this instanceof c))return new c(a,b);this.__init__(a,b)};
MochiKit.DragAndDrop.Draggable.prototype={__class__:MochiKit.DragAndDrop.Draggable,__init__:function(a,b){var c=MochiKit.Visual,d=MochiKit.Base;b=d.update({handle:false,starteffect:function(e){this._savedOpacity=MochiKit.Style.getStyle(e,"opacity")||1;new c.Opacity(e,{duration:0.2,from:this._savedOpacity,to:0.7})},reverteffect:function(e,f,g){return new c.Move(e,{x:-g,y:-f,duration:Math.sqrt(Math.abs(f^2)+Math.abs(g^2))*0.02})},endeffect:function(e){new c.Opacity(e,{duration:0.2,from:0.7,to:this._savedOpacity})},
onchange:d.noop,zindex:1E3,revert:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false},b);d=MochiKit.DOM;this.element=d.getElement(a);if(b.handle&&typeof b.handle=="string")this.handle=d.getFirstElementByTagAndClassName(null,b.handle,this.element);if(!this.handle)this.handle=d.getElement(b.handle);if(!this.handle)this.handle=this.element;if(b.scroll&&!b.scroll.scrollTo&&!b.scroll.outerHTML){b.scroll=d.getElement(b.scroll);this._isScrollChild=MochiKit.DOM.isChildNode(this.element,b.scroll)}MochiKit.Style.makePositioned(this.element);
this.delta=this.currentDelta();this.options=b;this.dragging=false;this.eventMouseDown=MochiKit.Signal.connect(this.handle,"onmousedown",this,this.initDrag);MochiKit.DragAndDrop.Draggables.register(this)},destroy:function(){MochiKit.Signal.disconnect(this.eventMouseDown);MochiKit.DragAndDrop.Draggables.unregister(this)},currentDelta:function(){var a=MochiKit.Style.getStyle;return[parseInt(a(this.element,"left")||"0",10),parseInt(a(this.element,"top")||"0",10)]},initDrag:function(a){if(a.mouse().button.left){var b=
(a.target().tagName||"").toUpperCase();if(!(b==="INPUT"||b==="SELECT"||b==="OPTION"||b==="BUTTON"||b==="TEXTAREA")){if(this._revert){this._revert.cancel();this._revert=null}b=a.mouse();var c=MochiKit.Position.cumulativeOffset(this.element);this.offset=[b.page.x-c.x,b.page.y-c.y];MochiKit.DragAndDrop.Draggables.activate(this);a.stop()}}},startDrag:function(a){this.dragging=true;this.options.selectclass&&MochiKit.DOM.addElementClass(this.element,this.options.selectclass);if(this.options.zindex){this.originalZ=
MochiKit.Style.getStyle(this.element,"z-index");this.element.style.zIndex=this.options.zindex}if(this.options.ghosting){this._clone=this.element.cloneNode(true);this.ghostPosition=MochiKit.Position.absolutize(this.element);this.element.parentNode.insertBefore(this._clone,this.element)}if(this.options.scroll)if(this.options.scroll==window){var b=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=b.left;this.originalScrollTop=b.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;
this.originalScrollTop=this.options.scroll.scrollTop}MochiKit.DragAndDrop.Droppables.prepare(this.element);MochiKit.DragAndDrop.Draggables.notify("start",this,a);this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(a,b){this.dragging||this.startDrag(a);MochiKit.Position.prepare();MochiKit.DragAndDrop.Droppables.show(b,this.element);MochiKit.DragAndDrop.Draggables.notify("drag",this,a);this.draw(b);this.options.onchange(this);if(this.options.scroll){this.stopScrolling();
var c,d;if(this.options.scroll==window){d=this._getWindowScroll(this.options.scroll);c=new MochiKit.Style.Coordinates(d.left,d.top);d=new MochiKit.Style.Coordinates(d.left+d.width,d.top+d.height)}else{c=MochiKit.Position.page(this.options.scroll);c.x+=this.options.scroll.scrollLeft;c.y+=this.options.scroll.scrollTop;c.x+=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;c.y+=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;d=new MochiKit.Style.Coordinates(c.x+
this.options.scroll.offsetWidth,c.y+this.options.scroll.offsetHeight)}var e=[0,0];if(b.page.x>d.x-this.options.scrollSensitivity)e[0]=b.page.x-(d.x-this.options.scrollSensitivity);else if(b.page.x<c.x+this.options.scrollSensitivity)e[0]=b.page.x-(c.x+this.options.scrollSensitivity);if(b.page.y>d.y-this.options.scrollSensitivity)e[1]=b.page.y-(d.y-this.options.scrollSensitivity);else if(b.page.y<c.y+this.options.scrollSensitivity)e[1]=b.page.y-(c.y+this.options.scrollSensitivity);this.startScrolling(e)}/AppleWebKit/.test(navigator.appVersion)&&
window.scrollBy(0,0);a.stop()},finishDrag:function(a,b){var c=MochiKit.DragAndDrop;this.dragging=false;this.options.selectclass&&MochiKit.DOM.removeElementClass(this.element,this.options.selectclass);if(this.options.ghosting){MochiKit.Position.relativize(this.element,this.ghostPosition);MochiKit.DOM.removeElement(this._clone);this._clone=null}b&&c.Droppables.fire(a,this.element);c.Draggables.notify("end",this,a);var d=this.options.revert;if(d&&typeof d=="function")d=d(this.element);var e=this.currentDelta();
if(d&&this.options.reverteffect)this._revert=this.options.reverteffect(this.element,e[1]-this.delta[1],e[0]-this.delta[0]);else this.delta=e;if(this.options.zindex)this.element.style.zIndex=this.originalZ;this.options.endeffect&&this.options.endeffect(this.element);c.Draggables.deactivate();c.Droppables.reset(this.element)},keyPress:function(a){if(a.key().string=="KEY_ESCAPE"){this.finishDrag(a,false);a.stop()}},endDrag:function(a){if(this.dragging){this.stopScrolling();this.finishDrag(a,true);a.stop()}},
draw:function(a){var b=MochiKit.Position.cumulativeOffset(this.element),c=this.currentDelta();b.x-=c[0];b.y-=c[1];if(this.options.scroll&&this.options.scroll!=window&&this._isScrollChild){b.x-=this.options.scroll.scrollLeft-this.originalScrollLeft;b.y-=this.options.scroll.scrollTop-this.originalScrollTop}a=[a.page.x-b.x-this.offset[0],a.page.y-b.y-this.offset[1]];if(this.options.snap)if(typeof this.options.snap=="function")a=this.options.snap(a[0],a[1]);else if(this.options.snap instanceof Array){var d=
-1;a=MochiKit.Base.map(MochiKit.Base.bind(function(e){d+=1;return Math.round(e/this.options.snap[d])*this.options.snap[d]},this),a)}else a=MochiKit.Base.map(MochiKit.Base.bind(function(e){return Math.round(e/this.options.snap)*this.options.snap},this),a);b=this.element.style;if(!this.options.constraint||this.options.constraint=="horizontal")b.left=a[0]+"px";if(!this.options.constraint||this.options.constraint=="vertical")b.top=a[1]+"px";if(b.visibility=="hidden")b.visibility=""},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);
this.scrollInterval=null;MochiKit.DragAndDrop.Draggables._lastScrollPointer=null}},startScrolling:function(a){if(a[0]||a[1]){this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed];this.lastScrolled=new Date;this.scrollInterval=setInterval(MochiKit.Base.bind(this.scroll,this),10)}},scroll:function(){var a=new Date,b=a-this.lastScrolled;this.lastScrolled=a;if(this.options.scroll==window){a=this._getWindowScroll(this.options.scroll);if(this.scrollSpeed[0]||this.scrollSpeed[1]){var c=
b/1E3;this.options.scroll.scrollTo(a.left+c*this.scrollSpeed[0],a.top+c*this.scrollSpeed[1])}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*b/1E3;this.options.scroll.scrollTop+=this.scrollSpeed[1]*b/1E3}a=MochiKit.DragAndDrop;MochiKit.Position.prepare();a.Droppables.show(a.Draggables._lastPointer,this.element);a.Draggables.notify("drag",this);if(this._isScrollChild){a.Draggables._lastScrollPointer=a.Draggables._lastScrollPointer||a.Draggables._lastPointer;a.Draggables._lastScrollPointer.x+=
this.scrollSpeed[0]*b/1E3;a.Draggables._lastScrollPointer.y+=this.scrollSpeed[1]*b/1E3;if(a.Draggables._lastScrollPointer.x<0)a.Draggables._lastScrollPointer.x=0;if(a.Draggables._lastScrollPointer.y<0)a.Draggables._lastScrollPointer.y=0;this.draw(a.Draggables._lastScrollPointer)}this.options.onchange(this)},_getWindowScroll:function(a){var b,c,d;MochiKit.DOM.withWindow(a,function(){b=MochiKit.Style.getViewportPosition(a.document)});if(a.innerWidth){c=a.innerWidth;d=a.innerHeight}else if(a.document.documentElement&&
a.document.documentElement.clientWidth){c=a.document.documentElement.clientWidth;d=a.document.documentElement.clientHeight}else{c=a.document.body.offsetWidth;d=a.document.body.offsetHeight}return{top:b.y,left:b.x,width:c,height:d}},repr:function(){return"["+this.__class__.NAME+", options:"+MochiKit.Base.repr(this.options)+"]"}};MochiKit.DragAndDrop.__new__=function(){MochiKit.Base.nameFunctions(this)};MochiKit.DragAndDrop.__new__();MochiKit.Base._exportSymbols(this,MochiKit.DragAndDrop);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Sortable={};MochiKit.Base.module(MochiKit,"Sortable","1.5",["Base","Iter","DOM","Position","DragAndDrop"]);
MochiKit.Base.update(MochiKit.Sortable,{__export__:false,sortables:{},_findRootElement:function(a){for(;a.tagName.toUpperCase()!="BODY";){if(a.id&&MochiKit.Sortable.sortables[a.id])return a;a=a.parentNode}},_createElementId:function(a){if(a.id==null||a.id==""){for(var b=MochiKit.DOM,c,d=1;b.getElement(c="sortable"+d)!=null;)d+=1;b.setNodeAttribute(a,"id",c)}},options:function(a){if(a=MochiKit.Sortable._findRootElement(MochiKit.DOM.getElement(a)))return MochiKit.Sortable.sortables[a.id]},destroy:function(a){a=
MochiKit.Sortable.options(a);var b=MochiKit.Base,c=MochiKit.DragAndDrop;if(a){MochiKit.Signal.disconnect(a.startHandle);MochiKit.Signal.disconnect(a.endHandle);b.map(function(d){c.Droppables.remove(d)},a.droppables);b.map(function(d){d.destroy()},a.draggables);delete MochiKit.Sortable.sortables[a.element.id]}},create:function(a,b){a=MochiKit.DOM.getElement(a);var c=MochiKit.Sortable;c._createElementId(a);b=MochiKit.Base.update({element:a,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",
constraint:"vertical",containment:[a],handle:false,only:false,hoverclass:null,ghosting:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:/^[^_]*_(.*)$/,onChange:MochiKit.Base.noop,onUpdate:MochiKit.Base.noop,accept:null},b);c.destroy(a);var d={revert:true,ghosting:b.ghosting,scroll:b.scroll,scrollSensitivity:b.scrollSensitivity,scrollSpeed:b.scrollSpeed,constraint:b.constraint,handle:b.handle};if(b.starteffect)d.starteffect=b.starteffect;if(b.reverteffect)d.reverteffect=b.reverteffect;
else if(b.ghosting)d.reverteffect=function(g){g.style.top=0;g.style.left=0};if(b.endeffect)d.endeffect=b.endeffect;if(b.zindex)d.zindex=b.zindex;var e={overlap:b.overlap,containment:b.containment,hoverclass:b.hoverclass,onhover:c.onHover,tree:b.tree,accept:b.accept},f={onhover:c.onEmptyHover,overlap:b.overlap,containment:b.containment,hoverclass:b.hoverclass,accept:b.accept};MochiKit.DOM.removeEmptyTextNodes(a);b.draggables=[];b.droppables=[];if(b.dropOnEmpty||b.tree){new MochiKit.DragAndDrop.Droppable(a,
f);b.droppables.push(a)}MochiKit.Base.map(function(g){var h=b.handle?MochiKit.DOM.getFirstElementByTagAndClassName(null,b.handle,g):g;b.draggables.push(new MochiKit.DragAndDrop.Draggable(g,MochiKit.Base.update(d,{handle:h})));new MochiKit.DragAndDrop.Droppable(g,e);if(b.tree)g.treeNode=a;b.droppables.push(g)},c.findElements(a,b)||[]);if(b.tree)MochiKit.Base.map(function(g){new MochiKit.DragAndDrop.Droppable(g,f);g.treeNode=a;b.droppables.push(g)},c.findTreeElements(a,b)||[]);c.sortables[a.id]=b;b.lastValue=
c.serialize(a);b.startHandle=MochiKit.Signal.connect(MochiKit.DragAndDrop.Draggables,"start",MochiKit.Base.partial(c.onStart,a));b.endHandle=MochiKit.Signal.connect(MochiKit.DragAndDrop.Draggables,"end",MochiKit.Base.partial(c.onEnd,a))},onStart:function(a){var b=MochiKit.Sortable;a=b.options(a);a.lastValue=b.serialize(a.element)},onEnd:function(a){var b=MochiKit.Sortable;b.unmark();a=b.options(a);a.lastValue!=b.serialize(a.element)&&a.onUpdate(a.element)},findElements:function(a,b){return MochiKit.Sortable.findChildren(a,
b.only,b.tree,b.tag)},findTreeElements:function(a,b){return MochiKit.Sortable.findChildren(a,b.only,b.tree?true:false,b.treeTag)},findChildren:function(a,b,c,d){if(!a.hasChildNodes())return null;d=d.toUpperCase();if(b)b=MochiKit.Base.flattenArray([b]);var e=[];MochiKit.Base.map(function(f){if(f.tagName&&f.tagName.toUpperCase()==d&&(!b||MochiKit.Iter.some(b,function(h){return MochiKit.DOM.hasElementClass(f,h)})))e.push(f);if(c){var g=MochiKit.Sortable.findChildren(f,b,c,d);if(g&&g.length>0)e=e.concat(g)}},
a.childNodes);return e},onHover:function(a,b,c){if(!MochiKit.DOM.isChildNode(b,a)){var d=MochiKit.Sortable;if(!(c>0.33&&c<0.66&&d.options(b).tree))if(c>0.5){d.mark(b,"before");if(b.previousSibling!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,b);b.parentNode!=c&&d.options(c).onChange(a);d.options(b.parentNode).onChange(a)}}else{d.mark(b,"after");var e=b.nextSibling||null;if(e!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,e);b.parentNode!=c&&
d.options(c).onChange(a);d.options(b.parentNode).onChange(a)}}}},_offsetSize:function(a,b){return b=="vertical"||b=="height"?a.offsetHeight:a.offsetWidth},onEmptyHover:function(a,b,c){var d=a.parentNode,e=MochiKit.Sortable,f=e.options(b);if(!MochiKit.DOM.isChildNode(b,a)){var g=e.findElements(b,{tag:f.tag,only:f.only}),h=null;if(g){var i=e._offsetSize(b,f.overlap)*(1-c);for(c=0;c<g.length;c+=1)if(i-e._offsetSize(g[c],f.overlap)>=0)i-=e._offsetSize(g[c],f.overlap);else{h=i-e._offsetSize(g[c],f.overlap)/
2>=0?c+1<g.length?g[c+1]:null:g[c];break}}b.insertBefore(a,h);e.options(d).onChange(a);f.onChange(a)}},unmark:function(){var a=MochiKit.Sortable._marker;a&&MochiKit.Style.hideElement(a)},mark:function(a,b){var c=MochiKit.DOM,d=MochiKit.Sortable,e=d.options(a.parentNode);if(!(e&&!e.ghosting)){if(!d._marker){d._marker=c.getElement("dropmarker")||document.createElement("DIV");MochiKit.Style.hideElement(d._marker);c.addElementClass(d._marker,"dropmarker");d._marker.style.position="absolute";document.getElementsByTagName("body").item(0).appendChild(d._marker)}c=
MochiKit.Position.cumulativeOffset(a);d._marker.style.left=c.x+"px";d._marker.style.top=c.y+"px";if(b=="after")if(e.overlap=="horizontal")d._marker.style.left=c.x+a.clientWidth+"px";else d._marker.style.top=c.y+a.clientHeight+"px";MochiKit.Style.showElement(d._marker)}},_tree:function(a,b,c){for(var d=MochiKit.Sortable,e=d.findElements(a,b)||[],f=0;f<e.length;++f){var g=e[f].id.match(b.format);if(g){g={id:encodeURIComponent(g?g[1]:null),element:a,parent:c,children:[],position:c.children.length,container:d._findChildrenElement(e[f],
b.treeTag.toUpperCase())};g.container&&d._tree(g.container,b,g);c.children.push(g)}}return c},_findChildrenElement:function(a,b){if(a&&a.hasChildNodes){b=b.toUpperCase();for(var c=0;c<a.childNodes.length;++c)if(a.childNodes[c].tagName.toUpperCase()==b)return a.childNodes[c]}return null},tree:function(a,b){a=MochiKit.DOM.getElement(a);var c=MochiKit.Sortable.options(a);b=MochiKit.Base.update({tag:c.tag,treeTag:c.treeTag,only:c.only,name:a.id,format:c.format},b||{});return MochiKit.Sortable._tree(a,
b,{id:null,parent:null,children:[],container:a,position:0})},setSequence:function(a,b,c){var d=MochiKit.Sortable,e=MochiKit.Base;a=MochiKit.DOM.getElement(a);c=e.update(d.options(a),c||{});var f={};e.map(function(g){var h=g.id.match(c.format);if(h)f[h[1]]=[g,g.parentNode];g.parentNode.removeChild(g)},d.findElements(a,c));e.map(function(g){var h=f[g];if(h){h[1].appendChild(h[0]);delete f[g]}},b)},_constructIndex:function(a){var b="";do if(a.id)b="["+a.position+"]"+b;while((a=a.parent)!=null);return b},
sequence:function(a,b){a=MochiKit.DOM.getElement(a);var c=MochiKit.Sortable;b=MochiKit.Base.update(c.options(a),b||{});return MochiKit.Base.map(function(d){return d.id.match(b.format)?d.id.match(b.format)[1]:""},MochiKit.DOM.getElement(c.findElements(a,b)||[]))},serialize:function(a,b){a=MochiKit.DOM.getElement(a);var c=MochiKit.Sortable;b=MochiKit.Base.update(c.options(a),b||{});var d=encodeURIComponent(b.name||a.id);return b.tree?MochiKit.Base.flattenArray(MochiKit.Base.map(function(e){return[d+
c._constructIndex(e)+"[id]="+encodeURIComponent(e.id)].concat(e.children.map(arguments.callee))},c.tree(a,b).children)).join("&"):MochiKit.Base.map(function(e){return d+"[]="+encodeURIComponent(e)},c.sequence(a,b)).join("&")}});MochiKit.Sortable.Sortable=MochiKit.Sortable;MochiKit.Sortable.__new__=function(){MochiKit.Base.nameFunctions(this)};MochiKit.Sortable.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Sortable);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Base_ext={};MochiKit.Base.module(MochiKit,"Base_ext","1.5",["Base"]);MochiKit.Base._arg_placeholder=function(a){this.index=a};
var _1=new MochiKit.Base._arg_placeholder(0),_2=new MochiKit.Base._arg_placeholder(1),_3=new MochiKit.Base._arg_placeholder(2),_4=new MochiKit.Base._arg_placeholder(3),_5=new MochiKit.Base._arg_placeholder(4),_6=new MochiKit.Base._arg_placeholder(5),_7=new MochiKit.Base._arg_placeholder(6),_8=new MochiKit.Base._arg_placeholder(7),_9=new MochiKit.Base._arg_placeholder(8),_10=new MochiKit.Base._arg_placeholder(9);
MochiKit.Base._rebind_preargs=function(a,b,c){c=c||{};for(var d=0;d<a.length;++d){var e=a[d];if(e instanceof MochiKit.Base._arg_placeholder){if(e.index<b.length){a[d]=b[e.index];c[e.index]=e.index}}else typeof e=="function"&&typeof e.im_func=="function"&&MochiKit.Base._rebind_preargs(e.im_preargs,b,c)}return c};
MochiKit.Base.bind2=function(a,b){if(typeof a=="string")a=b[a];var c=a.im_func,d=a.im_preargs,e=a.im_self,f=MochiKit.Base;if(typeof a=="function"&&typeof a.apply=="undefined")a=f._wrapDumbFunction(a);if(typeof c!="function")c=a;if(typeof b!="undefined")e=b;d=typeof d=="undefined"?[]:d.slice();var g=Array.prototype.slice.call(arguments,b instanceof f._arg_placeholder?1:2),h=MochiKit.Base._rebind_preargs(d,g),i;for(i in h)g.splice(h[i],1);f.extend(d,g);g=function(){var j=arguments.callee,k=j.im_self;
k||(k=this);var l=[];if(j.im_preargs.length>0){for(var m=0,o=0;o<j.im_preargs.length;++o){var p=j.im_preargs[o];if(p instanceof f._arg_placeholder){m=Math.max(m,p.index+1);p=arguments[p.index]}else if(typeof p=="function"&&typeof p.im_func=="function")p=p.apply(k,arguments);l.push(p)}for(m=m;m<arguments.length;++m)l.push(arguments[m])}else l=arguments;if(k instanceof f._arg_placeholder)k=arguments[k.index];return j.im_func.apply(k,l)};g.im_self=e;g.im_func=c;g.im_preargs=d;if(typeof c.NAME=="string")g.NAME=
"bind2("+c.NAME+",...)";return g};MochiKit.Base.partial2=function(a){var b=MochiKit.Base;return b.bind2.apply(this,b.extend([a,undefined],arguments,1))};MochiKit.Base.method2=function(a,b){var c=MochiKit.Base;return c.bind2.apply(this,c.extend([b,a],arguments,2))};MochiKit.Base.bindLate2=function(a){var b=MochiKit.Base,c=arguments;if(typeof a==="string"){c=b.extend([b.forwardCall(a)],arguments,1);return b.bind2.apply(this,c)}return b.bind2.apply(this,c)};
MochiKit.Base.isBoundFunction=function(a){return typeof a=="function"&&typeof a.im_func=="function"};MochiKit.Base.protect=function(a){return function(){return a.apply(this,arguments)}};MochiKit.Base.apply=function(a){var b=MochiKit.Base.extend([],arguments,1);return a.apply(this,b)};
MochiKit.Base.partition=function(a,b,c,d,e){function f(h,i){var j=a[h];a[h]=a[i];a[i]=j}b=b||MochiKit.Base.operator.cle;c=c||0;d=d||a.length-1;e=e||c+Math.floor((d-c)/2);var g=a[e];f(e,d);for(c=e=c;c<=d;++c)if(b(a[c],g)){f(c,e);++e}f(e,d);return e};MochiKit.Base.countValue=function(a,b,c){c=c||MochiKit.Base.operator.ceq;var d=0;MochiKit.Iter.forEach(a,function(e){c(e,b)&&++d});return d};MochiKit.Base.negateComparator=function(a){return function(){return-1*a.apply(this,arguments)}};
MochiKit.Base_ext.__new__=function(){};MochiKit.Base_ext.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Base);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Bisect={};MochiKit.Base.module(MochiKit,"Bisect","1.5",["Base"]);MochiKit.Bisect.bisectRight=function(a,b,c,d){c=c||0;for(d=d||a.length;c<d;){var e=Math.floor((c+d)/2);if(MochiKit.Base.compare(b,a[e])<0)d=e;else c=e+1}return c};MochiKit.Bisect.insortRight=function(a,b,c,d){c=MochiKit.Bisect.bisectRight(a,b,c,d);a.splice(c,0,b);return a};
MochiKit.Bisect.bisectLeft=function(a,b,c,d){c=c||0;for(d=d||a.length;c<d;){var e=Math.floor((c+d)/2);if(MochiKit.Base.compare(a[e],b)<0)c=e+1;else d=e}return c};MochiKit.Bisect.insortLeft=function(a,b,c,d){c=MochiKit.Bisect.bisectLeft(a,b,c,d);a.splice(c,0,b);return a};MochiKit.Bisect.bisect=MochiKit.Bisect.bisectRight;MochiKit.Bisect.insort=MochiKit.Bisect.insortRight;MochiKit.Bisect.__new__=function(){};MochiKit.Bisect.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Bisect);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.HeapQ={};MochiKit.Base.module(MochiKit,"HeapQ","1.5",["Base","Iter"]);MochiKit.HeapQ.heapify=function(a,b){b=b||MochiKit.Base.operator.clt;for(var c=Math.floor(a.length/2)-1;c>=0;--c)MochiKit.HeapQ._siftup(a,c,b);return a};MochiKit.HeapQ._siftdown=function(a,b,c,d){d=d||MochiKit.Base.operator.clt;for(var e=a[c];c>b;){var f=c-1>>1,g=a[f];if(d(e,g)){a[c]=g;c=f}else break}a[c]=e};
MochiKit.HeapQ._siftup=function(a,b,c){c=c||MochiKit.Base.operator.clt;for(var d=a.length,e=b,f=a[b],g=2*b+1;g<d;){var h=g+1;if(h<d&&!c(a[g],a[h]))g=h;a[b]=a[g];b=g;g=2*b+1}a[b]=f;MochiKit.HeapQ._siftdown(a,e,b,c)};MochiKit.HeapQ.heapPush=function(a,b,c){c=c||MochiKit.Base.operator.clt;a.push(b);MochiKit.HeapQ._siftdown(a,0,a.length-1,c)};MochiKit.HeapQ.heapPop=function(a,b){b=b||MochiKit.Base.operator.clt;var c=a.pop(),d;if(a.length>0){d=a[0];a[0]=c;MochiKit.HeapQ._siftup(a,0,b)}else d=c;return d};
MochiKit.HeapQ.heapReplace=function(a,b,c){c=c||MochiKit.Base.operator.clt;var d=a[0];a[0]=b;MochiKit.HeapQ._siftup(a,0,c);return d};MochiKit.HeapQ.heapPushPop=function(a,b,c){c=c||MochiKit.Base.operator.clt;if(a.length>0&&c(a[0],b)){var d=a[0];a[0]=b;b=d;MochiKit.HeapQ._siftup(a,0,c)}return b};
MochiKit.HeapQ.imergeSorted=function(a,b){var c=MochiKit,d=c.Iter;b=b||c.Base.operator.clt;var e=function(g,h){return b(g[0],h[0])},f=[];d.forEach(d.izip(d.count(),d.imap(d.iter,a)),function(g){var h=g[0];g=g[1];try{var i=g.next;f.push([i(),h,i])}catch(j){if(j!=d.StopIteration)throw j;}});c.HeapQ.heapify(f,e);return{repr:function(){return"imergeSorted(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){for(;;){if(f.length==0)throw d.StopIteration;var g=f[0],h=g[0],i=g[2];try{g[0]=i();
c.HeapQ.heapReplace(f,g,e)}catch(j){if(j!=d.StopIteration)throw j;c.HeapQ.heapPop(f,e)}return h}}}};MochiKit.HeapQ.heapIter=function(a,b){b=b||MochiKit.Base.operator.clt;return{next:function(){if(a.length==0)throw MochiKit.Iter.StopIteration;return MochiKit.HeapQ.heapPop(a,b)}}};
MochiKit.HeapQ.nLargest=function(a,b,c){var d=MochiKit,e=d.Iter;c=c||d.Base.operator.clt;b=e.iter(b);var f=e.list(e.islice(b,a));if(f.length==0)return f;d.HeapQ.heapify(f,c);e.forEach(b,function(g){d.HeapQ.heapPushPop(f,g,c)});f.sort(function(g,h){return-1*d.Base.compare(g,h)});return f};MochiKit.HeapQ.nSmallest=function(a,b,c){var d=MochiKit,e=d.Iter;c=c||d.Base.operator.clt;b=e.list(b);d.HeapQ.heapify(b,c);return d.Base.map(d.Base.partial(d.HeapQ.heapPop,b,c),e.range(Math.min(a,b.length)))};
MochiKit.HeapQ.isHeap=function(a,b){b=b||MochiKit.Base.operator.cle;for(var c=1;c<a.length;++c)if(!b(a[c-1>>1],a[c]))return false;return true};MochiKit.HeapQ.heapSort=function(a,b){var c=MochiKit,d=c.Iter.list(a);c.HeapQ.heapify(d,b);return c.Base.map(c.Base.partial(c.HeapQ.heapPop,d,b),c.Iter.range(d.length))};MochiKit.HeapQ.__new__=function(){};MochiKit.HeapQ.__new__();MochiKit.Base._exportSymbols(this,MochiKit.HeapQ);if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Iter_ext={};MochiKit.Base.module(MochiKit,"Iter_ext","1.5",["Base","Iter"]);MochiKit.Iter.treePreOrder=function(a,b){var c=[a];return{repr:function(){return"treePreOrder(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){if(c.length==0)throw MochiKit.Iter.StopIteration;var d=c.pop();MochiKit.Iter.iextend(c,b(d));return d}}};
MochiKit.Iter.treeLevelOrder=function(a,b){var c=[a];return{repr:function(){return"treeLevelOrder(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){if(c.length==0)throw MochiKit.Iter.StopIteration;var d=c.shift();MochiKit.Iter.iextend(c,b(d));return d}}};
MochiKit.Iter.treePostOrder=function(a,b){var c=[[a,false]];return{repr:function(){return"treePostOrder(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){for(;;){if(c.length==0)throw MochiKit.Iter.StopIteration;var d=c.pop();if(d[1])return d[0];d[1]=true;c.push(d);MochiKit.Iter.iextend(c,MochiKit.Iter.imap(function(e){return[e,false]},b(d[0])))}}}};
MochiKit.Iter.pairView=function(a,b){b=b||false;var c=MochiKit.Iter.iter(a);try{var d=c.next()}catch(e){if(e!=MochiKit.Iter.StopIteration)throw e;return MochiKit.Iter.EmptyIter}if(b)c=MochiKit.Iter.chain(c,[d]);return{repr:function(){return"pairView(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){var f=c.next(),g=[d,f];d=f;return g}}};
MochiKit.Iter.windowView=function(a,b,c){b=b||2;c=c||1;var d=MochiKit.Iter.iter(a),e=[];return{repr:function(){return"windowView(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){if(e.length<b)for(;e.length<b;)e.push(d.next());else for(var f=0;f<c;++f){e.shift();e.push(d.next())}return e.slice()}}};MochiKit.Iter.filterMap=function(a,b,c){c=c||function(d){return typeof d!=="undefined"&&d!==null};return MochiKit.Iter.ifilter(c,MochiKit.Iter.imap(a,b))};
MochiKit.Iter.iflattenArray=function(a){var b=[a];return{repr:function(){return"iflattenArray(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){for(;;){if(b.length==0)throw MochiKit.Iter.StopIteration;var c=b.shift();if(c instanceof Array)Array.prototype.splice.apply(b,[0,0].concat(c));else return c}}}};
MochiKit.Iter.chainFromIter=function(a,b){b=b||MochiKit.Iter.iter;var c=MochiKit.Iter.iter(a),d=null;return{repr:function(){return"chainFromIter(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){if(d==null)d=MochiKit.Iter.iter(b(c.next()));for(;;)try{return d.next()}catch(e){if(e!=MochiKit.Iter.StopIteration)throw e;d=MochiKit.Iter.iter(b(c.next()))}}}};
MochiKit.Iter.uniqueView=function(a,b){b=b||MochiKit.Base.operator.ceq;var c=MochiKit.Iter.iter(a),d=true,e;return{repr:function(){return"uniqueView(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){if(d){d=false;return e=c.next()}for(var f=c.next();b(e,f);)f=c.next();return e=f}}};
MochiKit.Iter.iproduct=function(a,b){var c=MochiKit.Iter.iter(a),d=null,e,f;return{repr:function(){return"iproduct(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){for(;;){if(d==null){e=c.next();d=MochiKit.Iter.iter(b)}try{f=d.next();return[e,f]}catch(g){if(g!=MochiKit.Iter.StopIteration)throw g;d=null}}}}};MochiKit.Iter.enumerate=function(a,b){return MochiKit.Iter.izip(MochiKit.Iter.count(b),a)};MochiKit.Iter.breakIt=function(){throw MochiKit.Iter.StopIteration;};
MochiKit.Iter.EmptyIter={repr:function(){return"EmptyIter"},toString:MochiKit.Base.forwardCall("repr"),next:MochiKit.Iter.breakIt};MochiKit.Iter.generateN=function(a,b){return MochiKit.Iter.imap(function(){return a()},MochiKit.Iter.range(b))};
MochiKit.Iter.izipLongest=function(a,b){b=b||null;a=MochiKit.Base.map(MochiKit.Iter.iter,a);var c=a.length;return{repr:function(){return"izipLongest(...)"},toString:MochiKit.Base.forwardCall("repr"),next:function(){for(var d=Array(a.length),e=0;e<a.length;++e)try{d[e]=a[e].next()}catch(f){if(f!=MochiKit.Iter.StopIteration)throw f;a[e]=MochiKit.Iter.repeat(b);d[e]=b;--c}if(c==0)throw MochiKit.Iter.StopIteration;return d}}};MochiKit.Iter.any=function(){return MochiKit.Iter.some.apply(this,arguments)};
MochiKit.Iter.all=function(){return MochiKit.Iter.every.apply(this,arguments)};MochiKit.Iter.starmap=function(){return MochiKit.Iter.applymap.apply(this,arguments)};MochiKit.Iter.advance=function(a,b){for(;b-- >0;)a.next();return a};MochiKit.Iter.isSorted=function(a,b){return MochiKit.Iter.every(MochiKit.Iter.windowView(a),b||MochiKit.Base.operator.cle)};MochiKit.Iter.interleave=function(){return MochiKit.Iter.chainFromIter(MochiKit.Iter.izip.apply(this,arguments))};
MochiKit.Iter.remapView=function(a,b){return MochiKit.Iter.imap(MochiKit.Base.partial(MochiKit.Base.operator.getitem,b),a)};MochiKit.Iter.compressIter=function(a,b){return MochiKit.Iter.imap(function(c){return c[0]},MochiKit.Iter.ifilter(function(c){return c[1]?true:false},MochiKit.Iter.izip(a,b)))};
MochiKit.Iter.combinations=function(a,b){var c=MochiKit,d=MochiKit.Iter,e=d.list(a),f=e.length;if(b>f)return MochiKit.Iter.EmptyIter;var g=d.list(d.range(b)),h=true;return{repr:function(){return"combinations(...)"},toString:c.Base.forwardCall("repr"),next:function(){if(h){h=false;return d.list(d.remapView(g,e))}for(;;){for(var i=true,j=b-1;j>=0;--j)if(g[j]!=j+f-b){i=false;break}if(i)throw MochiKit.Iter.StopIteration;g[j]+=1;for(i=j+1;i<b;++i)g[i]=g[i-1]+1;return d.list(d.remapView(g,e))}}}};
MochiKit.Iter.combinationsWithReplacement=function(a,b){var c=MochiKit,d=MochiKit.Iter,e=d.list(a),f=e.length;if(f==0||b==0)return d.EmptyIter;var g=d.list(d.repeat(0,b)),h=true;return{repr:function(){return"combinationsWithReplacement(...)"},toString:c.Base.forwardCall("repr"),next:function(){if(h){h=false;return d.list(d.remapView(g,e))}for(;;){for(var i=true,j=b-1;j>=0;--j)if(g[j]!=f-1){i=false;break}if(i)throw d.StopIteration;g=g.slice(0,j).concat(d.list(d.repeat(g[j]+1,b-j)));return d.list(d.remapView(g,
e))}}}};MochiKit.Iter.repeatSeq=function(a,b){if(b==0)return MochiKit.Iter.EmptyIter;var c=MochiKit.Iter.iter(a);return{next:function(){try{return c.next()}catch(d){if(d!=MochiKit.Iter.StopIteration||--b<=0)throw d;c=MochiKit.Iter.iter(a);return c.next()}}}};
MochiKit.Iter.permutations=function(a,b){var c=MochiKit,d=MochiKit.Iter,e=d.list(a),f=e.length;b=b||f;if(b>f)return d.EmptyIter;var g=d.list(d.range(f)),h=d.list(d.range(f,f-b,-1)),i=true;return{repr:function(){return"permutations(...)"},toString:c.Base.forwardCall("repr"),next:function(){if(i){i=false;return d.list(d.remapView(d.islice(g,0,b),e))}if(f==0)throw d.StopIteration;for(var j=true,k=b-1;k>=0;--k){h[k]-=1;if(h[k]==0){g=g.slice(0,k).concat(g.slice(k+1),g[k]);h[k]=f-k}else{j=g.length-h[k];
var l=g[k];g[k]=g[j];g[j]=l;j=false;break}}if(j)throw d.StopIteration;return d.list(d.remapView(d.islice(g,0,b),e))}}};MochiKit.Iter._Range=function(a,b,c){this.start=a;this.stop=b;this.step=c};MochiKit.Iter._Range.prototype.__iterator__=function(){return new MochiKit.Iter.range(this.start,this.stop,this.step)};
MochiKit.Iter.xrange=function(){var a=0,b=0,c=1;if(arguments.length==1)b=arguments[0];else if(arguments.length==2){a=arguments[0];b=arguments[1]}else if(arguments.length==3){a=arguments[0];b=arguments[1];c=arguments[2]}else throw new TypeError("xrange() takes 1, 2, or 3 arguments!");if(c===0)throw new TypeError("xrange() step must not be 0");return new MochiKit.Iter._Range(a,b,c)};MochiKit.Iter_ext.__new__=function(){};MochiKit.Iter_ext.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Iter);MochiKit.Base.module(MochiKit,"_MersenneTwister19937","1.5",["Base"]);
MochiKit._MersenneTwister19937=function(){function a(g){return g<0?(g^d)+d:g}function b(g,h){return a(g+h&4294967295)}function c(g,h){for(var i=0,j=0;j<32;++j)if(g>>>j&1)i=b(i,a(h<<j));return i}var d=2147483648,e=Array(624),f=625;this.init_genrand=function(g){e[0]=a(g&4294967295);for(f=1;f<624;f++){e[f]=b(c(1812433253,a(e[f-1]^e[f-1]>>>30)),f);e[f]=a(e[f]&4294967295)}};this.init_by_array=function(g,h){var i,j,k;this.init_genrand(19650218);i=1;j=0;for(k=624>h?624:h;k;k--){e[i]=b(b(a(e[i]^c(a(e[i-1]^
e[i-1]>>>30),1664525)),g[j]),j);e[i]=a(e[i]&4294967295);i++;j++;if(i>=624){e[0]=e[623];i=1}if(j>=h)j=0}for(k=623;k;k--){j=e;var l=i,m;m=a(e[i]^c(a(e[i-1]^e[i-1]>>>30),1566083941));var o=i;m=m<o?a(4294967296-(o-m)&4294967295):m-o;j[l]=m;e[i]=a(e[i]&4294967295);i++;if(i>=624){e[0]=e[623];i=1}}e[0]=2147483648};this.genrand_int32=function(){var g,h=[0,2567483615];if(f>=624){var i;f==625&&this.init_genrand(5489);for(i=0;i<227;i++){g=a(e[i]&d|e[i+1]&2147483647);e[i]=a(e[i+397]^g>>>1^h[g&1])}for(;i<623;i++){g=
a(e[i]&d|e[i+1]&2147483647);e[i]=a(e[i+-227]^g>>>1^h[g&1])}g=a(e[623]&d|e[0]&2147483647);e[623]=a(e[396]^g>>>1^h[g&1]);f=0}g=e[f++];g=a(g^g>>>11);g=a(g^g<<7&2636928640);g=a(g^g<<15&4022730752);return g=a(g^g>>>18)};this.genrand_int31=function(){return this.genrand_int32()>>>1};this.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)};this.genrand_real2=function(){return this.genrand_int32()*(1/4294967296)};this.genrand_real3=function(){return(this.genrand_int32()+0.5)*(1/4294967296)};
this.genrand_res53=function(){var g=this.genrand_int32()>>>5,h=this.genrand_int32()>>>6;return(g*67108864+h)*1.1102230246251565E-16};this._getState=function(){return{mt:e.slice(),mti:f}};this._setState=function(g){e=g.mt;f=g.mti}};if(typeof goog!="undefined"&&typeof goog.provide=="function")MochiKit.Random={};MochiKit.Base.module(MochiKit,"Random","1.5",["Base","_MersenneTwister19937"]);MochiKit.Random.seed=function(a){a=typeof a=="number"?a:(new Date).getTime();MochiKit.Random._generator.init_genrand(a)};MochiKit.Random.getState=function(){return MochiKit.Random._generator._getState()};MochiKit.Random.setState=function(a){MochiKit.Random._generator._setState(a)};MochiKit.Random.random=function(){return MochiKit.Random._generator.genrand_real2()};
MochiKit.Random.randRange=function(a,b,c){var d=MochiKit.Random;if(arguments.length==1){b=a;a=0}c=c||1;var e=b-a;if(c==1&&e>0)return Math.floor(a+Math.floor(d.random()*e));if(c>0)var f=Math.floor((e+c-1)/c);else if(c<0)f=Math.floor((e+c+1)/c);return a+c*Math.floor(d.random()*f)};MochiKit.Random.uniform=function(a,b){return a+(b-a)*MochiKit.Random.random()};MochiKit.Random.shuffle=function(a){for(var b=a.length-1;b>0;--b){var c=Math.floor(MochiKit.Random.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d}return a};
MochiKit.Random.deal=function(a,b){b=b||MochiKit.Base.operator.identity;for(var c=Array(a),d=0;d<a;++d){var e=Math.floor(MochiKit.Random.random()*(d+1));c[d]=c[e];c[e]=b(d)}return c};MochiKit.Random.choice=function(a){return a[Math.floor(MochiKit.Random.random()*a.length)]};MochiKit.Random.shuffled=function(a){var b=a.length,c=Array(b);c[0]=a[0];for(var d=1;d<b-1;++d){var e=Math.floor(MochiKit.Random.random()*(d+1));c[d]=c[e];c[e]=a[d]}return c};
MochiKit.Random.sample=function(a,b){for(var c=a.length,d=Array(b),e={},f=0;f<b;++f){for(var g=MochiKit.Random.randRange(c);g in e;)g=MochiKit.Random.randRange(c);e[g]=true;d[f]=a[g]}return d};MochiKit.Random.__new__=function(){var a=MochiKit.Random;a._generator=new MochiKit._MersenneTwister19937;a._generator.init_genrand((new Date).getTime())};MochiKit.Random.__new__();MochiKit.Base._exportSymbols(this,MochiKit.Random);
